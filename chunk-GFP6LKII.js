import{a as Um}from"./chunk-4TIZL6UV.js";import{a as zt,b as jn,k as Fm}from"./chunk-YTMY6S6D.js";import{H as gu,Sc as Mm,Uc as Lo,e as xo,ga as Vo,ja as Zi,l as Oo,o as Lm,p as mu,s as Xi}from"./chunk-MU7CYOZV.js";import{a as Om,b as Vm,f as Mw,h as wt,i as p}from"./chunk-UDPOFCFO.js";var qm=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Fw=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[t++],o=n[t++],c=n[t++],u=((i&7)<<18|(s&63)<<12|(o&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{let s=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},jm={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],o=i+1<n.length,c=o?n[i+1]:0,u=i+2<n.length,h=u?n[i+2]:0,f=s>>2,m=(s&3)<<4|c>>4,_=(c&15)<<2|h>>6,b=h&63;u||(b=64,o||(_=64)),r.push(t[f],t[m],t[_],t[b])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(qm(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Fw(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=t[n.charAt(i++)],c=i<n.length?t[n.charAt(i)]:0;++i;let h=i<n.length?t[n.charAt(i)]:64;++i;let m=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||c==null||h==null||m==null)throw new yu;let _=s<<2|c>>4;if(r.push(_),h!==64){let b=c<<4&240|h>>2;if(r.push(b),m!==64){let k=h<<6&192|m;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},yu=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Uw=function(n){let e=qm(n);return jm.encodeByteArray(e,!0)},es=function(n){return Uw(n).replace(/\./g,"")},Iu=function(n){try{return jm.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function ts(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:let t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(let t in e)!e.hasOwnProperty(t)||!Bw(t)||(n[t]=ts(n[t],e[t]));return n}function Bw(n){return n!=="__proto__"}function wu(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var qw=()=>wu().__FIREBASE_DEFAULTS__,jw=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},zw=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&Iu(n[1]);return e&&JSON.parse(e)},Eu=()=>{try{return qw()||jw()||zw()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}};var Tu=()=>{var n;return(n=Eu())===null||n===void 0?void 0:n.config},zm=n=>{var e;return(e=Eu())===null||e===void 0?void 0:e[`_${n}`]};var Mo=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function Gm(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[es(JSON.stringify(t)),es(JSON.stringify(o)),""].join(".")}function oe(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Wm(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(oe())}function Fo(){var n;let e=(n=Eu())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Km(){return typeof window<"u"||Au()}function Au(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function $m(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Uo(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function ns(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Bo(){let n=oe();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function bu(){return!Fo()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function un(){try{return typeof indexedDB=="object"}catch{return!1}}function Hm(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var Gw="FirebaseError",Te=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Gw,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,it.prototype.create)}},it=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?Ww(s,r):"Error",c=`${this.serviceName}: ${o} (${i}).`;return new Te(i,c,r)}};function Ww(n,e){return n.replace(Kw,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var Kw=/\{\$([^}]+)}/g;function Su(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Qm(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function ln(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let s=n[i],o=e[i];if(Bm(s)&&Bm(o)){if(!ln(s,o))return!1}else if(s!==o)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function Bm(n){return n!==null&&typeof n=="object"}function zn(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function hn(n){let e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){let[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function xr(n){let e=n.indexOf("?");if(!e)return"";let t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function qo(n,e){let t=new vu(n,e);return t.subscribe.bind(t)}var vu=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");$w(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=_u),i.error===void 0&&(i.error=_u),i.complete===void 0&&(i.complete=_u);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function $w(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function _u(){}var rR=14400*1e3;function z(n){return n&&n._delegate?n._delegate:n}var xe=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Gn="[DEFAULT]";var Ru=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new Mo;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Qw(e))try{this.getOrInitializeService({instanceIdentifier:Gn})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=Gn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return p(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Gn){return this.instances.has(e)}getOptions(e=Gn){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[s,o]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(s);r===c&&o.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);let o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Hw(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Gn){return this.component?this.component.multipleInstances?e:Gn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Hw(n){return n===Gn?void 0:n}function Qw(n){return n.instantiationMode==="EAGER"}var rs=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new Ru(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var Gu={};Mw(Gu,{FirebaseError:()=>Te,SDK_VERSION:()=>dt,_DEFAULT_ENTRY_NAME:()=>At,_addComponent:()=>Lr,_addOrOverwriteComponent:()=>Bu,_apps:()=>dn,_clearComponents:()=>ME,_components:()=>Vr,_getProvider:()=>Wo,_isFirebaseApp:()=>lg,_isFirebaseServerApp:()=>de,_registerComponent:()=>ht,_removeServiceInstance:()=>ug,_serverApps:()=>Or,deleteApp:()=>$o,getApp:()=>qu,getApps:()=>BE,initializeApp:()=>Ko,initializeServerApp:()=>UE,onLog:()=>ju,registerVersion:()=>He,setLogLevel:()=>zu});var Pu=[],J=(function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n})(J||{}),Jm={debug:J.DEBUG,verbose:J.VERBOSE,info:J.INFO,warn:J.WARN,error:J.ERROR,silent:J.SILENT},Jw=J.INFO,Yw={[J.DEBUG]:"log",[J.VERBOSE]:"log",[J.INFO]:"info",[J.WARN]:"warn",[J.ERROR]:"error"},Xw=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=Yw[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Et=class{constructor(e){this.name=e,this._logLevel=Jw,this._logHandler=Xw,this._userLogHandler=null,Pu.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in J))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Jm[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,J.DEBUG,...e),this._logHandler(this,J.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,J.VERBOSE,...e),this._logHandler(this,J.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,J.INFO,...e),this._logHandler(this,J.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,J.WARN,...e),this._logHandler(this,J.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,J.ERROR,...e),this._logHandler(this,J.ERROR,...e)}};function Ym(n){Pu.forEach(e=>{e.setLogLevel(n)})}function Xm(n,e){for(let t of Pu){let r=null;e&&e.level&&(r=Jm[e.level]),n===null?t.userLogHandler=null:t.userLogHandler=(i,s,...o)=>{let c=o.map(u=>{if(u==null)return null;if(typeof u=="string")return u;if(typeof u=="number"||typeof u=="boolean")return u.toString();if(u instanceof Error)return u.message;try{return JSON.stringify(u)}catch{return null}}).filter(u=>u).join(" ");s>=(r??i.logLevel)&&n({level:J[s].toLowerCase(),message:c,args:o,type:i.name})}}}var Zw=(n,e)=>e.some(t=>n instanceof t),Zm,eg;function eE(){return Zm||(Zm=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function tE(){return eg||(eg=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var tg=new WeakMap,Nu=new WeakMap,ng=new WeakMap,Cu=new WeakMap,Du=new WeakMap;function nE(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(Tt(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&tg.set(t,n)}).catch(()=>{}),Du.set(e,n),e}function rE(n){if(Nu.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});Nu.set(n,e)}var ku={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Nu.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ng.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Tt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function rg(n){ku=n(ku)}function iE(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(jo(this),e,...t);return ng.set(r,e.sort?e.sort():[e]),Tt(r)}:tE().includes(n)?function(...e){return n.apply(jo(this),e),Tt(tg.get(this))}:function(...e){return Tt(n.apply(jo(this),e))}}function sE(n){return typeof n=="function"?iE(n):(n instanceof IDBTransaction&&rE(n),Zw(n,eE())?new Proxy(n,ku):n)}function Tt(n){if(n instanceof IDBRequest)return nE(n);if(Cu.has(n))return Cu.get(n);let e=sE(n);return e!==n&&(Cu.set(n,e),Du.set(e,n)),e}var jo=n=>Du.get(n);function sg(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(n,e),c=Tt(o);return r&&o.addEventListener("upgradeneeded",u=>{r(Tt(o.result),u.oldVersion,u.newVersion,Tt(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),c.then(u=>{s&&u.addEventListener("close",()=>s()),i&&u.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}var oE=["get","getKey","getAll","getAllKeys","count"],aE=["put","add","delete","clear"],xu=new Map;function ig(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(xu.get(e))return xu.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=aE.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||oE.includes(t)))return;let s=function(o,...c){return p(this,null,function*(){let u=this.transaction(o,i?"readwrite":"readonly"),h=u.store;return r&&(h=h.index(c.shift())),(yield Promise.all([h[t](...c),i&&u.done]))[0]})};return xu.set(e,s),s}rg(n=>Vm(Om({},n),{get:(e,t,r)=>ig(e,t)||n.get(e,t,r),has:(e,t)=>!!ig(e,t)||n.has(e,t)}));var Vu=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(cE(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function cE(n){let e=n.getComponent();return e?.type==="VERSION"}var zo="@firebase/app",Lu="0.10.13";var Gt=new Et("@firebase/app"),uE="@firebase/app-compat",lE="@firebase/analytics-compat",hE="@firebase/analytics",dE="@firebase/app-check-compat",fE="@firebase/app-check",pE="@firebase/auth",mE="@firebase/auth-compat",gE="@firebase/database",_E="@firebase/data-connect",yE="@firebase/database-compat",vE="@firebase/functions",IE="@firebase/functions-compat",wE="@firebase/installations",EE="@firebase/installations-compat",TE="@firebase/messaging",AE="@firebase/messaging-compat",bE="@firebase/performance",SE="@firebase/performance-compat",RE="@firebase/remote-config",PE="@firebase/remote-config-compat",CE="@firebase/storage",NE="@firebase/storage-compat",kE="@firebase/firestore",DE="@firebase/vertexai-preview",xE="@firebase/firestore-compat",OE="firebase",VE="10.14.1";var At="[DEFAULT]",LE={[zo]:"fire-core",[uE]:"fire-core-compat",[hE]:"fire-analytics",[lE]:"fire-analytics-compat",[fE]:"fire-app-check",[dE]:"fire-app-check-compat",[pE]:"fire-auth",[mE]:"fire-auth-compat",[gE]:"fire-rtdb",[_E]:"fire-data-connect",[yE]:"fire-rtdb-compat",[vE]:"fire-fn",[IE]:"fire-fn-compat",[wE]:"fire-iid",[EE]:"fire-iid-compat",[TE]:"fire-fcm",[AE]:"fire-fcm-compat",[bE]:"fire-perf",[SE]:"fire-perf-compat",[RE]:"fire-rc",[PE]:"fire-rc-compat",[CE]:"fire-gcs",[NE]:"fire-gcs-compat",[kE]:"fire-fst",[xE]:"fire-fst-compat",[DE]:"fire-vertex","fire-js":"fire-js",[OE]:"fire-js-all"};var dn=new Map,Or=new Map,Vr=new Map;function Lr(n,e){try{n.container.addComponent(e)}catch(t){Gt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Bu(n,e){n.container.addOrOverwriteComponent(e)}function ht(n){let e=n.name;if(Vr.has(e))return Gt.debug(`There were multiple attempts to register component ${e}.`),!1;Vr.set(e,n);for(let t of dn.values())Lr(t,n);for(let t of Or.values())Lr(t,n);return!0}function Wo(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function ug(n,e,t=At){Wo(n,e).clearInstance(t)}function lg(n){return n.options!==void 0}function de(n){return n.settings!==void 0}function ME(){Vr.clear()}var FE={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},st=new it("app","Firebase",FE);var Go=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new xe("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw st.create("app-deleted",{appName:this._name})}};var Mu=class extends Go{constructor(e,t,r,i){let s=t.automaticDataCollectionEnabled!==void 0?t.automaticDataCollectionEnabled:!1,o={name:r,automaticDataCollectionEnabled:s};if(e.apiKey!==void 0)super(e,o,i);else{let c=e;super(c.options,o,i)}this._serverConfig=Object.assign({automaticDataCollectionEnabled:s},t),this._finalizationRegistry=null,typeof FinalizationRegistry<"u"&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,He(zo,Lu,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,e!==void 0&&this._finalizationRegistry!==null&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){$o(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw st.create("server-app-deleted")}};var dt=VE;function Ko(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:At,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw st.create("bad-app-name",{appName:String(i)});if(t||(t=Tu()),!t)throw st.create("no-options");let s=dn.get(i);if(s){if(ln(t,s.options)&&ln(r,s.config))return s;throw st.create("duplicate-app",{appName:i})}let o=new rs(i);for(let u of Vr.values())o.addComponent(u);let c=new Go(t,r,o);return dn.set(i,c),c}function UE(n,e){if(Km()&&!Au())throw st.create("invalid-server-app-environment");e.automaticDataCollectionEnabled===void 0&&(e.automaticDataCollectionEnabled=!1);let t;lg(n)?t=n.options:t=n;let r=Object.assign(Object.assign({},e),t);r.releaseOnDeref!==void 0&&delete r.releaseOnDeref;let i=h=>[...h].reduce((f,m)=>Math.imul(31,f)+m.charCodeAt(0)|0,0);if(e.releaseOnDeref!==void 0&&typeof FinalizationRegistry>"u")throw st.create("finalization-registry-not-supported",{});let s=""+i(JSON.stringify(r)),o=Or.get(s);if(o)return o.incRefCount(e.releaseOnDeref),o;let c=new rs(s);for(let h of Vr.values())c.addComponent(h);let u=new Mu(t,e,s,c);return Or.set(s,u),u}function qu(n=At){let e=dn.get(n);if(!e&&n===At&&Tu())return Ko();if(!e)throw st.create("no-app",{appName:n});return e}function BE(){return Array.from(dn.values())}function $o(n){return p(this,null,function*(){let e=!1,t=n.name;dn.has(t)?(e=!0,dn.delete(t)):Or.has(t)&&n.decRefCount()<=0&&(Or.delete(t),e=!0),e&&(yield Promise.all(n.container.getProviders().map(r=>r.delete())),n.isDeleted=!0)})}function He(n,e,t){var r;let i=(r=LE[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){let c=[`Unable to register library "${i}" with version "${e}":`];s&&c.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&c.push("and"),o&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Gt.warn(c.join(" "));return}ht(new xe(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}function ju(n,e){if(n!==null&&typeof n!="function")throw st.create("invalid-log-argument");Xm(n,e)}function zu(n){Ym(n)}var qE="firebase-heartbeat-database",jE=1,is="firebase-heartbeat-store",Ou=null;function hg(){return Ou||(Ou=sg(qE,jE,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(is)}catch(t){console.warn(t)}}}}).catch(n=>{throw st.create("idb-open",{originalErrorMessage:n.message})})),Ou}function zE(n){return p(this,null,function*(){try{let t=(yield hg()).transaction(is),r=yield t.objectStore(is).get(dg(n));return yield t.done,r}catch(e){if(e instanceof Te)Gt.warn(e.message);else{let t=st.create("idb-get",{originalErrorMessage:e?.message});Gt.warn(t.message)}}})}function og(n,e){return p(this,null,function*(){try{let r=(yield hg()).transaction(is,"readwrite");yield r.objectStore(is).put(e,dg(n)),yield r.done}catch(t){if(t instanceof Te)Gt.warn(t.message);else{let r=st.create("idb-set",{originalErrorMessage:t?.message});Gt.warn(r.message)}}})}function dg(n){return`${n.name}!${n.options.appId}`}var GE=1024,WE=720*60*60*1e3,Fu=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Uu(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return p(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=ag();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)?void 0:(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{let c=new Date(o.date).valueOf();return Date.now()-c<=WE}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Gt.warn(r)}})}getHeartbeatsHeader(){return p(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=ag(),{heartbeatsToSend:r,unsentEntries:i}=KE(this._heartbeatsCache.heartbeats),s=es(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Gt.warn(t),""}})}};function ag(){return new Date().toISOString().substring(0,10)}function KE(n,e=GE){let t=[],r=n.slice();for(let i of n){let s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),cg(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),cg(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var Uu=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return p(this,null,function*(){return un()?Hm().then(()=>!0).catch(()=>!1):!1})}read(){return p(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield zE(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return p(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return og(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return p(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return og(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function cg(n){return es(JSON.stringify({version:2,heartbeats:n})).length}function $E(n){ht(new xe("platform-logger",e=>new Vu(e),"PRIVATE")),ht(new xe("heartbeat",e=>new Fu(e),"PRIVATE")),He(zo,Lu,n),He(zo,Lu,"esm2017"),He("fire-js","")}$E("");var Wu=class{constructor(e,t){this._delegate=e,this.firebase=t,Lr(e,new xe("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),$o(this._delegate)))}_getService(e,t=At){var r;this._delegate.checkDestroyed();let i=this._delegate.container.getProvider(e);return!i.isInitialized()&&((r=i.getComponent())===null||r===void 0?void 0:r.instantiationMode)==="EXPLICIT"&&i.initialize(),i.getImmediate({identifier:t})}_removeServiceInstance(e,t=At){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Lr(this._delegate,e)}_addOrOverwriteComponent(e){Bu(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}};var HE={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},fg=new it("app-compat","Firebase",HE);function QE(n){let e={},t={__esModule:!0,initializeApp:s,app:i,registerVersion:He,setLogLevel:zu,onLog:ju,apps:null,SDK_VERSION:dt,INTERNAL:{registerComponent:c,removeApp:r,useAsService:u,modularAPIs:Gu}};t.default=t,Object.defineProperty(t,"apps",{get:o});function r(h){delete e[h]}function i(h){if(h=h||At,!Su(e,h))throw fg.create("no-app",{appName:h});return e[h]}i.App=n;function s(h,f={}){let m=Ko(h,f);if(Su(e,m.name))return e[m.name];let _=new n(m,t);return e[m.name]=_,_}function o(){return Object.keys(e).map(h=>e[h])}function c(h){let f=h.name,m=f.replace("-compat","");if(ht(h)&&h.type==="PUBLIC"){let _=(b=i())=>{if(typeof b[m]!="function")throw fg.create("invalid-app-argument",{appName:f});return b[m]()};h.serviceProps!==void 0&&ts(_,h.serviceProps),t[m]=_,n.prototype[m]=function(...b){return this._getService.bind(this,f).apply(this,h.multipleInstances?b:[])}}return h.type==="PUBLIC"?t[m]:null}function u(h,f){return f==="serverAuth"?null:f}return t}function mg(){let n=QE(Wu);n.INTERNAL=Object.assign(Object.assign({},n.INTERNAL),{createFirebaseNamespace:mg,extendNamespace:e,createSubscribe:qo,ErrorFactory:it,deepExtend:ts});function e(t){ts(n,t)}return n}var JE=mg();var pg=new Et("@firebase/app-compat"),YE="@firebase/app-compat",XE="0.2.43";function ZE(n){He(YE,XE,n)}try{let n=wu();if(n.firebase!==void 0){pg.warn(`
      Warning: Firebase is already defined in the global scope. Please make sure
      Firebase library is only loaded once.
    `);let e=n.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&pg.warn(`
        Warning: You are trying to load Firebase while using Firebase Performance standalone script.
        You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
        `)}}catch{}var Oe=JE;ZE();var eT="firebase",tT="10.14.1";Oe.registerVersion(eT,tT,"app-compat");var Jn={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"};var _n={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function nT(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}}function kg(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var El=nT,Dg=kg,xg=new it("auth","Firebase",kg());var Yo=new Et("@firebase/auth");function rT(n,...e){Yo.logLevel<=J.WARN&&Yo.warn(`Auth (${dt}): ${n}`,...e)}function Qo(n,...e){Yo.logLevel<=J.ERROR&&Yo.error(`Auth (${dt}): ${n}`,...e)}function Se(n,...e){throw Al(n,...e)}function be(n,...e){return Al(n,...e)}function Tl(n,e,t){let r=Object.assign(Object.assign({},Dg()),{[e]:t});return new it("auth","Firebase",r).create(e,{appName:n.name})}function Ve(n){return Tl(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ur(n,e,t){let r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Se(n,"argument-error"),Tl(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Al(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return xg.create(n,...e)}function V(n,e,...t){if(!n)throw Al(e,...t)}function bt(n){let e="INTERNAL ASSERTION FAILED: "+n;throw Qo(e),new Error(e)}function ot(n,e){n||bt(e)}function us(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function bl(){return gg()==="http:"||gg()==="https:"}function gg(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function iT(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(bl()||Uo()||"connection"in navigator)?navigator.onLine:!0}function sT(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var Wn=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,ot(t>e,"Short delay should be less than long delay!"),this.isMobile=Wm()||ns()}get(){return iT()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Sl(n,e){ot(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var ls=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;bt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;bt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;bt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var oT={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var aT=new Wn(3e4,6e4);function ge(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function _e(s,o,c,u){return p(this,arguments,function*(n,e,t,r,i={}){return Og(n,i,()=>p(null,null,function*(){let h={},f={};r&&(e==="GET"?f=r:h={body:JSON.stringify(r)});let m=zn(Object.assign({key:n.config.apiKey},f)).slice(1),_=yield n._getAdditionalHeaders();_["Content-Type"]="application/json",n.languageCode&&(_["X-Firebase-Locale"]=n.languageCode);let b=Object.assign({method:e,headers:_},h);return $m()||(b.referrerPolicy="no-referrer"),ls.fetch()(Vg(n,n.config.apiHost,t,m),b)}))})}function Og(n,e,t){return p(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},oT),e);try{let i=new Ju(n),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw ss(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let c=s.ok?o.errorMessage:o.error.message,[u,h]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw ss(n,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw ss(n,"email-already-in-use",o);if(u==="USER_DISABLED")throw ss(n,"user-disabled",o);let f=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw Tl(n,f,h);Se(n,f)}}catch(i){if(i instanceof Te)throw i;Se(n,"network-request-failed",{message:String(i)})}})}function $t(s,o,c,u){return p(this,arguments,function*(n,e,t,r,i={}){let h=yield _e(n,e,t,r,i);return"mfaPendingCredential"in h&&Se(n,"multi-factor-auth-required",{_serverResponse:h}),h})}function Vg(n,e,t,r){let i=`${e}${t}?${r}`;return n.config.emulator?Sl(n.config,i):`${n.config.apiScheme}://${i}`}function cT(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var Ju=class{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(be(this.auth,"network-request-failed")),aT.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}};function ss(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=be(n,e,r);return i.customData._tokenResponse=t,i}function _g(n){return n!==void 0&&n.getResponse!==void 0}function yg(n){return n!==void 0&&n.enterprise!==void 0}var Yu=class{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return cT(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}};function uT(n){return p(this,null,function*(){return(yield _e(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})}function lT(n,e){return p(this,null,function*(){return _e(n,"GET","/v2/recaptchaConfig",ge(n,e))})}function hT(n,e){return p(this,null,function*(){return _e(n,"POST","/v1/accounts:delete",e)})}function dT(n,e){return p(this,null,function*(){return _e(n,"POST","/v1/accounts:update",e)})}function Lg(n,e){return p(this,null,function*(){return _e(n,"POST","/v1/accounts:lookup",e)})}function os(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Mg(n,e=!1){return p(this,null,function*(){let t=z(n),r=yield t.getIdToken(e),i=ca(r);V(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:r,authTime:os(Ku(i.auth_time)),issuedAtTime:os(Ku(i.iat)),expirationTime:os(Ku(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function Ku(n){return Number(n)*1e3}function ca(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Qo("JWT malformed, contained fewer than 3 sections"),null;try{let i=Iu(t);return i?JSON.parse(i):(Qo("Failed to decode base64 JWT payload"),null)}catch(i){return Qo("Caught error parsing JWT payload as JSON",i?.toString()),null}}function vg(n){let e=ca(n);return V(e,"internal-error"),V(typeof e.exp<"u","internal-error"),V(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Kt(n,e,t=!1){return p(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof Te&&fT(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function fT({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var Xu=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>p(this,null,function*(){yield this.iteration()}),t)}iteration(){return p(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var hs=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=os(this.lastLoginAt),this.creationTime=os(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function ds(n){return p(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield Kt(n,Lg(t,{idToken:r}));V(i?.users.length,t,"internal-error");let s=i.users[0];n._notifyReloadListener(s);let o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?Ug(s.providerUserInfo):[],c=pT(n.providerData,o),u=n.isAnonymous,h=!(n.email&&s.passwordHash)&&!c?.length,f=u?h:!1,m={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new hs(s.createdAt,s.lastLoginAt),isAnonymous:f};Object.assign(n,m)})}function Fg(n){return p(this,null,function*(){let e=z(n);yield ds(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function pT(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Ug(n){return n.map(e=>{var{providerId:t}=e,r=Oo(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function mT(n,e){return p(this,null,function*(){let t=yield Og(n,{},()=>p(null,null,function*(){let r=zn({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,o=Vg(n,i,"/v1/token",`key=${s}`),c=yield n._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",ls.fetch()(o,{method:"POST",headers:c,body:r})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function gT(n,e){return p(this,null,function*(){return _e(n,"POST","/v2/accounts:revokeToken",ge(n,e))})}var as=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){V(e.idToken,"internal-error"),V(typeof e.idToken<"u","internal-error"),V(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):vg(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){V(e.length!==0,"internal-error");let t=vg(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return p(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(V(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return p(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:s}=yield mT(e,t);this.updateTokensAndExpiration(r,i,Number(s))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:s}=t,o=new n;return r&&(V(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(V(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(V(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return bt("not implemented")}};function fn(n,e){V(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var Kn=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=Oo(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Xu(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new hs(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return p(this,null,function*(){let t=yield Kt(this,this.stsTokenManager.getToken(this.auth,e));return V(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return Mg(this,e)}reload(){return Fg(this)}_assign(e){this!==e&&(V(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){V(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return p(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield ds(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return p(this,null,function*(){if(de(this.auth.app))return Promise.reject(Ve(this.auth));let e=yield this.getIdToken();return yield Kt(this,hT(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,o,c,u,h,f;let m=(r=t.displayName)!==null&&r!==void 0?r:void 0,_=(i=t.email)!==null&&i!==void 0?i:void 0,b=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,k=(o=t.photoURL)!==null&&o!==void 0?o:void 0,O=(c=t.tenantId)!==null&&c!==void 0?c:void 0,D=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,G=(h=t.createdAt)!==null&&h!==void 0?h:void 0,W=(f=t.lastLoginAt)!==null&&f!==void 0?f:void 0,{uid:q,emailVerified:Q,isAnonymous:te,providerData:K,stsTokenManager:w}=t;V(q&&w,e,"internal-error");let y=as.fromJSON(this.name,w);V(typeof q=="string",e,"internal-error"),fn(m,e.name),fn(_,e.name),V(typeof Q=="boolean",e,"internal-error"),V(typeof te=="boolean",e,"internal-error"),fn(b,e.name),fn(k,e.name),fn(O,e.name),fn(D,e.name),fn(G,e.name),fn(W,e.name);let I=new n({uid:q,auth:e,email:_,emailVerified:Q,displayName:m,isAnonymous:te,photoURL:k,phoneNumber:b,tenantId:O,stsTokenManager:y,createdAt:G,lastLoginAt:W});return K&&Array.isArray(K)&&(I.providerData=K.map(E=>Object.assign({},E))),D&&(I._redirectEventId=D),I}static _fromIdTokenResponse(e,t,r=!1){return p(this,null,function*(){let i=new as;i.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield ds(s),s})}static _fromGetAccountInfoResponse(e,t,r){return p(this,null,function*(){let i=t.users[0];V(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?Ug(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!s?.length,c=new as;c.updateFromIdToken(r);let u=new n({uid:i.localId,auth:e,stsTokenManager:c,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new hs(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(u,h),u})}};var Ig=new Map;function ze(n){ot(n instanceof Function,"Expected a class definition");let e=Ig.get(n);return e?(ot(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Ig.set(n,e),e)}var _T=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return p(this,null,function*(){return!0})}_set(t,r){return p(this,null,function*(){this.storage[t]=r})}_get(t){return p(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return p(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),mn=_T;function St(n,e,t){return`firebase:${n}:${e}:${t}`}var Xo=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:s}=this.auth;this.fullUserKey=St(this.userKey,i.apiKey,s),this.fullPersistenceKey=St("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return p(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);return e?Kn._fromJSON(this.auth,e):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return p(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return p(this,null,function*(){if(!t.length)return new n(ze(mn),e,r);let i=(yield Promise.all(t.map(h=>p(null,null,function*(){if(yield h._isAvailable())return h})))).filter(h=>h),s=i[0]||ze(mn),o=St(r,e.config.apiKey,e.name),c=null;for(let h of t)try{let f=yield h._get(o);if(f){let m=Kn._fromJSON(e,f);h!==s&&(c=m),s=h;break}}catch{}let u=i.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!u.length?new n(s,e,r):(s=u[0],c&&(yield s._set(o,c.toJSON())),yield Promise.all(t.map(h=>p(null,null,function*(){if(h!==s)try{yield h._remove(o)}catch{}}))),new n(s,e,r))})}};function wg(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(zg(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Bg(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Gg(e))return"Blackberry";if(Wg(e))return"Webos";if(qg(e))return"Safari";if((e.includes("chrome/")||jg(e))&&!e.includes("edge/"))return"Chrome";if(Br(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Bg(n=oe()){return/firefox\//i.test(n)}function qg(n=oe()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function jg(n=oe()){return/crios\//i.test(n)}function zg(n=oe()){return/iemobile/i.test(n)}function Br(n=oe()){return/android/i.test(n)}function Gg(n=oe()){return/blackberry/i.test(n)}function Wg(n=oe()){return/webos/i.test(n)}function qr(n=oe()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Kg(n=oe()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(n)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(n)}function yT(n=oe()){var e;return qr(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function vT(){return Bo()&&document.documentMode===10}function $g(n=oe()){return qr(n)||Br(n)||Wg(n)||Gg(n)||/windows phone/i.test(n)||zg(n)}function Rl(n,e=[]){let t;switch(n){case"Browser":t=wg(oe());break;case"Worker":t=`${wg(oe())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${dt}/${r}`}var Zu=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=s=>new Promise((o,c)=>{try{let u=e(s);o(u)}catch(u){c(u)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return p(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function IT(t){return p(this,arguments,function*(n,e={}){return _e(n,"GET","/v2/passwordPolicy",ge(n,e))})}var wT=6,el=class{constructor(e){var t,r,i,s;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:wT,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,o,c;let u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(i=u.containsLowercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(s=u.containsUppercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(o=u.containsNumericCharacter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(c=u.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),u}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var Zo=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ea(this),this.idTokenSubscription=new ea(this),this.beforeStateQueue=new Zu(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=xg,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ze(t)),this._initializationPromise=this.queue(()=>p(this,null,function*(){var r,i;if(!this._deleted&&(this.persistenceManager=yield Xo.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return p(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return p(this,null,function*(){try{let t=yield Lg(this,{idToken:e}),r=yield Kn._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return p(this,null,function*(){var t;if(de(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(c,c))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=i?._redirectEventId,u=yield this.tryRedirectSignIn(e);(!o||o===c)&&u?.user&&(i=u.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return V(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return p(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return p(this,null,function*(){try{yield ds(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=sT()}_delete(){return p(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return p(this,null,function*(){if(de(this.app))return Promise.reject(Ve(this));let t=e?z(e):null;return t&&V(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return p(this,null,function*(){if(!this._deleted)return e&&V(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>p(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return p(this,null,function*(){return de(this.app)?Promise.reject(Ve(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return de(this.app)?Promise.reject(Ve(this)):this.queue(()=>p(this,null,function*(){yield this.assertedPersistence.setPersistence(ze(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return p(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return p(this,null,function*(){let e=yield IT(this),t=new el(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new it("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return p(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield gT(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return p(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return p(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&ze(e)||this._popupRedirectResolver;V(t,this,"argument-error"),this.redirectPersistenceManager=yield Xo.create(this,[ze(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return p(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>p(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return p(this,null,function*(){if(e===this.currentUser)return this.queue(()=>p(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),o=!1,c=this._isInitialized?Promise.resolve():this._initializationPromise;if(V(c,this,"internal-error"),c.then(()=>{o||s(this.currentUser)}),typeof t=="function"){let u=e.addObserver(t,r,i);return()=>{o=!0,u()}}else{let u=e.addObserver(t);return()=>{o=!0,u()}}}directlySetCurrentUser(e){return p(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return V(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Rl(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return p(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return p(this,null,function*(){var e;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&rT(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function ue(n){return z(n)}var ea=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=qo(t=>this.observer=t)}get next(){return V(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Es={loadJS(){return p(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ET(n){Es=n}function Pl(n){return Es.loadJS(n)}function TT(){return Es.recaptchaV2Script}function AT(){return Es.recaptchaEnterpriseScript}function bT(){return Es.gapiScript}function Hg(n){return`__${n}${Math.floor(Math.random()*1e6)}`}var ST="recaptcha-enterprise",RT="NO_RECAPTCHA",tl=class{constructor(e){this.type=ST,this.auth=ue(e)}verify(e="verify",t=!1){return p(this,null,function*(){function r(s){return p(this,null,function*(){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise((o,c)=>p(null,null,function*(){lT(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{let h=new Yu(u);return s.tenantId==null?s._agentRecaptchaConfig=h:s._tenantRecaptchaConfigs[s.tenantId]=h,o(h.siteKey)}}).catch(u=>{c(u)})}))})}function i(s,o,c){let u=window.grecaptcha;yg(u)?u.enterprise.ready(()=>{u.enterprise.execute(s,{action:e}).then(h=>{o(h)}).catch(()=>{o(RT)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((s,o)=>{r(this.auth).then(c=>{if(!t&&yg(window.grecaptcha))i(c,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let u=AT();u.length!==0&&(u+=c),Pl(u).then(()=>{i(c,s,o)}).catch(h=>{o(h)})}}).catch(c=>{o(c)})})})}};function Eg(n,e,t,r=!1){return p(this,null,function*(){let i=new tl(n),s;try{s=yield i.verify(t)}catch{s=yield i.verify(t,!0)}let o=Object.assign({},e);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o})}function fs(n,e,t,r){return p(this,null,function*(){var i;if(!((i=n._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){let s=yield Eg(n,e,t,t==="getOobCode");return r(n,s)}else return r(n,e).catch(s=>p(null,null,function*(){if(s.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let o=yield Eg(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(s)}))})}function PT(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(ze);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function Cl(n,e,t){let r=ue(n);V(r._canInitEmulator,r,"emulator-config-failed"),V(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,s=Qg(e),{host:o,port:c}=CT(e),u=c===null?"":`:${c}`;r.config.emulator={url:`${s}//${o}${u}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:c,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||NT()}function Qg(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function CT(n){let e=Qg(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let s=i[1];return{host:s,port:Tg(r.substr(s.length+1))}}else{let[s,o]=r.split(":");return{host:s,port:Tg(o)}}}function Tg(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function NT(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var Rt=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return bt("not implemented")}_getIdTokenResponse(e){return bt("not implemented")}_linkToIdToken(e,t){return bt("not implemented")}_getReauthenticationResolver(e){return bt("not implemented")}};function Jg(n,e){return p(this,null,function*(){return _e(n,"POST","/v1/accounts:resetPassword",ge(n,e))})}function kT(n,e){return p(this,null,function*(){return _e(n,"POST","/v1/accounts:update",e)})}function DT(n,e){return p(this,null,function*(){return _e(n,"POST","/v1/accounts:signUp",e)})}function xT(n,e){return p(this,null,function*(){return _e(n,"POST","/v1/accounts:update",ge(n,e))})}function OT(n,e){return p(this,null,function*(){return $t(n,"POST","/v1/accounts:signInWithPassword",ge(n,e))})}function ua(n,e){return p(this,null,function*(){return _e(n,"POST","/v1/accounts:sendOobCode",ge(n,e))})}function VT(n,e){return p(this,null,function*(){return ua(n,e)})}function LT(n,e){return p(this,null,function*(){return ua(n,e)})}function MT(n,e){return p(this,null,function*(){return ua(n,e)})}function FT(n,e){return p(this,null,function*(){return ua(n,e)})}function UT(n,e){return p(this,null,function*(){return $t(n,"POST","/v1/accounts:signInWithEmailLink",ge(n,e))})}function BT(n,e){return p(this,null,function*(){return $t(n,"POST","/v1/accounts:signInWithEmailLink",ge(n,e))})}var ps=class n extends Rt{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new n(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new n(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;if(t?.email&&t?.password){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return p(this,null,function*(){switch(this.signInMethod){case"password":let t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return fs(e,t,"signInWithPassword",OT);case"emailLink":return UT(e,{email:this._email,oobCode:this._password});default:Se(e,"internal-error")}})}_linkToIdToken(e,t){return p(this,null,function*(){switch(this.signInMethod){case"password":let r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return fs(e,r,"signUpPassword",DT);case"emailLink":return BT(e,{idToken:t,email:this._email,oobCode:this._password});default:Se(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}};function Wt(n,e){return p(this,null,function*(){return $t(n,"POST","/v1/accounts:signInWithIdp",ge(n,e))})}var qT="http://localhost",ft=class n extends Rt{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new n(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Se("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,s=Oo(t,["providerId","signInMethod"]);if(!r||!i)return null;let o=new n(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){let t=this.buildRequest();return Wt(e,t)}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,Wt(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,Wt(e,t)}buildRequest(){let e={requestUri:qT,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=zn(t)}return e}};function jT(n,e){return p(this,null,function*(){return _e(n,"POST","/v1/accounts:sendVerificationCode",ge(n,e))})}function zT(n,e){return p(this,null,function*(){return $t(n,"POST","/v1/accounts:signInWithPhoneNumber",ge(n,e))})}function GT(n,e){return p(this,null,function*(){let t=yield $t(n,"POST","/v1/accounts:signInWithPhoneNumber",ge(n,e));if(t.temporaryProof)throw ss(n,"account-exists-with-different-credential",t);return t})}var WT={USER_NOT_FOUND:"user-not-found"};function KT(n,e){return p(this,null,function*(){let t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return $t(n,"POST","/v1/accounts:signInWithPhoneNumber",ge(n,t),WT)})}var Mr=class n extends Rt{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new n({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new n({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return zT(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return GT(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return KT(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:i}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));let{verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:s}=e;return!r&&!t&&!i&&!s?null:new n({verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:s})}};function $T(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function HT(n){let e=hn(xr(n)).link,t=e?hn(xr(e)).deep_link_id:null,r=hn(xr(n)).deep_link_id;return(r?hn(xr(r)).link:null)||r||t||e||n}var ms=class n{constructor(e){var t,r,i,s,o,c;let u=hn(xr(e)),h=(t=u.apiKey)!==null&&t!==void 0?t:null,f=(r=u.oobCode)!==null&&r!==void 0?r:null,m=$T((i=u.mode)!==null&&i!==void 0?i:null);V(h&&f&&m,"argument-error"),this.apiKey=h,this.operation=m,this.code=f,this.continueUrl=(s=u.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=u.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(c=u.tenantId)!==null&&c!==void 0?c:null}static parseLink(e){let t=HT(e);try{return new n(t)}catch{return null}}};var Ts=(()=>{class n{constructor(){this.providerId=n.PROVIDER_ID}static credential(t,r){return ps._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){let i=ms.parseLink(r);return V(i,"argument-error"),ps._fromEmailAndCode(t,i.code,i.tenantId)}}n.PROVIDER_ID="password",n.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n.EMAIL_LINK_SIGN_IN_METHOD="emailLink";return n})(),pt=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var gn=class extends pt{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}},Fr=class n extends gn{static credentialFromJSON(e){let t=typeof e=="string"?JSON.parse(e):e;return V("providerId"in t&&"signInMethod"in t,"argument-error"),ft._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return V(e.idToken||e.accessToken,"argument-error"),ft._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return n.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return n.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:i,pendingToken:s,nonce:o,providerId:c}=e;if(!r&&!i&&!t&&!s||!c)return null;try{return new n(c)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:s})}catch{return null}}};var la=(()=>{class n extends gn{constructor(){super("facebook.com")}static credential(t){return ft._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return n.credential(t.oauthAccessToken)}catch{return null}}}n.FACEBOOK_SIGN_IN_METHOD="facebook.com",n.PROVIDER_ID="facebook.com";return n})(),ha=(()=>{class n extends gn{constructor(){super("google.com"),this.addScope("profile")}static credential(t,r){return ft._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:r})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;let{oauthIdToken:r,oauthAccessToken:i}=t;if(!r&&!i)return null;try{return n.credential(r,i)}catch{return null}}}n.GOOGLE_SIGN_IN_METHOD="google.com",n.PROVIDER_ID="google.com";return n})(),da=(()=>{class n extends gn{constructor(){super("github.com")}static credential(t){return ft._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return n.credential(t.oauthAccessToken)}catch{return null}}}n.GITHUB_SIGN_IN_METHOD="github.com",n.PROVIDER_ID="github.com";return n})(),QT="http://localhost",$n=class n extends Rt{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){let t=this.buildRequest();return Wt(e,t)}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,Wt(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,Wt(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){let t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,pendingToken:s}=t;return!r||!i||!s||r!==i?null:new n(r,s)}static _create(e,t){return new n(e,t)}buildRequest(){return{requestUri:QT,returnSecureToken:!0,pendingToken:this.pendingToken}}};var JT="saml.",gs=class n extends pt{constructor(e){V(e.startsWith(JT),"argument-error"),super(e)}static credentialFromResult(e){return n.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return n.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){let t=$n.fromJSON(e);return V(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return $n._create(r,t)}catch{return null}}};var fa=(()=>{class n extends gn{constructor(){super("twitter.com")}static credential(t,r){return ft._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:r})}static credentialFromResult(t){return n.credentialFromTaggedObject(t)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;let{oauthAccessToken:r,oauthTokenSecret:i}=t;if(!r||!i)return null;try{return n.credential(r,i)}catch{return null}}}n.TWITTER_SIGN_IN_METHOD="twitter.com",n.PROVIDER_ID="twitter.com";return n})();function Yg(n,e){return p(this,null,function*(){return $t(n,"POST","/v1/accounts:signUp",ge(n,e))})}var mt=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return p(this,null,function*(){let s=yield Kn._fromIdTokenResponse(e,r,i),o=Ag(r);return new n({user:s,providerId:o,_tokenResponse:r,operationType:t})})}static _forOperation(e,t,r){return p(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=Ag(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})})}};function Ag(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}function Nl(n){return p(this,null,function*(){var e;if(de(n.app))return Promise.reject(Ve(n));let t=ue(n);if(yield t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new mt({user:t.currentUser,providerId:null,operationType:"signIn"});let r=yield Yg(t,{returnSecureToken:!0}),i=yield mt._fromIdTokenResponse(t,"signIn",r,!0);return yield t._updateCurrentUser(i.user),i})}var nl=class n extends Te{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function Xg(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?nl._fromErrorAndOperation(n,s,e,r):s})}function Zg(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}function kl(n,e){return p(this,null,function*(){let t=z(n);yield pa(!0,t,e);let{providerUserInfo:r}=yield dT(t.auth,{idToken:yield t.getIdToken(),deleteProvider:[e]}),i=Zg(r||[]);return t.providerData=t.providerData.filter(s=>i.has(s.providerId)),i.has("phone")||(t.phoneNumber=null),yield t.auth._persistUserIfCurrent(t),t})}function Dl(n,e,t=!1){return p(this,null,function*(){let r=yield Kt(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return mt._forOperation(n,"link",r)})}function pa(n,e,t){return p(this,null,function*(){yield ds(e);let r=Zg(e.providerData),i=n===!1?"provider-already-linked":"no-such-provider";V(r.has(t)===n,e.auth,i)})}function e_(n,e,t=!1){return p(this,null,function*(){let{auth:r}=n;if(de(r.app))return Promise.reject(Ve(r));let i="reauthenticate";try{let s=yield Kt(n,Xg(r,i,e,n),t);V(s.idToken,r,"internal-error");let o=ca(s.idToken);V(o,r,"internal-error");let{sub:c}=o;return V(n.uid===c,r,"user-mismatch"),mt._forOperation(n,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&Se(r,"user-mismatch"),s}})}function t_(n,e,t=!1){return p(this,null,function*(){if(de(n.app))return Promise.reject(Ve(n));let r="signIn",i=yield Xg(n,r,e),s=yield mt._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(s.user)),s})}function jr(n,e){return p(this,null,function*(){return t_(ue(n),e)})}function ma(n,e){return p(this,null,function*(){let t=z(n);return yield pa(!1,t,e.providerId),Dl(t,e)})}function ga(n,e){return p(this,null,function*(){return e_(z(n),e)})}function YT(n,e){return p(this,null,function*(){return $t(n,"POST","/v1/accounts:signInWithCustomToken",ge(n,e))})}function xl(n,e){return p(this,null,function*(){if(de(n.app))return Promise.reject(Ve(n));let t=ue(n),r=yield YT(t,{token:e,returnSecureToken:!0}),i=yield mt._fromIdTokenResponse(t,"signIn",r);return yield t._updateCurrentUser(i.user),i})}var Hn=class{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?rl._fromServerResponse(e,t):"totpInfo"in t?il._fromServerResponse(e,t):Se(e,"internal-error")}},rl=class n extends Hn{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new n(t)}},il=class n extends Hn{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new n(t)}};function _a(n,e,t){var r;V(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),V(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(V(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(V(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}function Ol(n){return p(this,null,function*(){let e=ue(n);e._getPasswordPolicyInternal()&&(yield e._updatePasswordPolicy())})}function Vl(n,e,t){return p(this,null,function*(){let r=ue(n),i={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&_a(r,i,t),yield fs(r,i,"getOobCode",LT)})}function Ll(n,e,t){return p(this,null,function*(){yield Jg(z(n),{oobCode:e,newPassword:t}).catch(r=>p(null,null,function*(){throw r.code==="auth/password-does-not-meet-requirements"&&Ol(n),r}))})}function Ml(n,e){return p(this,null,function*(){yield xT(z(n),{oobCode:e})})}function ya(n,e){return p(this,null,function*(){let t=z(n),r=yield Jg(t,{oobCode:e}),i=r.requestType;switch(V(i,t,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":V(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":V(r.mfaInfo,t,"internal-error");default:V(r.email,t,"internal-error")}let s=null;return r.mfaInfo&&(s=Hn._fromServerResponse(ue(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}})}function Fl(n,e){return p(this,null,function*(){let{data:t}=yield ya(z(n),e);return t.email})}function Ul(n,e,t){return p(this,null,function*(){if(de(n.app))return Promise.reject(Ve(n));let r=ue(n),o=yield fs(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Yg).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&Ol(n),u}),c=yield mt._fromIdTokenResponse(r,"signIn",o);return yield r._updateCurrentUser(c.user),c})}function Bl(n,e,t){return de(n.app)?Promise.reject(Ve(n)):jr(z(n),Ts.credential(e,t)).catch(r=>p(null,null,function*(){throw r.code==="auth/password-does-not-meet-requirements"&&Ol(n),r}))}function ql(n,e,t){return p(this,null,function*(){let r=ue(n),i={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function s(o,c){V(c.handleCodeInApp,r,"argument-error"),c&&_a(r,o,c)}s(i,t),yield fs(r,i,"getOobCode",MT)})}function jl(n,e){let t=ms.parseLink(e);return t?.operation==="EMAIL_SIGNIN"}function zl(n,e,t){return p(this,null,function*(){if(de(n.app))return Promise.reject(Ve(n));let r=z(n),i=Ts.credentialWithLink(e,t||us());return V(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),jr(r,i)})}function XT(n,e){return p(this,null,function*(){return _e(n,"POST","/v1/accounts:createAuthUri",ge(n,e))})}function Gl(n,e){return p(this,null,function*(){let t=bl()?us():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:i}=yield XT(z(n),r);return i||[]})}function Wl(n,e){return p(this,null,function*(){let t=z(n),i={requestType:"VERIFY_EMAIL",idToken:yield n.getIdToken()};e&&_a(t.auth,i,e);let{email:s}=yield VT(t.auth,i);s!==n.email&&(yield n.reload())})}function Kl(n,e,t){return p(this,null,function*(){let r=z(n),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield n.getIdToken(),newEmail:e};t&&_a(r.auth,s,t);let{email:o}=yield FT(r.auth,s);o!==n.email&&(yield n.reload())})}function ZT(n,e){return p(this,null,function*(){return _e(n,"POST","/v1/accounts:update",e)})}function $l(r,i){return p(this,arguments,function*(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;let s=z(n),c={idToken:yield s.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},u=yield Kt(s,ZT(s.auth,c));s.displayName=u.displayName||null,s.photoURL=u.photoUrl||null;let h=s.providerData.find(({providerId:f})=>f==="password");h&&(h.displayName=s.displayName,h.photoURL=s.photoURL),yield s._updateTokensIfNecessary(u)})}function Hl(n,e){let t=z(n);return de(t.auth.app)?Promise.reject(Ve(t.auth)):n_(t,e,null)}function Ql(n,e){return n_(z(n),null,e)}function n_(n,e,t){return p(this,null,function*(){let{auth:r}=n,s={idToken:yield n.getIdToken(),returnSecureToken:!0};e&&(s.email=e),t&&(s.password=t);let o=yield Kt(n,kT(r,s));yield n._updateTokensIfNecessary(o,!0)})}function eA(n){var e,t;if(!n)return null;let{providerId:r}=n,i=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},s=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&n?.idToken){let o=(t=(e=ca(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){let c=o!=="anonymous"&&o!=="custom"?o:null;return new pn(s,c)}}if(!r)return null;switch(r){case"facebook.com":return new sl(s,i);case"github.com":return new ol(s,i);case"google.com":return new al(s,i);case"twitter.com":return new cl(s,i,n.screenName||null);case"custom":case"anonymous":return new pn(s,null);default:return new pn(s,r,i)}}var pn=class{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}},ta=class extends pn{constructor(e,t,r,i){super(e,t,r),this.username=i}},sl=class extends pn{constructor(e,t){super(e,"facebook.com",t)}},ol=class extends ta{constructor(e,t){super(e,"github.com",t,typeof t?.login=="string"?t?.login:null)}},al=class extends pn{constructor(e,t){super(e,"google.com",t)}},cl=class extends ta{constructor(e,t,r){super(e,"twitter.com",t,r)}};function Jl(n){let{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:eA(t)}var na=class n{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new n("enroll",e,t)}static _fromMfaPendingCredential(e){return new n("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e?.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return n._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return n._fromIdtoken(e.multiFactorSession.idToken)}return null}};var ul=class n{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){let r=ue(e),i=t.customData._serverResponse,s=(i.mfaInfo||[]).map(c=>Hn._fromServerResponse(r,c));V(i.mfaPendingCredential,r,"internal-error");let o=na._fromMfaPendingCredential(i.mfaPendingCredential);return new n(o,s,c=>p(null,null,function*(){let u=yield c._process(r,o);delete i.mfaInfo,delete i.mfaPendingCredential;let h=Object.assign(Object.assign({},i),{idToken:u.idToken,refreshToken:u.refreshToken});switch(t.operationType){case"signIn":let f=yield mt._fromIdTokenResponse(r,t.operationType,h);return yield r._updateCurrentUser(f.user),f;case"reauthenticate":return V(t.user,r,"internal-error"),mt._forOperation(t.user,t.operationType,h);default:Se(r,"internal-error")}}))}resolveSignIn(e){return p(this,null,function*(){let t=e;return this.signInResolver(t)})}};function Yl(n,e){var t;let r=z(n),i=e;return V(e.customData.operationType,r,"argument-error"),V((t=i.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),ul._fromError(r,i)}function tA(n,e){return _e(n,"POST","/v2/accounts/mfaEnrollment:start",ge(n,e))}function nA(n,e){return _e(n,"POST","/v2/accounts/mfaEnrollment:finalize",ge(n,e))}function rA(n,e){return _e(n,"POST","/v2/accounts/mfaEnrollment:withdraw",ge(n,e))}var ll=class n{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Hn._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new n(e)}getSession(){return p(this,null,function*(){return na._fromIdtoken(yield this.user.getIdToken(),this.user)})}enroll(e,t){return p(this,null,function*(){let r=e,i=yield this.getSession(),s=yield Kt(this.user,r._process(this.user.auth,i,t));return yield this.user._updateTokensIfNecessary(s),this.user.reload()})}unenroll(e){return p(this,null,function*(){let t=typeof e=="string"?e:e.uid,r=yield this.user.getIdToken();try{let i=yield Kt(this.user,rA(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:s})=>s!==t),yield this.user._updateTokensIfNecessary(i),yield this.user.reload()}catch(i){throw i}})}},$u=new WeakMap;function Xl(n){let e=z(n);return $u.has(e)||$u.set(e,ll._fromUser(e)),$u.get(e)}var ra="__sak";var ia=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ra,"1"),this.storage.removeItem(ra),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var iA=1e3,sA=10,oA=(()=>{class n extends ia{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=$g(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),s=this.localCache[r];i!==s&&t(r,s,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((c,u,h)=>{this.notifyListeners(c,h)});return}let i=t.key;r?this.detachListener():this.stopPolling();let s=()=>{let c=this.storage.getItem(i);!r&&this.localCache[i]===c||this.notifyListeners(i,c)},o=this.storage.getItem(i);vT()&&o!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,sA):s()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},iA)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return p(this,null,function*(){yield wt(n.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return p(this,null,function*(){let r=yield wt(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return p(this,null,function*(){yield wt(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),zr=oA;var aA=(()=>{class n extends ia{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),Pt=aA;function cA(n){return Promise.all(n.map(e=>p(null,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var uA=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(s=>s.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return p(this,null,function*(){let r=t,{eventId:i,eventType:s,data:o}=r.data,c=this.handlersMap[s];if(!c?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:s});let u=Array.from(c).map(f=>p(this,null,function*(){return f(r.origin,o)})),h=yield cA(u);r.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:h})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function Yn(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var hl=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){return p(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((c,u)=>{let h=Yn("",20);i.port1.start();let f=setTimeout(()=>{u(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(m){let _=m;if(_.data.eventId===h)switch(_.data.status){case"ack":clearTimeout(f),s=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),c(_.data.response);break;default:clearTimeout(f),clearTimeout(s),u(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};function Ae(){return window}function lA(n){Ae().location.href=n}function Zl(){return typeof Ae().WorkerGlobalScope<"u"&&typeof Ae().importScripts=="function"}function hA(){return p(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function dA(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function fA(){return Zl()?self:null}var r_="firebaseLocalStorageDb",pA=1,sa="firebaseLocalStorage",i_="fbase_key",Qn=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function va(n,e){return n.transaction([sa],e?"readwrite":"readonly").objectStore(sa)}function mA(){let n=indexedDB.deleteDatabase(r_);return new Qn(n).toPromise()}function dl(){let n=indexedDB.open(r_,pA);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(sa,{keyPath:i_})}catch(i){t(i)}}),n.addEventListener("success",()=>p(null,null,function*(){let r=n.result;r.objectStoreNames.contains(sa)?e(r):(r.close(),yield mA(),e(yield dl()))}))})}function bg(n,e,t){return p(this,null,function*(){let r=va(n,!0).put({[i_]:e,value:t});return new Qn(r).toPromise()})}function gA(n,e){return p(this,null,function*(){let t=va(n,!1).get(e),r=yield new Qn(t).toPromise();return r===void 0?null:r.value})}function Sg(n,e){let t=va(n,!0).delete(e);return new Qn(t).toPromise()}var _A=800,yA=3,vA=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return p(this,null,function*(){return this.db?this.db:(this.db=yield dl(),this.db)})}_withRetries(t){return p(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(r++>yA)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return p(this,null,function*(){return Zl()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return p(this,null,function*(){this.receiver=uA._getInstance(fA()),this.receiver._subscribe("keyChanged",(t,r)=>p(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>p(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return p(this,null,function*(){var t,r;if(this.activeServiceWorker=yield hA(),!this.activeServiceWorker)return;this.sender=new hl(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((t=i[0])===null||t===void 0)&&t.fulfilled&&!((r=i[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return p(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||dA()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return p(this,null,function*(){try{if(!indexedDB)return!1;let t=yield dl();return yield bg(t,ra,"1"),yield Sg(t,ra),!0}catch{}return!1})}_withPendingWrite(t){return p(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return p(this,null,function*(){return this._withPendingWrite(()=>p(this,null,function*(){return yield this._withRetries(i=>bg(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return p(this,null,function*(){let r=yield this._withRetries(i=>gA(i,t));return this.localCache[t]=r,r})}_remove(t){return p(this,null,function*(){return this._withPendingWrite(()=>p(this,null,function*(){return yield this._withRetries(r=>Sg(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return p(this,null,function*(){let t=yield this._withRetries(s=>{let o=va(s,!1).getAll();return new Qn(o).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:s,value:o}of t)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),r.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r})}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>p(this,null,function*(){return this._poll()}),_A)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),Xn=vA;function IA(n,e){return _e(n,"POST","/v2/accounts/mfaSignIn:start",ge(n,e))}function wA(n,e){return _e(n,"POST","/v2/accounts/mfaSignIn:finalize",ge(n,e))}var EA=500,TA=6e4,Ho=1e12,fl=class{constructor(e){this.auth=e,this.counter=Ho,this._widgets=new Map}render(e,t){let r=this.counter;return this._widgets.set(r,new pl(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;let r=e||Ho;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;let r=e||Ho;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}execute(e){return p(this,null,function*(){var t;let r=e||Ho;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""})}},pl=class{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};let i=typeof e=="string"?document.getElementById(e):e;V(i,"argument-error",{appName:t}),this.container=i,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=AA(50);let{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},TA)},EA))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}};function AA(n){let e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}var Hu=Hg("rcb"),bA=new Wn(3e4,6e4),ml=class{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Ae().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return V(SA(t),e,"argument-error"),this.shouldResolveImmediately(t)&&_g(Ae().grecaptcha)?Promise.resolve(Ae().grecaptcha):new Promise((r,i)=>{let s=Ae().setTimeout(()=>{i(be(e,"network-request-failed"))},bA.get());Ae()[Hu]=()=>{Ae().clearTimeout(s),delete Ae()[Hu];let c=Ae().grecaptcha;if(!c||!_g(c)){i(be(e,"internal-error"));return}let u=c.render;c.render=(h,f)=>{let m=u(h,f);return this.counter++,m},this.hostLanguage=t,r(c)};let o=`${TT()}?${zn({onload:Hu,render:"explicit",hl:t})}`;Pl(o).catch(()=>{clearTimeout(s),i(be(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Ae().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}};function SA(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}var gl=class{load(e){return p(this,null,function*(){return new fl(e)})}clearedOneInstance(){}};var s_="recaptcha",RA={theme:"light",type:"image"},_s=class{constructor(e,t,r=Object.assign({},RA)){this.parameters=r,this.type=s_,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ue(e),this.isInvisible=this.parameters.size==="invisible",V(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");let i=typeof t=="string"?document.getElementById(t):t;V(i,this.auth,"argument-error"),this.container=i,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new gl:new ml,this.validateStartingState()}verify(){return p(this,null,function*(){this.assertNotDestroyed();let e=yield this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(i=>{let s=o=>{o&&(this.tokenChangeListeners.delete(s),i(o))};this.tokenChangeListeners.add(s),this.isInvisible&&t.execute(e)})})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){V(!this.parameters.sitekey,this.auth,"argument-error"),V(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),V(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){let r=Ae()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){V(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){return p(this,null,function*(){if(yield this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){let t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId})}init(){return p(this,null,function*(){V(bl()&&!Zl(),this.auth,"internal-error"),yield PA(),this.recaptcha=yield this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);let e=yield uT(this.auth);V(e,this.auth,"internal-error"),this.parameters.sitekey=e})}getAssertedRecaptcha(){return V(this.recaptcha,this.auth,"internal-error"),this.recaptcha}};function PA(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}var ys=class{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){let t=Mr._fromVerification(this.verificationId,e);return this.onConfirmation(t)}};function eh(n,e,t){return p(this,null,function*(){if(de(n.app))return Promise.reject(Ve(n));let r=ue(n),i=yield Ia(r,e,z(t));return new ys(i,s=>jr(r,s))})}function th(n,e,t){return p(this,null,function*(){let r=z(n);yield pa(!1,r,"phone");let i=yield Ia(r.auth,e,z(t));return new ys(i,s=>ma(r,s))})}function nh(n,e,t){return p(this,null,function*(){let r=z(n);if(de(r.auth.app))return Promise.reject(Ve(r.auth));let i=yield Ia(r.auth,e,z(t));return new ys(i,s=>ga(r,s))})}function Ia(n,e,t){return p(this,null,function*(){var r;let i=yield t.verify();try{V(typeof i=="string",n,"argument-error"),V(t.type===s_,n,"argument-error");let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){let o=s.session;if("phoneNumber"in s)return V(o.type==="enroll",n,"internal-error"),(yield tA(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}})).phoneSessionInfo.sessionInfo;{V(o.type==="signin",n,"internal-error");let c=((r=s.multiFactorHint)===null||r===void 0?void 0:r.uid)||s.multiFactorUid;return V(c,n,"missing-multi-factor-info"),(yield IA(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:c,phoneSignInInfo:{recaptchaToken:i}})).phoneResponseInfo.sessionInfo}}else{let{sessionInfo:o}=yield jT(n,{phoneNumber:s.phoneNumber,recaptchaToken:i});return o}}finally{t._reset()}})}function rh(n,e){return p(this,null,function*(){let t=z(n);if(de(t.auth.app))return Promise.reject(Ve(t.auth));yield Dl(t,e)})}var Zn=(()=>{class n{constructor(t){this.providerId=n.PROVIDER_ID,this.auth=ue(t)}verifyPhoneNumber(t,r){return Ia(this.auth,t,z(r))}static credential(t,r){return Mr._fromVerification(t,r)}static credentialFromResult(t){let r=t;return n.credentialFromTaggedObject(r)}static credentialFromError(t){return n.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;let{phoneNumber:r,temporaryProof:i}=t;return r&&i?Mr._fromTokenResponse(r,i):null}}n.PROVIDER_ID="phone",n.PHONE_SIGN_IN_METHOD="phone";return n})();function er(n,e){return e?ze(e):(V(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var vs=class extends Rt{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Wt(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Wt(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Wt(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function CA(n){return t_(n.auth,new vs(n),n.bypassAuthState)}function NA(n){let{auth:e,user:t}=n;return V(t,e,"internal-error"),e_(t,new vs(n),n.bypassAuthState)}function kA(n){return p(this,null,function*(){let{auth:e,user:t}=n;return V(t,e,"internal-error"),Dl(t,new vs(n),n.bypassAuthState)})}var oa=class{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>p(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return p(this,null,function*(){let{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:o,type:c}=e;if(o){this.reject(o);return}let u={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(c)(u))}catch(h){this.reject(h)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return CA;case"linkViaPopup":case"linkViaRedirect":return kA;case"reauthViaPopup":case"reauthViaRedirect":return NA;default:Se(this.auth,"internal-error")}}resolve(e){ot(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ot(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var DA=new Wn(2e3,1e4);function ih(n,e,t){return p(this,null,function*(){if(de(n.app))return Promise.reject(be(n,"operation-not-supported-in-this-environment"));let r=ue(n);Ur(n,e,pt);let i=er(r,t);return new ah(r,"signInViaPopup",e,i).executeNotNull()})}function sh(n,e,t){return p(this,null,function*(){let r=z(n);if(de(r.auth.app))return Promise.reject(be(r.auth,"operation-not-supported-in-this-environment"));Ur(r.auth,e,pt);let i=er(r.auth,t);return new ah(r.auth,"reauthViaPopup",e,i,r).executeNotNull()})}function oh(n,e,t){return p(this,null,function*(){let r=z(n);Ur(r.auth,e,pt);let i=er(r.auth,t);return new ah(r.auth,"linkViaPopup",e,i,r).executeNotNull()})}var ah=(()=>{class n extends oa{constructor(t,r,i,s,o){super(t,r,s,o),this.provider=i,this.authWindow=null,this.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=this}executeNotNull(){return p(this,null,function*(){let t=yield this.execute();return V(t,this.auth,"internal-error"),t})}onExecution(){return p(this,null,function*(){ot(this.filter.length===1,"Popup operations only handle one event");let t=Yn();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(be(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(be(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}pollUserCancellation(){let t=()=>{var r,i;if(!((i=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(be(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,DA.get())};t()}}n.currentPopupAction=null;return n})(),xA="pendingRedirect",cs=new Map,_l=class n extends oa{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){return p(this,null,function*(){let e=cs.get(this.auth._key());if(!e){try{let r=(yield OA(this.resolver,this.auth))?yield wt(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}cs.set(this.auth._key(),e)}return this.bypassAuthState||cs.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return p(this,null,function*(){if(e.type==="signInViaRedirect")return wt(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,wt(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return p(this,null,function*(){})}cleanUp(){}};function OA(n,e){return p(this,null,function*(){let t=c_(e),r=a_(n);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(t))==="true";return yield r._remove(t),i})}function ch(n,e){return p(this,null,function*(){return a_(n)._set(c_(e),"true")})}function o_(){cs.clear()}function Gr(n,e){cs.set(n._key(),e)}function a_(n){return ze(n._redirectPersistence)}function c_(n){return St(xA,n.config.apiKey,n.name)}function uh(n,e,t){return VA(n,e,t)}function VA(n,e,t){return p(this,null,function*(){if(de(n.app))return Promise.reject(Ve(n));let r=ue(n);Ur(n,e,pt),yield r._initializationPromise;let i=er(r,t);return yield ch(i,r),i._openRedirect(r,e,"signInViaRedirect")})}function lh(n,e,t){return LA(n,e,t)}function LA(n,e,t){return p(this,null,function*(){let r=z(n);if(Ur(r.auth,e,pt),de(r.auth.app))return Promise.reject(Ve(r.auth));yield r.auth._initializationPromise;let i=er(r.auth,t);yield ch(i,r.auth);let s=yield u_(r);return i._openRedirect(r.auth,e,"reauthViaRedirect",s)})}function hh(n,e,t){return MA(n,e,t)}function MA(n,e,t){return p(this,null,function*(){let r=z(n);Ur(r.auth,e,pt),yield r.auth._initializationPromise;let i=er(r.auth,t);yield pa(!1,r,e.providerId),yield ch(i,r.auth);let s=yield u_(r);return i._openRedirect(r.auth,e,"linkViaRedirect",s)})}function dh(n,e){return p(this,null,function*(){return yield ue(n)._initializationPromise,tr(n,e,!1)})}function tr(n,e,t=!1){return p(this,null,function*(){if(de(n.app))return Promise.reject(Ve(n));let r=ue(n),i=er(r,e),o=yield new _l(r,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield r._persistUserIfCurrent(o.user),yield r._setRedirectUser(null,e)),o})}function u_(n){return p(this,null,function*(){let e=Yn(`${n.uid}:::`);return n._redirectEventId=e,yield n.auth._setRedirectUser(n),yield n.auth._persistUserIfCurrent(n),e})}var FA=600*1e3,Is=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!UA(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!l_(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(be(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=FA&&this.cachedEventUids.clear(),this.cachedEventUids.has(Rg(e))}saveEventToCache(e){this.cachedEventUids.add(Rg(e)),this.lastProcessedEventTime=Date.now()}};function Rg(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function l_({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function UA(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return l_(n);default:return!1}}function fh(t){return p(this,arguments,function*(n,e={}){return _e(n,"GET","/v1/projects",e)})}var BA=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,qA=/^https?/;function jA(n){return p(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield fh(n);for(let t of e)try{if(zA(t))return}catch{}Se(n,"unauthorized-domain")})}function zA(n){let e=us(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!qA.test(t))return!1;if(BA.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var GA=new Wn(3e4,6e4);function Pg(){let n=Ae().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function WA(n){return new Promise((e,t)=>{var r,i,s;function o(){Pg(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Pg(),t(be(n,"network-request-failed"))},timeout:GA.get()})}if(!((i=(r=Ae().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=Ae().gapi)===null||s===void 0)&&s.load)o();else{let c=Hg("iframefcb");return Ae()[c]=()=>{gapi.load?o():t(be(n,"network-request-failed"))},Pl(`${bT()}?onload=${c}`).catch(u=>t(u))}}).catch(e=>{throw Jo=null,e})}var Jo=null;function KA(n){return Jo=Jo||WA(n),Jo}var $A=new Wn(5e3,15e3),HA="__/auth/iframe",QA="emulator/auth/iframe",JA={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},YA=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function XA(n){let e=n.config;V(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?Sl(e,QA):`https://${n.config.authDomain}/${HA}`,r={apiKey:e.apiKey,appName:n.name,v:dt},i=YA.get(n.config.apiHost);i&&(r.eid=i);let s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${zn(r).slice(1)}`}function ZA(n){return p(this,null,function*(){let e=yield KA(n),t=Ae().gapi;return V(t,n,"internal-error"),e.open({where:document.body,url:XA(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:JA,dontclear:!0},r=>new Promise((i,s)=>p(null,null,function*(){yield r.restyle({setHideOnLeave:!1});let o=be(n,"network-request-failed"),c=Ae().setTimeout(()=>{s(o)},$A.get());function u(){Ae().clearTimeout(c),i(r)}r.ping(u).then(u,()=>{s(o)})})))})}var eb={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},tb=500,nb=600,rb="_blank",ib="http://localhost",ws=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function sb(n,e,t,r=tb,i=nb){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),c="",u=Object.assign(Object.assign({},eb),{width:r.toString(),height:i.toString(),top:s,left:o}),h=oe().toLowerCase();t&&(c=jg(h)?rb:t),Bg(h)&&(e=e||ib,u.scrollbars="yes");let f=Object.entries(u).reduce((_,[b,k])=>`${_}${b}=${k},`,"");if(yT(h)&&c!=="_self")return ob(e||"",c),new ws(null);let m=window.open(e||"",c,f);V(m,n,"popup-blocked");try{m.focus()}catch{}return new ws(m)}function ob(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var ab="__/auth/handler",cb="emulator/auth/handler",ub=encodeURIComponent("fac");function aa(n,e,t,r,i,s){return p(this,null,function*(){V(n.config.authDomain,n,"auth-domain-config-required"),V(n.config.apiKey,n,"invalid-api-key");let o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:dt,eventId:i};if(e instanceof pt){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Qm(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[f,m]of Object.entries(s||{}))o[f]=m}if(e instanceof gn){let f=e.getScopes().filter(m=>m!=="");f.length>0&&(o.scopes=f.join(","))}n.tenantId&&(o.tid=n.tenantId);let c=o;for(let f of Object.keys(c))c[f]===void 0&&delete c[f];let u=yield n._getAppCheckToken(),h=u?`#${ub}=${encodeURIComponent(u)}`:"";return`${lb(n)}?${zn(c).slice(1)}${h}`})}function lb({config:n}){return n.emulator?Sl(n,cb):`https://${n.authDomain}/${ab}`}var Qu="webStorageSupport",yl=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Pt,this._completeRedirectFn=tr,this._overrideRedirectResult=Gr}_openPopup(e,t,r,i){return p(this,null,function*(){var s;ot((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");let o=yield aa(e,t,r,us(),i);return sb(e,o,Yn())})}_openRedirect(e,t,r,i){return p(this,null,function*(){yield this._originValidation(e);let s=yield aa(e,t,r,us(),i);return lA(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(ot(s,"If manager is not set, promise should be"),s)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){return p(this,null,function*(){let t=yield ZA(e),r=new Is(e);return t.register("authEvent",i=>(V(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Qu,{type:Qu},i=>{var s;let o=(s=i?.[0])===null||s===void 0?void 0:s[Qu];o!==void 0&&t(!!o),Se(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=jA(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return $g()||qg()||qr()}},ph=yl,vl=class{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return bt("unexpected MultiFactorSessionType")}}},Il=class n extends vl{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new n(e)}_finalizeEnroll(e,t,r){return nA(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return wA(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}},mh=(()=>{class n{constructor(){}static assertion(t){return Il._fromCredential(t)}}return n.FACTOR_ID="phone",n})();var Cg="@firebase/auth",Ng="1.7.9";var wl=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return p(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){V(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function hb(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function db(n){ht(new xe("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=r.options;V(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});let u={apiKey:o,authDomain:c,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Rl(n)},h=new Zo(r,i,s,u);return PT(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),ht(new xe("auth-internal",e=>{let t=ue(e.getProvider("auth").getImmediate());return(r=>new wl(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),He(Cg,Ng,hb(n)),He(Cg,Ng,"esm2017")}var fb=300,OR=zm("authIdTokenMaxAge")||fb;function pb(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}ET({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let s=be("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",pb().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});db("Browser");function nr(){return window}var mb=2e3;function gb(n,e,t){return p(this,null,function*(){var r;let{BuildInfo:i}=nr();ot(e.sessionId,"AuthEvent did not contain a session ID");let s=yield wb(e.sessionId),o={};return qr()?o.ibi=i.packageName:Br()?o.apn=i.packageName:Se(n,"operation-not-supported-in-this-environment"),i.displayName&&(o.appDisplayName=i.displayName),o.sessionId=s,aa(n,t,e.type,void 0,(r=e.eventId)!==null&&r!==void 0?r:void 0,o)})}function _b(n){return p(this,null,function*(){let{BuildInfo:e}=nr(),t={};qr()?t.iosBundleId=e.packageName:Br()?t.androidPackageName=e.packageName:Se(n,"operation-not-supported-in-this-environment"),yield fh(n,t)})}function yb(n){let{cordova:e}=nr();return new Promise(t=>{e.plugins.browsertab.isAvailable(r=>{let i=null;r?e.plugins.browsertab.openUrl(n):i=e.InAppBrowser.open(n,Kg()?"_blank":"_system","location=yes"),t(i)})})}function vb(n,e,t){return p(this,null,function*(){let{cordova:r}=nr(),i=()=>{};try{yield new Promise((s,o)=>{let c=null;function u(){var m;s();let _=(m=r.plugins.browsertab)===null||m===void 0?void 0:m.close;typeof _=="function"&&_(),typeof t?.close=="function"&&t.close()}function h(){c||(c=window.setTimeout(()=>{o(be(n,"redirect-cancelled-by-user"))},mb))}function f(){document?.visibilityState==="visible"&&h()}e.addPassiveListener(u),document.addEventListener("resume",h,!1),Br()&&document.addEventListener("visibilitychange",f,!1),i=()=>{e.removePassiveListener(u),document.removeEventListener("resume",h,!1),document.removeEventListener("visibilitychange",f,!1),c&&window.clearTimeout(c)}})}finally{i()}})}function Ib(n){var e,t,r,i,s,o,c,u,h,f;let m=nr();V(typeof((e=m?.universalLinks)===null||e===void 0?void 0:e.subscribe)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),V(typeof((t=m?.BuildInfo)===null||t===void 0?void 0:t.packageName)<"u",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),V(typeof((s=(i=(r=m?.cordova)===null||r===void 0?void 0:r.plugins)===null||i===void 0?void 0:i.browsertab)===null||s===void 0?void 0:s.openUrl)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),V(typeof((u=(c=(o=m?.cordova)===null||o===void 0?void 0:o.plugins)===null||c===void 0?void 0:c.browsertab)===null||u===void 0?void 0:u.isAvailable)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),V(typeof((f=(h=m?.cordova)===null||h===void 0?void 0:h.InAppBrowser)===null||f===void 0?void 0:f.open)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}function wb(n){return p(this,null,function*(){let e=Eb(n),t=yield crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(i=>i.toString(16).padStart(2,"0")).join("")})}function Eb(n){if(ot(/[0-9a-zA-Z]+/.test(n),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return new TextEncoder().encode(n);let e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}var Tb=20,gh=class extends Is{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInitialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInitialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}initialized(){return p(this,null,function*(){yield this.initPromise})}};function Ab(n,e,t=null){return{type:e,eventId:t,urlResponse:null,sessionId:Rb(),postBody:null,tenantId:n.tenantId,error:be(n,"no-auth-event")}}function bb(n,e){return _h()._set(yh(n),e)}function h_(n){return p(this,null,function*(){let e=yield _h()._get(yh(n));return e&&(yield _h()._remove(yh(n))),e})}function Sb(n,e){var t,r;let i=Cb(e);if(i.includes("/__/auth/callback")){let s=wa(i),o=s.firebaseError?Pb(decodeURIComponent(s.firebaseError)):null,c=(r=(t=o?.code)===null||t===void 0?void 0:t.split("auth/"))===null||r===void 0?void 0:r[1],u=c?be(c):null;return u?{type:n.type,eventId:n.eventId,tenantId:n.tenantId,error:u,urlResponse:null,sessionId:null,postBody:null}:{type:n.type,eventId:n.eventId,tenantId:n.tenantId,sessionId:n.sessionId,urlResponse:i,postBody:null}}return null}function Rb(){let n=[],e="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let t=0;t<Tb;t++){let r=Math.floor(Math.random()*e.length);n.push(e.charAt(r))}return n.join("")}function _h(){return ze(zr)}function yh(n){return St("authEvent",n.config.apiKey,n.name)}function Pb(n){try{return JSON.parse(n)}catch{return null}}function Cb(n){let e=wa(n),t=e.link?decodeURIComponent(e.link):void 0,r=wa(t).link,i=e.deep_link_id?decodeURIComponent(e.deep_link_id):void 0;return wa(i).link||i||r||t||n}function wa(n){if(!n?.includes("?"))return{};let[e,...t]=n.split("?");return hn(t.join("?"))}var Nb=500,vh=class{constructor(){this._redirectPersistence=Pt,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=tr,this._overrideRedirectResult=Gr}_initialize(e){return p(this,null,function*(){let t=e._key(),r=this.eventManagers.get(t);return r||(r=new gh(e),this.eventManagers.set(t,r),this.attachCallbackListeners(e,r)),r})}_openPopup(e){Se(e,"operation-not-supported-in-this-environment")}_openRedirect(e,t,r,i){return p(this,null,function*(){Ib(e);let s=yield this._initialize(e);yield s.initialized(),s.resetRedirect(),o_(),yield this._originValidation(e);let o=Ab(e,r,i);yield bb(e,o);let c=yield gb(e,o,t),u=yield yb(c);return vb(e,s,u)})}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=_b(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){let{universalLinks:r,handleOpenURL:i,BuildInfo:s}=nr(),o=setTimeout(()=>p(null,null,function*(){yield h_(e),t.onEvent(d_())}),Nb),c=f=>p(null,null,function*(){clearTimeout(o);let m=yield h_(e),_=null;m&&f?.url&&(_=Sb(m,f.url)),t.onEvent(_||d_())});typeof r<"u"&&typeof r.subscribe=="function"&&r.subscribe(null,c);let u=i,h=`${s.packageName.toLowerCase()}://`;nr().handleOpenURL=f=>p(null,null,function*(){if(f.toLowerCase().startsWith(h)&&c({url:f}),typeof u=="function")try{u(f)}catch(m){console.error(m)}})}},f_=vh;function d_(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:be("no-auth-event")}}function p_(n,e){ue(n)._logFramework(e)}var Db="@firebase/auth-compat",xb="0.5.14";var Ob=1e3;function Ss(){var n;return((n=self?.location)===null||n===void 0?void 0:n.protocol)||null}function Vb(){return Ss()==="http:"||Ss()==="https:"}function __(n=oe()){return!!((Ss()==="file:"||Ss()==="ionic:"||Ss()==="capacitor:")&&n.toLowerCase().match(/iphone|ipad|ipod|android/))}function Lb(){return ns()||Fo()}function Mb(){return Bo()&&document?.documentMode===11}function Fb(n=oe()){return/Edge\/\d+/.test(n)}function Ub(n=oe()){return Mb()||Fb(n)}function y_(){try{let n=self.localStorage,e=Yn();if(n)return n.setItem(e,"1"),n.removeItem(e),Ub()?un():!0}catch{return bh()&&un()}return!1}function bh(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function Ih(){return(Vb()||Uo()||__())&&!Lb()&&y_()&&!bh()}function v_(){return __()&&typeof document<"u"}function Bb(){return p(this,null,function*(){return v_()?new Promise(n=>{let e=setTimeout(()=>{n(!1)},Ob);document.addEventListener("deviceready",()=>{clearTimeout(e),n(!0)})}):!1})}function qb(){return typeof window<"u"?window:null}var tt={LOCAL:"local",NONE:"none",SESSION:"session"},As=V,I_="persistence";function jb(n,e){if(As(Object.values(tt).includes(e),n,"invalid-persistence-type"),ns()){As(e!==tt.SESSION,n,"unsupported-persistence-type");return}if(Fo()){As(e===tt.NONE,n,"unsupported-persistence-type");return}if(bh()){As(e===tt.NONE||e===tt.LOCAL&&un(),n,"unsupported-persistence-type");return}As(e===tt.NONE||y_(),n,"unsupported-persistence-type")}function wh(n){return p(this,null,function*(){yield n._initializationPromise;let e=w_(),t=St(I_,n.config.apiKey,n.name);e&&e.setItem(t,n._getPersistence())})}function zb(n,e){let t=w_();if(!t)return[];let r=St(I_,n,e);switch(t.getItem(r)){case tt.NONE:return[mn];case tt.LOCAL:return[Xn,Pt];case tt.SESSION:return[Pt];default:return[]}}function w_(){var n;try{return((n=qb())===null||n===void 0?void 0:n.sessionStorage)||null}catch{return null}}var Gb=V,Ct=class{constructor(){this.browserResolver=ze(ph),this.cordovaResolver=ze(f_),this.underlyingResolver=null,this._redirectPersistence=Pt,this._completeRedirectFn=tr,this._overrideRedirectResult=Gr}_initialize(e){return p(this,null,function*(){return yield this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)})}_openPopup(e,t,r,i){return p(this,null,function*(){return yield this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,r,i)})}_openRedirect(e,t,r,i){return p(this,null,function*(){return yield this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,r,i)})}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return v_()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Gb(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){return p(this,null,function*(){if(this.underlyingResolver)return;let e=yield Bb();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver})}};function E_(n){return n.unwrap()}function Wb(n){return n.wrapped()}function Kb(n){return T_(n)}function $b(n,e){var t;let r=(t=e.customData)===null||t===void 0?void 0:t._tokenResponse;if(e?.code==="auth/multi-factor-auth-required"){let i=e;i.resolver=new Th(n,Yl(n,e))}else if(r){let i=T_(e),s=e;i&&(s.credential=i,s.tenantId=r.tenantId||void 0,s.email=r.email||void 0,s.phoneNumber=r.phoneNumber||void 0)}}function T_(n){let{_tokenResponse:e}=n instanceof Te?n.customData:n;if(!e)return null;if(!(n instanceof Te)&&"temporaryProof"in e&&"phoneNumber"in e)return Zn.credentialFromResult(n);let t=e.providerId;if(!t||t===Jn.PASSWORD)return null;let r;switch(t){case Jn.GOOGLE:r=ha;break;case Jn.FACEBOOK:r=la;break;case Jn.GITHUB:r=da;break;case Jn.TWITTER:r=fa;break;default:let{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:o,pendingToken:c,nonce:u}=e;return!s&&!o&&!i&&!c?null:c?t.startsWith("saml.")?$n._create(t,c):ft._fromParams({providerId:t,signInMethod:t,pendingToken:c,idToken:i,accessToken:s}):new Fr(t).credential({idToken:i,accessToken:s,rawNonce:u})}return n instanceof Te?r.credentialFromError(n):r.credentialFromResult(n)}function Xe(n,e){return e.catch(t=>{throw t instanceof Te&&$b(n,t),t}).then(t=>{let r=t.operationType,i=t.user;return{operationType:r,credential:Kb(t),additionalUserInfo:Jl(t),user:Wr.getOrCreate(i)}})}function Eh(n,e){return p(this,null,function*(){let t=yield e;return{verificationId:t.verificationId,confirm:r=>Xe(n,t.confirm(r))}})}var Th=class{constructor(e,t){this.resolver=t,this.auth=Wb(e)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Xe(E_(this.auth),this.resolver.resolveSignIn(e))}};var Wr=class n{constructor(e){this._delegate=e,this.multiFactor=Xl(e)}static getOrCreate(e){return n.USER_MAP.has(e)||n.USER_MAP.set(e,new n(e)),n.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}linkWithCredential(e){return p(this,null,function*(){return Xe(this.auth,ma(this._delegate,e))})}linkWithPhoneNumber(e,t){return p(this,null,function*(){return Eh(this.auth,th(this._delegate,e,t))})}linkWithPopup(e){return p(this,null,function*(){return Xe(this.auth,oh(this._delegate,e,Ct))})}linkWithRedirect(e){return p(this,null,function*(){return yield wh(ue(this.auth)),hh(this._delegate,e,Ct)})}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}reauthenticateWithCredential(e){return p(this,null,function*(){return Xe(this.auth,ga(this._delegate,e))})}reauthenticateWithPhoneNumber(e,t){return Eh(this.auth,nh(this._delegate,e,t))}reauthenticateWithPopup(e){return Xe(this.auth,sh(this._delegate,e,Ct))}reauthenticateWithRedirect(e){return p(this,null,function*(){return yield wh(ue(this.auth)),lh(this._delegate,e,Ct)})}sendEmailVerification(e){return Wl(this._delegate,e)}unlink(e){return p(this,null,function*(){return yield kl(this._delegate,e),this})}updateEmail(e){return Hl(this._delegate,e)}updatePassword(e){return Ql(this._delegate,e)}updatePhoneNumber(e){return rh(this._delegate,e)}updateProfile(e){return $l(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return Kl(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}};Wr.USER_MAP=new WeakMap;var bs=V,m_=(()=>{class n{constructor(t,r){if(this.app=t,r.isInitialized()){this._delegate=r.getImmediate(),this.linkUnderlyingAuth();return}let{apiKey:i}=t.options;bs(i,"invalid-api-key",{appName:t.name}),bs(i,"invalid-api-key",{appName:t.name});let s=typeof window<"u"?Ct:void 0;this._delegate=r.initialize({options:{persistence:Hb(i,t.name),popupRedirectResolver:s}}),this._delegate._updateErrorMap(El),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Wr.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(t){this._delegate.languageCode=t}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(t){this._delegate.tenantId=t}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(t,r){Cl(this._delegate,t,r)}applyActionCode(t){return Ml(this._delegate,t)}checkActionCode(t){return ya(this._delegate,t)}confirmPasswordReset(t,r){return Ll(this._delegate,t,r)}createUserWithEmailAndPassword(t,r){return p(this,null,function*(){return Xe(this._delegate,Ul(this._delegate,t,r))})}fetchProvidersForEmail(t){return this.fetchSignInMethodsForEmail(t)}fetchSignInMethodsForEmail(t){return Gl(this._delegate,t)}isSignInWithEmailLink(t){return jl(this._delegate,t)}getRedirectResult(){return p(this,null,function*(){bs(Ih(),this._delegate,"operation-not-supported-in-this-environment");let t=yield dh(this._delegate,Ct);return t?Xe(this._delegate,Promise.resolve(t)):{credential:null,user:null}})}addFrameworkForLogging(t){p_(this._delegate,t)}onAuthStateChanged(t,r,i){let{next:s,error:o,complete:c}=g_(t,r,i);return this._delegate.onAuthStateChanged(s,o,c)}onIdTokenChanged(t,r,i){let{next:s,error:o,complete:c}=g_(t,r,i);return this._delegate.onIdTokenChanged(s,o,c)}sendSignInLinkToEmail(t,r){return ql(this._delegate,t,r)}sendPasswordResetEmail(t,r){return Vl(this._delegate,t,r||void 0)}setPersistence(t){return p(this,null,function*(){jb(this._delegate,t);let r;switch(t){case tt.SESSION:r=Pt;break;case tt.LOCAL:r=(yield ze(Xn)._isAvailable())?Xn:zr;break;case tt.NONE:r=mn;break;default:return Se("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(r)})}signInAndRetrieveDataWithCredential(t){return this.signInWithCredential(t)}signInAnonymously(){return Xe(this._delegate,Nl(this._delegate))}signInWithCredential(t){return Xe(this._delegate,jr(this._delegate,t))}signInWithCustomToken(t){return Xe(this._delegate,xl(this._delegate,t))}signInWithEmailAndPassword(t,r){return Xe(this._delegate,Bl(this._delegate,t,r))}signInWithEmailLink(t,r){return Xe(this._delegate,zl(this._delegate,t,r))}signInWithPhoneNumber(t,r){return Eh(this._delegate,eh(this._delegate,t,r))}signInWithPopup(t){return p(this,null,function*(){return bs(Ih(),this._delegate,"operation-not-supported-in-this-environment"),Xe(this._delegate,ih(this._delegate,t,Ct))})}signInWithRedirect(t){return p(this,null,function*(){return bs(Ih(),this._delegate,"operation-not-supported-in-this-environment"),yield wh(this._delegate),uh(this._delegate,t,Ct)})}updateCurrentUser(t){return this._delegate.updateCurrentUser(t)}verifyPasswordResetCode(t){return Fl(this._delegate,t)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return n.Persistence=tt,n})();function g_(n,e,t){let r=n;typeof n!="function"&&({next:r,error:e,complete:t}=n);let i=r;return{next:o=>i(o&&Wr.getOrCreate(o)),error:e,complete:t}}function Hb(n,e){let t=zb(n,e);if(typeof self<"u"&&!t.includes(Xn)&&t.push(Xn),typeof window<"u")for(let r of[zr,Pt])t.includes(r)||t.push(r);return t.includes(mn)||t.push(mn),t}var Rs=class{constructor(){this.providerId="phone",this._delegate=new Zn(E_(Oe.auth()))}static credential(e,t){return Zn.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}};Rs.PHONE_SIGN_IN_METHOD=Zn.PHONE_SIGN_IN_METHOD;Rs.PROVIDER_ID=Zn.PROVIDER_ID;var Qb=V,Ah=class{constructor(e,t,r=Oe.app()){var i;Qb((i=r.options)===null||i===void 0?void 0:i.apiKey,"invalid-api-key",{appName:r.name}),this._delegate=new _s(r.auth(),e,t),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}};var Jb="auth-compat";function Yb(n){n.INTERNAL.registerComponent(new xe(Jb,e=>{let t=e.getProvider("app-compat").getImmediate(),r=e.getProvider("auth");return new m_(t,r)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:_n.EMAIL_SIGNIN,PASSWORD_RESET:_n.PASSWORD_RESET,RECOVER_EMAIL:_n.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:_n.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:_n.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:_n.VERIFY_EMAIL}},EmailAuthProvider:Ts,FacebookAuthProvider:la,GithubAuthProvider:da,GoogleAuthProvider:ha,OAuthProvider:Fr,SAMLAuthProvider:gs,PhoneAuthProvider:Rs,PhoneMultiFactorGenerator:mh,RecaptchaVerifier:Ah,TwitterAuthProvider:fa,Auth:m_,AuthCredential:Rt,Error:Te}).setInstantiationMode("LAZY").setMultipleInstances(!1)),n.registerVersion(Db,xb)}Yb(Oe);var A_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},b_={};var yn,Sh;(function(){var n;function e(w,y){function I(){}I.prototype=y.prototype,w.D=y.prototype,w.prototype=new I,w.prototype.constructor=w,w.C=function(E,T,S){for(var v=Array(arguments.length-2),Bt=2;Bt<arguments.length;Bt++)v[Bt-2]=arguments[Bt];return y.prototype[T].apply(E,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,y,I){I||(I=0);var E=Array(16);if(typeof y=="string")for(var T=0;16>T;++T)E[T]=y.charCodeAt(I++)|y.charCodeAt(I++)<<8|y.charCodeAt(I++)<<16|y.charCodeAt(I++)<<24;else for(T=0;16>T;++T)E[T]=y[I++]|y[I++]<<8|y[I++]<<16|y[I++]<<24;y=w.g[0],I=w.g[1],T=w.g[2];var S=w.g[3],v=y+(S^I&(T^S))+E[0]+3614090360&4294967295;y=I+(v<<7&4294967295|v>>>25),v=S+(T^y&(I^T))+E[1]+3905402710&4294967295,S=y+(v<<12&4294967295|v>>>20),v=T+(I^S&(y^I))+E[2]+606105819&4294967295,T=S+(v<<17&4294967295|v>>>15),v=I+(y^T&(S^y))+E[3]+3250441966&4294967295,I=T+(v<<22&4294967295|v>>>10),v=y+(S^I&(T^S))+E[4]+4118548399&4294967295,y=I+(v<<7&4294967295|v>>>25),v=S+(T^y&(I^T))+E[5]+1200080426&4294967295,S=y+(v<<12&4294967295|v>>>20),v=T+(I^S&(y^I))+E[6]+2821735955&4294967295,T=S+(v<<17&4294967295|v>>>15),v=I+(y^T&(S^y))+E[7]+4249261313&4294967295,I=T+(v<<22&4294967295|v>>>10),v=y+(S^I&(T^S))+E[8]+1770035416&4294967295,y=I+(v<<7&4294967295|v>>>25),v=S+(T^y&(I^T))+E[9]+2336552879&4294967295,S=y+(v<<12&4294967295|v>>>20),v=T+(I^S&(y^I))+E[10]+4294925233&4294967295,T=S+(v<<17&4294967295|v>>>15),v=I+(y^T&(S^y))+E[11]+2304563134&4294967295,I=T+(v<<22&4294967295|v>>>10),v=y+(S^I&(T^S))+E[12]+1804603682&4294967295,y=I+(v<<7&4294967295|v>>>25),v=S+(T^y&(I^T))+E[13]+4254626195&4294967295,S=y+(v<<12&4294967295|v>>>20),v=T+(I^S&(y^I))+E[14]+2792965006&4294967295,T=S+(v<<17&4294967295|v>>>15),v=I+(y^T&(S^y))+E[15]+1236535329&4294967295,I=T+(v<<22&4294967295|v>>>10),v=y+(T^S&(I^T))+E[1]+4129170786&4294967295,y=I+(v<<5&4294967295|v>>>27),v=S+(I^T&(y^I))+E[6]+3225465664&4294967295,S=y+(v<<9&4294967295|v>>>23),v=T+(y^I&(S^y))+E[11]+643717713&4294967295,T=S+(v<<14&4294967295|v>>>18),v=I+(S^y&(T^S))+E[0]+3921069994&4294967295,I=T+(v<<20&4294967295|v>>>12),v=y+(T^S&(I^T))+E[5]+3593408605&4294967295,y=I+(v<<5&4294967295|v>>>27),v=S+(I^T&(y^I))+E[10]+38016083&4294967295,S=y+(v<<9&4294967295|v>>>23),v=T+(y^I&(S^y))+E[15]+3634488961&4294967295,T=S+(v<<14&4294967295|v>>>18),v=I+(S^y&(T^S))+E[4]+3889429448&4294967295,I=T+(v<<20&4294967295|v>>>12),v=y+(T^S&(I^T))+E[9]+568446438&4294967295,y=I+(v<<5&4294967295|v>>>27),v=S+(I^T&(y^I))+E[14]+3275163606&4294967295,S=y+(v<<9&4294967295|v>>>23),v=T+(y^I&(S^y))+E[3]+4107603335&4294967295,T=S+(v<<14&4294967295|v>>>18),v=I+(S^y&(T^S))+E[8]+1163531501&4294967295,I=T+(v<<20&4294967295|v>>>12),v=y+(T^S&(I^T))+E[13]+2850285829&4294967295,y=I+(v<<5&4294967295|v>>>27),v=S+(I^T&(y^I))+E[2]+4243563512&4294967295,S=y+(v<<9&4294967295|v>>>23),v=T+(y^I&(S^y))+E[7]+1735328473&4294967295,T=S+(v<<14&4294967295|v>>>18),v=I+(S^y&(T^S))+E[12]+2368359562&4294967295,I=T+(v<<20&4294967295|v>>>12),v=y+(I^T^S)+E[5]+4294588738&4294967295,y=I+(v<<4&4294967295|v>>>28),v=S+(y^I^T)+E[8]+2272392833&4294967295,S=y+(v<<11&4294967295|v>>>21),v=T+(S^y^I)+E[11]+1839030562&4294967295,T=S+(v<<16&4294967295|v>>>16),v=I+(T^S^y)+E[14]+4259657740&4294967295,I=T+(v<<23&4294967295|v>>>9),v=y+(I^T^S)+E[1]+2763975236&4294967295,y=I+(v<<4&4294967295|v>>>28),v=S+(y^I^T)+E[4]+1272893353&4294967295,S=y+(v<<11&4294967295|v>>>21),v=T+(S^y^I)+E[7]+4139469664&4294967295,T=S+(v<<16&4294967295|v>>>16),v=I+(T^S^y)+E[10]+3200236656&4294967295,I=T+(v<<23&4294967295|v>>>9),v=y+(I^T^S)+E[13]+681279174&4294967295,y=I+(v<<4&4294967295|v>>>28),v=S+(y^I^T)+E[0]+3936430074&4294967295,S=y+(v<<11&4294967295|v>>>21),v=T+(S^y^I)+E[3]+3572445317&4294967295,T=S+(v<<16&4294967295|v>>>16),v=I+(T^S^y)+E[6]+76029189&4294967295,I=T+(v<<23&4294967295|v>>>9),v=y+(I^T^S)+E[9]+3654602809&4294967295,y=I+(v<<4&4294967295|v>>>28),v=S+(y^I^T)+E[12]+3873151461&4294967295,S=y+(v<<11&4294967295|v>>>21),v=T+(S^y^I)+E[15]+530742520&4294967295,T=S+(v<<16&4294967295|v>>>16),v=I+(T^S^y)+E[2]+3299628645&4294967295,I=T+(v<<23&4294967295|v>>>9),v=y+(T^(I|~S))+E[0]+4096336452&4294967295,y=I+(v<<6&4294967295|v>>>26),v=S+(I^(y|~T))+E[7]+1126891415&4294967295,S=y+(v<<10&4294967295|v>>>22),v=T+(y^(S|~I))+E[14]+2878612391&4294967295,T=S+(v<<15&4294967295|v>>>17),v=I+(S^(T|~y))+E[5]+4237533241&4294967295,I=T+(v<<21&4294967295|v>>>11),v=y+(T^(I|~S))+E[12]+1700485571&4294967295,y=I+(v<<6&4294967295|v>>>26),v=S+(I^(y|~T))+E[3]+2399980690&4294967295,S=y+(v<<10&4294967295|v>>>22),v=T+(y^(S|~I))+E[10]+4293915773&4294967295,T=S+(v<<15&4294967295|v>>>17),v=I+(S^(T|~y))+E[1]+2240044497&4294967295,I=T+(v<<21&4294967295|v>>>11),v=y+(T^(I|~S))+E[8]+1873313359&4294967295,y=I+(v<<6&4294967295|v>>>26),v=S+(I^(y|~T))+E[15]+4264355552&4294967295,S=y+(v<<10&4294967295|v>>>22),v=T+(y^(S|~I))+E[6]+2734768916&4294967295,T=S+(v<<15&4294967295|v>>>17),v=I+(S^(T|~y))+E[13]+1309151649&4294967295,I=T+(v<<21&4294967295|v>>>11),v=y+(T^(I|~S))+E[4]+4149444226&4294967295,y=I+(v<<6&4294967295|v>>>26),v=S+(I^(y|~T))+E[11]+3174756917&4294967295,S=y+(v<<10&4294967295|v>>>22),v=T+(y^(S|~I))+E[2]+718787259&4294967295,T=S+(v<<15&4294967295|v>>>17),v=I+(S^(T|~y))+E[9]+3951481745&4294967295,w.g[0]=w.g[0]+y&4294967295,w.g[1]=w.g[1]+(T+(v<<21&4294967295|v>>>11))&4294967295,w.g[2]=w.g[2]+T&4294967295,w.g[3]=w.g[3]+S&4294967295}r.prototype.u=function(w,y){y===void 0&&(y=w.length);for(var I=y-this.blockSize,E=this.B,T=this.h,S=0;S<y;){if(T==0)for(;S<=I;)i(this,w,S),S+=this.blockSize;if(typeof w=="string"){for(;S<y;)if(E[T++]=w.charCodeAt(S++),T==this.blockSize){i(this,E),T=0;break}}else for(;S<y;)if(E[T++]=w[S++],T==this.blockSize){i(this,E),T=0;break}}this.h=T,this.o+=y},r.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var y=1;y<w.length-8;++y)w[y]=0;var I=8*this.o;for(y=w.length-8;y<w.length;++y)w[y]=I&255,I/=256;for(this.u(w),w=Array(16),y=I=0;4>y;++y)for(var E=0;32>E;E+=8)w[I++]=this.g[y]>>>E&255;return w};function s(w,y){var I=c;return Object.prototype.hasOwnProperty.call(I,w)?I[w]:I[w]=y(w)}function o(w,y){this.h=y;for(var I=[],E=!0,T=w.length-1;0<=T;T--){var S=w[T]|0;E&&S==y||(I[T]=S,E=!1)}this.g=I}var c={};function u(w){return-128<=w&&128>w?s(w,function(y){return new o([y|0],0>y?-1:0)}):new o([w|0],0>w?-1:0)}function h(w){if(isNaN(w)||!isFinite(w))return m;if(0>w)return D(h(-w));for(var y=[],I=1,E=0;w>=I;E++)y[E]=w/I|0,I*=4294967296;return new o(y,0)}function f(w,y){if(w.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(w.charAt(0)=="-")return D(f(w.substring(1),y));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=h(Math.pow(y,8)),E=m,T=0;T<w.length;T+=8){var S=Math.min(8,w.length-T),v=parseInt(w.substring(T,T+S),y);8>S?(S=h(Math.pow(y,S)),E=E.j(S).add(h(v))):(E=E.j(I),E=E.add(h(v)))}return E}var m=u(0),_=u(1),b=u(16777216);n=o.prototype,n.m=function(){if(O(this))return-D(this).m();for(var w=0,y=1,I=0;I<this.g.length;I++){var E=this.i(I);w+=(0<=E?E:4294967296+E)*y,y*=4294967296}return w},n.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(k(this))return"0";if(O(this))return"-"+D(this).toString(w);for(var y=h(Math.pow(w,6)),I=this,E="";;){var T=Q(I,y).g;I=G(I,T.j(y));var S=((0<I.g.length?I.g[0]:I.h)>>>0).toString(w);if(I=T,k(I))return S+E;for(;6>S.length;)S="0"+S;E=S+E}},n.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function k(w){if(w.h!=0)return!1;for(var y=0;y<w.g.length;y++)if(w.g[y]!=0)return!1;return!0}function O(w){return w.h==-1}n.l=function(w){return w=G(this,w),O(w)?-1:k(w)?0:1};function D(w){for(var y=w.g.length,I=[],E=0;E<y;E++)I[E]=~w.g[E];return new o(I,~w.h).add(_)}n.abs=function(){return O(this)?D(this):this},n.add=function(w){for(var y=Math.max(this.g.length,w.g.length),I=[],E=0,T=0;T<=y;T++){var S=E+(this.i(T)&65535)+(w.i(T)&65535),v=(S>>>16)+(this.i(T)>>>16)+(w.i(T)>>>16);E=v>>>16,S&=65535,v&=65535,I[T]=v<<16|S}return new o(I,I[I.length-1]&-2147483648?-1:0)};function G(w,y){return w.add(D(y))}n.j=function(w){if(k(this)||k(w))return m;if(O(this))return O(w)?D(this).j(D(w)):D(D(this).j(w));if(O(w))return D(this.j(D(w)));if(0>this.l(b)&&0>w.l(b))return h(this.m()*w.m());for(var y=this.g.length+w.g.length,I=[],E=0;E<2*y;E++)I[E]=0;for(E=0;E<this.g.length;E++)for(var T=0;T<w.g.length;T++){var S=this.i(E)>>>16,v=this.i(E)&65535,Bt=w.i(T)>>>16,xi=w.i(T)&65535;I[2*E+2*T]+=v*xi,W(I,2*E+2*T),I[2*E+2*T+1]+=S*xi,W(I,2*E+2*T+1),I[2*E+2*T+1]+=v*Bt,W(I,2*E+2*T+1),I[2*E+2*T+2]+=S*Bt,W(I,2*E+2*T+2)}for(E=0;E<y;E++)I[E]=I[2*E+1]<<16|I[2*E];for(E=y;E<2*y;E++)I[E]=0;return new o(I,0)};function W(w,y){for(;(w[y]&65535)!=w[y];)w[y+1]+=w[y]>>>16,w[y]&=65535,y++}function q(w,y){this.g=w,this.h=y}function Q(w,y){if(k(y))throw Error("division by zero");if(k(w))return new q(m,m);if(O(w))return y=Q(D(w),y),new q(D(y.g),D(y.h));if(O(y))return y=Q(w,D(y)),new q(D(y.g),y.h);if(30<w.g.length){if(O(w)||O(y))throw Error("slowDivide_ only works with positive integers.");for(var I=_,E=y;0>=E.l(w);)I=te(I),E=te(E);var T=K(I,1),S=K(E,1);for(E=K(E,2),I=K(I,2);!k(E);){var v=S.add(E);0>=v.l(w)&&(T=T.add(I),S=v),E=K(E,1),I=K(I,1)}return y=G(w,T.j(y)),new q(T,y)}for(T=m;0<=w.l(y);){for(I=Math.max(1,Math.floor(w.m()/y.m())),E=Math.ceil(Math.log(I)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),S=h(I),v=S.j(y);O(v)||0<v.l(w);)I-=E,S=h(I),v=S.j(y);k(S)&&(S=_),T=T.add(S),w=G(w,v)}return new q(T,w)}n.A=function(w){return Q(this,w).h},n.and=function(w){for(var y=Math.max(this.g.length,w.g.length),I=[],E=0;E<y;E++)I[E]=this.i(E)&w.i(E);return new o(I,this.h&w.h)},n.or=function(w){for(var y=Math.max(this.g.length,w.g.length),I=[],E=0;E<y;E++)I[E]=this.i(E)|w.i(E);return new o(I,this.h|w.h)},n.xor=function(w){for(var y=Math.max(this.g.length,w.g.length),I=[],E=0;E<y;E++)I[E]=this.i(E)^w.i(E);return new o(I,this.h^w.h)};function te(w){for(var y=w.g.length+1,I=[],E=0;E<y;E++)I[E]=w.i(E)<<1|w.i(E-1)>>>31;return new o(I,w.h)}function K(w,y){var I=y>>5;y%=32;for(var E=w.g.length-I,T=[],S=0;S<E;S++)T[S]=0<y?w.i(S+I)>>>y|w.i(S+I+1)<<32-y:w.i(S+I);return new o(T,w.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Sh=b_.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=f,yn=b_.Integer=o}).apply(typeof A_<"u"?A_:typeof self<"u"?self:typeof window<"u"?window:{});var Ea=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ht={};var Rh,Xb,Kr,Ph,Ps,Ta,Ch,Nh,kh;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,l,d){return a==Array.prototype||a==Object.prototype||(a[l]=d.value),a};function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ea=="object"&&Ea];for(var l=0;l<a.length;++l){var d=a[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=t(this);function i(a,l){if(l)e:{var d=r;a=a.split(".");for(var g=0;g<a.length-1;g++){var A=a[g];if(!(A in d))break e;d=d[A]}a=a[a.length-1],g=d[a],l=l(g),l!=g&&l!=null&&e(d,a,{configurable:!0,writable:!0,value:l})}}function s(a,l){a instanceof String&&(a+="");var d=0,g=!1,A={next:function(){if(!g&&d<a.length){var P=d++;return{value:l(P,a[P]),done:!1}}return g=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}i("Array.prototype.values",function(a){return a||function(){return s(this,function(l,d){return d})}});var o=o||{},c=this||self;function u(a){var l=typeof a;return l=l!="object"?l:a?Array.isArray(a)?"array":l:"null",l=="array"||l=="object"&&typeof a.length=="number"}function h(a){var l=typeof a;return l=="object"&&a!=null||l=="function"}function f(a,l,d){return a.call.apply(a.bind,arguments)}function m(a,l,d){if(!a)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,g),a.apply(l,A)}}return function(){return a.apply(l,arguments)}}function _(a,l,d){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:m,_.apply(null,arguments)}function b(a,l){var d=Array.prototype.slice.call(arguments,1);return function(){var g=d.slice();return g.push.apply(g,arguments),a.apply(this,g)}}function k(a,l){function d(){}d.prototype=l.prototype,a.aa=l.prototype,a.prototype=new d,a.prototype.constructor=a,a.Qb=function(g,A,P){for(var L=Array(arguments.length-2),ie=2;ie<arguments.length;ie++)L[ie-2]=arguments[ie];return l.prototype[A].apply(g,L)}}function O(a){let l=a.length;if(0<l){let d=Array(l);for(let g=0;g<l;g++)d[g]=a[g];return d}return[]}function D(a,l){for(let d=1;d<arguments.length;d++){let g=arguments[d];if(u(g)){let A=a.length||0,P=g.length||0;a.length=A+P;for(let L=0;L<P;L++)a[A+L]=g[L]}else a.push(g)}}class G{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function W(a){return/^[\s\xa0]*$/.test(a)}function q(){var a=c.navigator;return a&&(a=a.userAgent)?a:""}function Q(a){return Q[" "](a),a}Q[" "]=function(){};var te=q().indexOf("Gecko")!=-1&&!(q().toLowerCase().indexOf("webkit")!=-1&&q().indexOf("Edge")==-1)&&!(q().indexOf("Trident")!=-1||q().indexOf("MSIE")!=-1)&&q().indexOf("Edge")==-1;function K(a,l,d){for(let g in a)l.call(d,a[g],g,a)}function w(a,l){for(let d in a)l.call(void 0,a[d],d,a)}function y(a){let l={};for(let d in a)l[d]=a[d];return l}let I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(a,l){let d,g;for(let A=1;A<arguments.length;A++){g=arguments[A];for(d in g)a[d]=g[d];for(let P=0;P<I.length;P++)d=I[P],Object.prototype.hasOwnProperty.call(g,d)&&(a[d]=g[d])}}function T(a){var l=1;a=a.split(":");let d=[];for(;0<l&&a.length;)d.push(a.shift()),l--;return a.length&&d.push(a.join(":")),d}function S(a){c.setTimeout(()=>{throw a},0)}function v(){var a=Gc;let l=null;return a.g&&(l=a.g,a.g=a.g.next,a.g||(a.h=null),l.next=null),l}class Bt{constructor(){this.h=this.g=null}add(l,d){let g=xi.get();g.set(l,d),this.h?this.h.next=g:this.g=g,this.h=g}}var xi=new G(()=>new rw,a=>a.reset());class rw{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Oi,Vi=!1,Gc=new Bt,xp=()=>{let a=c.Promise.resolve(void 0);Oi=()=>{a.then(iw)}};var iw=()=>{for(var a;a=v();){try{a.h.call(a.g)}catch(d){S(d)}var l=xi;l.j(a),100>l.h&&(l.h++,a.next=l.g,l.g=a)}Vi=!1};function sn(){this.s=this.s,this.C=this.C}sn.prototype.s=!1,sn.prototype.ma=function(){this.s||(this.s=!0,this.N())},sn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ue(a,l){this.type=a,this.g=this.target=l,this.defaultPrevented=!1}Ue.prototype.h=function(){this.defaultPrevented=!0};var sw=(function(){if(!c.addEventListener||!Object.defineProperty)return!1;var a=!1,l=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let d=()=>{};c.addEventListener("test",d,l),c.removeEventListener("test",d,l)}catch{}return a})();function Li(a,l){if(Ue.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var d=this.type=a.type,g=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=l,l=a.relatedTarget){if(te){e:{try{Q(l.nodeName);var A=!0;break e}catch{}A=!1}A||(l=null)}}else d=="mouseover"?l=a.fromElement:d=="mouseout"&&(l=a.toElement);this.relatedTarget=l,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:ow[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&Li.aa.h.call(this)}}k(Li,Ue);var ow={2:"touch",3:"pen",4:"mouse"};Li.prototype.h=function(){Li.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Mi="closure_listenable_"+(1e6*Math.random()|0),aw=0;function cw(a,l,d,g,A){this.listener=a,this.proxy=null,this.src=l,this.type=d,this.capture=!!g,this.ha=A,this.key=++aw,this.da=this.fa=!1}function go(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function _o(a){this.src=a,this.g={},this.h=0}_o.prototype.add=function(a,l,d,g,A){var P=a.toString();a=this.g[P],a||(a=this.g[P]=[],this.h++);var L=Kc(a,l,g,A);return-1<L?(l=a[L],d||(l.fa=!1)):(l=new cw(l,this.src,P,!!g,A),l.fa=d,a.push(l)),l};function Wc(a,l){var d=l.type;if(d in a.g){var g=a.g[d],A=Array.prototype.indexOf.call(g,l,void 0),P;(P=0<=A)&&Array.prototype.splice.call(g,A,1),P&&(go(l),a.g[d].length==0&&(delete a.g[d],a.h--))}}function Kc(a,l,d,g){for(var A=0;A<a.length;++A){var P=a[A];if(!P.da&&P.listener==l&&P.capture==!!d&&P.ha==g)return A}return-1}var $c="closure_lm_"+(1e6*Math.random()|0),Hc={};function Op(a,l,d,g,A){if(g&&g.once)return Lp(a,l,d,g,A);if(Array.isArray(l)){for(var P=0;P<l.length;P++)Op(a,l[P],d,g,A);return null}return d=Xc(d),a&&a[Mi]?a.K(l,d,h(g)?!!g.capture:!!g,A):Vp(a,l,d,!1,g,A)}function Vp(a,l,d,g,A,P){if(!l)throw Error("Invalid event type");var L=h(A)?!!A.capture:!!A,ie=Jc(a);if(ie||(a[$c]=ie=new _o(a)),d=ie.add(l,d,g,L,P),d.proxy)return d;if(g=uw(),d.proxy=g,g.src=a,g.listener=d,a.addEventListener)sw||(A=L),A===void 0&&(A=!1),a.addEventListener(l.toString(),g,A);else if(a.attachEvent)a.attachEvent(Fp(l.toString()),g);else if(a.addListener&&a.removeListener)a.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return d}function uw(){function a(d){return l.call(a.src,a.listener,d)}let l=lw;return a}function Lp(a,l,d,g,A){if(Array.isArray(l)){for(var P=0;P<l.length;P++)Lp(a,l[P],d,g,A);return null}return d=Xc(d),a&&a[Mi]?a.L(l,d,h(g)?!!g.capture:!!g,A):Vp(a,l,d,!0,g,A)}function Mp(a,l,d,g,A){if(Array.isArray(l))for(var P=0;P<l.length;P++)Mp(a,l[P],d,g,A);else g=h(g)?!!g.capture:!!g,d=Xc(d),a&&a[Mi]?(a=a.i,l=String(l).toString(),l in a.g&&(P=a.g[l],d=Kc(P,d,g,A),-1<d&&(go(P[d]),Array.prototype.splice.call(P,d,1),P.length==0&&(delete a.g[l],a.h--)))):a&&(a=Jc(a))&&(l=a.g[l.toString()],a=-1,l&&(a=Kc(l,d,g,A)),(d=-1<a?l[a]:null)&&Qc(d))}function Qc(a){if(typeof a!="number"&&a&&!a.da){var l=a.src;if(l&&l[Mi])Wc(l.i,a);else{var d=a.type,g=a.proxy;l.removeEventListener?l.removeEventListener(d,g,a.capture):l.detachEvent?l.detachEvent(Fp(d),g):l.addListener&&l.removeListener&&l.removeListener(g),(d=Jc(l))?(Wc(d,a),d.h==0&&(d.src=null,l[$c]=null)):go(a)}}}function Fp(a){return a in Hc?Hc[a]:Hc[a]="on"+a}function lw(a,l){if(a.da)a=!0;else{l=new Li(l,this);var d=a.listener,g=a.ha||a.src;a.fa&&Qc(a),a=d.call(g,l)}return a}function Jc(a){return a=a[$c],a instanceof _o?a:null}var Yc="__closure_events_fn_"+(1e9*Math.random()>>>0);function Xc(a){return typeof a=="function"?a:(a[Yc]||(a[Yc]=function(l){return a.handleEvent(l)}),a[Yc])}function Be(){sn.call(this),this.i=new _o(this),this.M=this,this.F=null}k(Be,sn),Be.prototype[Mi]=!0,Be.prototype.removeEventListener=function(a,l,d,g){Mp(this,a,l,d,g)};function Ke(a,l){var d,g=a.F;if(g)for(d=[];g;g=g.F)d.push(g);if(a=a.M,g=l.type||l,typeof l=="string")l=new Ue(l,a);else if(l instanceof Ue)l.target=l.target||a;else{var A=l;l=new Ue(g,a),E(l,A)}if(A=!0,d)for(var P=d.length-1;0<=P;P--){var L=l.g=d[P];A=yo(L,g,!0,l)&&A}if(L=l.g=a,A=yo(L,g,!0,l)&&A,A=yo(L,g,!1,l)&&A,d)for(P=0;P<d.length;P++)L=l.g=d[P],A=yo(L,g,!1,l)&&A}Be.prototype.N=function(){if(Be.aa.N.call(this),this.i){var a=this.i,l;for(l in a.g){for(var d=a.g[l],g=0;g<d.length;g++)go(d[g]);delete a.g[l],a.h--}}this.F=null},Be.prototype.K=function(a,l,d,g){return this.i.add(String(a),l,!1,d,g)},Be.prototype.L=function(a,l,d,g){return this.i.add(String(a),l,!0,d,g)};function yo(a,l,d,g){if(l=a.i.g[String(l)],!l)return!0;l=l.concat();for(var A=!0,P=0;P<l.length;++P){var L=l[P];if(L&&!L.da&&L.capture==d){var ie=L.listener,Le=L.ha||L.src;L.fa&&Wc(a.i,L),A=ie.call(Le,g)!==!1&&A}}return A&&!g.defaultPrevented}function Up(a,l,d){if(typeof a=="function")d&&(a=_(a,d));else if(a&&typeof a.handleEvent=="function")a=_(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:c.setTimeout(a,l||0)}function Bp(a){a.g=Up(()=>{a.g=null,a.i&&(a.i=!1,Bp(a))},a.l);let l=a.h;a.h=null,a.m.apply(null,l)}class hw extends sn{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Bp(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Fi(a){sn.call(this),this.h=a,this.g={}}k(Fi,sn);var qp=[];function jp(a){K(a.g,function(l,d){this.g.hasOwnProperty(d)&&Qc(l)},a),a.g={}}Fi.prototype.N=function(){Fi.aa.N.call(this),jp(this)},Fi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Zc=c.JSON.stringify,dw=c.JSON.parse,fw=class{stringify(a){return c.JSON.stringify(a,void 0)}parse(a){return c.JSON.parse(a,void 0)}};function eu(){}eu.prototype.h=null;function zp(a){return a.h||(a.h=a.i())}function Gp(){}var Ui={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function tu(){Ue.call(this,"d")}k(tu,Ue);function nu(){Ue.call(this,"c")}k(nu,Ue);var Fn={},Wp=null;function vo(){return Wp=Wp||new Be}Fn.La="serverreachability";function Kp(a){Ue.call(this,Fn.La,a)}k(Kp,Ue);function Bi(a){let l=vo();Ke(l,new Kp(l))}Fn.STAT_EVENT="statevent";function $p(a,l){Ue.call(this,Fn.STAT_EVENT,a),this.stat=l}k($p,Ue);function $e(a){let l=vo();Ke(l,new $p(l,a))}Fn.Ma="timingevent";function Hp(a,l){Ue.call(this,Fn.Ma,a),this.size=l}k(Hp,Ue);function qi(a,l){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){a()},l)}function ji(){this.g=!0}ji.prototype.xa=function(){this.g=!1};function pw(a,l,d,g,A,P){a.info(function(){if(a.g)if(P)for(var L="",ie=P.split("&"),Le=0;Le<ie.length;Le++){var ne=ie[Le].split("=");if(1<ne.length){var qe=ne[0];ne=ne[1];var je=qe.split("_");L=2<=je.length&&je[1]=="type"?L+(qe+"="+ne+"&"):L+(qe+"=redacted&")}}else L=null;else L=P;return"XMLHTTP REQ ("+g+") [attempt "+A+"]: "+l+`
`+d+`
`+L})}function mw(a,l,d,g,A,P,L){a.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+A+"]: "+l+`
`+d+`
`+P+" "+L})}function Cr(a,l,d,g){a.info(function(){return"XMLHTTP TEXT ("+l+"): "+_w(a,d)+(g?" "+g:"")})}function gw(a,l){a.info(function(){return"TIMEOUT: "+l})}ji.prototype.info=function(){};function _w(a,l){if(!a.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d){for(a=0;a<d.length;a++)if(Array.isArray(d[a])){var g=d[a];if(!(2>g.length)){var A=g[1];if(Array.isArray(A)&&!(1>A.length)){var P=A[0];if(P!="noop"&&P!="stop"&&P!="close")for(var L=1;L<A.length;L++)A[L]=""}}}}return Zc(d)}catch{return l}}var Io={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Qp={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ru;function wo(){}k(wo,eu),wo.prototype.g=function(){return new XMLHttpRequest},wo.prototype.i=function(){return{}},ru=new wo;function on(a,l,d,g){this.j=a,this.i=l,this.l=d,this.R=g||1,this.U=new Fi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Jp}function Jp(){this.i=null,this.g="",this.h=!1}var Yp={},iu={};function su(a,l,d){a.L=1,a.v=bo(qt(l)),a.m=d,a.P=!0,Xp(a,null)}function Xp(a,l){a.F=Date.now(),Eo(a),a.A=qt(a.v);var d=a.A,g=a.R;Array.isArray(g)||(g=[String(g)]),dm(d.i,"t",g),a.C=0,d=a.j.J,a.h=new Jp,a.g=Nm(a.j,d?l:null,!a.m),0<a.O&&(a.M=new hw(_(a.Y,a,a.g),a.O)),l=a.U,d=a.g,g=a.ca;var A="readystatechange";Array.isArray(A)||(A&&(qp[0]=A.toString()),A=qp);for(var P=0;P<A.length;P++){var L=Op(d,A[P],g||l.handleEvent,!1,l.h||l);if(!L)break;l.g[L.key]=L}l=a.H?y(a.H):{},a.m?(a.u||(a.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,l)):(a.u="GET",a.g.ea(a.A,a.u,null,l)),Bi(),pw(a.i,a.u,a.A,a.l,a.R,a.m)}on.prototype.ca=function(a){a=a.target;let l=this.M;l&&jt(a)==3?l.j():this.Y(a)},on.prototype.Y=function(a){try{if(a==this.g)e:{let je=jt(this.g);var l=this.g.Ba();let Dr=this.g.Z();if(!(3>je)&&(je!=3||this.g&&(this.h.h||this.g.oa()||vm(this.g)))){this.J||je!=4||l==7||(l==8||0>=Dr?Bi(3):Bi(2)),ou(this);var d=this.g.Z();this.X=d;t:if(Zp(this)){var g=vm(this.g);a="";var A=g.length,P=jt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Un(this),zi(this);var L="";break t}this.h.i=new c.TextDecoder}for(l=0;l<A;l++)this.h.h=!0,a+=this.h.i.decode(g[l],{stream:!(P&&l==A-1)});g.length=0,this.h.g+=a,this.C=0,L=this.h.g}else L=this.g.oa();if(this.o=d==200,mw(this.i,this.u,this.A,this.l,this.R,je,d),this.o){if(this.T&&!this.K){t:{if(this.g){var ie,Le=this.g;if((ie=Le.g?Le.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!W(ie)){var ne=ie;break t}}ne=null}if(d=ne)Cr(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,au(this,d);else{this.o=!1,this.s=3,$e(12),Un(this),zi(this);break e}}if(this.P){d=!0;let lt;for(;!this.J&&this.C<L.length;)if(lt=yw(this,L),lt==iu){je==4&&(this.s=4,$e(14),d=!1),Cr(this.i,this.l,null,"[Incomplete Response]");break}else if(lt==Yp){this.s=4,$e(15),Cr(this.i,this.l,L,"[Invalid Chunk]"),d=!1;break}else Cr(this.i,this.l,lt,null),au(this,lt);if(Zp(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),je!=4||L.length!=0||this.h.h||(this.s=1,$e(16),d=!1),this.o=this.o&&d,!d)Cr(this.i,this.l,L,"[Invalid Chunked Response]"),Un(this),zi(this);else if(0<L.length&&!this.W){this.W=!0;var qe=this.j;qe.g==this&&qe.ba&&!qe.M&&(qe.j.info("Great, no buffering proxy detected. Bytes received: "+L.length),fu(qe),qe.M=!0,$e(11))}}else Cr(this.i,this.l,L,null),au(this,L);je==4&&Un(this),this.o&&!this.J&&(je==4?Sm(this.j,this):(this.o=!1,Eo(this)))}else Vw(this.g),d==400&&0<L.indexOf("Unknown SID")?(this.s=3,$e(12)):(this.s=0,$e(13)),Un(this),zi(this)}}}catch{}finally{}};function Zp(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function yw(a,l){var d=a.C,g=l.indexOf(`
`,d);return g==-1?iu:(d=Number(l.substring(d,g)),isNaN(d)?Yp:(g+=1,g+d>l.length?iu:(l=l.slice(g,g+d),a.C=g+d,l)))}on.prototype.cancel=function(){this.J=!0,Un(this)};function Eo(a){a.S=Date.now()+a.I,em(a,a.I)}function em(a,l){if(a.B!=null)throw Error("WatchDog timer not null");a.B=qi(_(a.ba,a),l)}function ou(a){a.B&&(c.clearTimeout(a.B),a.B=null)}on.prototype.ba=function(){this.B=null;let a=Date.now();0<=a-this.S?(gw(this.i,this.A),this.L!=2&&(Bi(),$e(17)),Un(this),this.s=2,zi(this)):em(this,this.S-a)};function zi(a){a.j.G==0||a.J||Sm(a.j,a)}function Un(a){ou(a);var l=a.M;l&&typeof l.ma=="function"&&l.ma(),a.M=null,jp(a.U),a.g&&(l=a.g,a.g=null,l.abort(),l.ma())}function au(a,l){try{var d=a.j;if(d.G!=0&&(d.g==a||cu(d.h,a))){if(!a.K&&cu(d.h,a)&&d.G==3){try{var g=d.Da.g.parse(l)}catch{g=null}if(Array.isArray(g)&&g.length==3){var A=g;if(A[0]==0){e:if(!d.u){if(d.g)if(d.g.F+3e3<a.F)No(d),Po(d);else break e;du(d),$e(18)}}else d.za=A[1],0<d.za-d.T&&37500>A[2]&&d.F&&d.v==0&&!d.C&&(d.C=qi(_(d.Za,d),6e3));if(1>=rm(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else qn(d,11)}else if((a.K||d.g==a)&&No(d),!W(l))for(A=d.Da.g.parse(l),l=0;l<A.length;l++){let ne=A[l];if(d.T=ne[0],ne=ne[1],d.G==2)if(ne[0]=="c"){d.K=ne[1],d.ia=ne[2];let qe=ne[3];qe!=null&&(d.la=qe,d.j.info("VER="+d.la));let je=ne[4];je!=null&&(d.Aa=je,d.j.info("SVER="+d.Aa));let Dr=ne[5];Dr!=null&&typeof Dr=="number"&&0<Dr&&(g=1.5*Dr,d.L=g,d.j.info("backChannelRequestTimeoutMs_="+g)),g=d;let lt=a.g;if(lt){let Do=lt.g?lt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Do){var P=g.h;P.g||Do.indexOf("spdy")==-1&&Do.indexOf("quic")==-1&&Do.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(uu(P,P.h),P.h=null))}if(g.D){let pu=lt.g?lt.g.getResponseHeader("X-HTTP-Session-Id"):null;pu&&(g.ya=pu,ce(g.I,g.D,pu))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-a.F,d.j.info("Handshake RTT: "+d.R+"ms")),g=d;var L=a;if(g.qa=Cm(g,g.J?g.ia:null,g.W),L.K){im(g.h,L);var ie=L,Le=g.L;Le&&(ie.I=Le),ie.B&&(ou(ie),Eo(ie)),g.g=L}else Am(g);0<d.i.length&&Co(d)}else ne[0]!="stop"&&ne[0]!="close"||qn(d,7);else d.G==3&&(ne[0]=="stop"||ne[0]=="close"?ne[0]=="stop"?qn(d,7):hu(d):ne[0]!="noop"&&d.l&&d.l.ta(ne),d.v=0)}}Bi(4)}catch{}}var vw=class{constructor(a,l){this.g=a,this.map=l}};function tm(a){this.l=a||10,c.PerformanceNavigationTiming?(a=c.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function nm(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function rm(a){return a.h?1:a.g?a.g.size:0}function cu(a,l){return a.h?a.h==l:a.g?a.g.has(l):!1}function uu(a,l){a.g?a.g.add(l):a.h=l}function im(a,l){a.h&&a.h==l?a.h=null:a.g&&a.g.has(l)&&a.g.delete(l)}tm.prototype.cancel=function(){if(this.i=sm(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function sm(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let l=a.i;for(let d of a.g.values())l=l.concat(d.D);return l}return O(a.i)}function Iw(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(u(a)){for(var l=[],d=a.length,g=0;g<d;g++)l.push(a[g]);return l}l=[],d=0;for(g in a)l[d++]=a[g];return l}function ww(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(u(a)||typeof a=="string"){var l=[];a=a.length;for(var d=0;d<a;d++)l.push(d);return l}l=[],d=0;for(let g in a)l[d++]=g;return l}}}function om(a,l){if(a.forEach&&typeof a.forEach=="function")a.forEach(l,void 0);else if(u(a)||typeof a=="string")Array.prototype.forEach.call(a,l,void 0);else for(var d=ww(a),g=Iw(a),A=g.length,P=0;P<A;P++)l.call(void 0,g[P],d&&d[P],a)}var am=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ew(a,l){if(a){a=a.split("&");for(var d=0;d<a.length;d++){var g=a[d].indexOf("="),A=null;if(0<=g){var P=a[d].substring(0,g);A=a[d].substring(g+1)}else P=a[d];l(P,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function Bn(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof Bn){this.h=a.h,To(this,a.j),this.o=a.o,this.g=a.g,Ao(this,a.s),this.l=a.l;var l=a.i,d=new Ki;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),cm(this,d),this.m=a.m}else a&&(l=String(a).match(am))?(this.h=!1,To(this,l[1]||"",!0),this.o=Gi(l[2]||""),this.g=Gi(l[3]||"",!0),Ao(this,l[4]),this.l=Gi(l[5]||"",!0),cm(this,l[6]||"",!0),this.m=Gi(l[7]||"")):(this.h=!1,this.i=new Ki(null,this.h))}Bn.prototype.toString=function(){var a=[],l=this.j;l&&a.push(Wi(l,um,!0),":");var d=this.g;return(d||l=="file")&&(a.push("//"),(l=this.o)&&a.push(Wi(l,um,!0),"@"),a.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&a.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(Wi(d,d.charAt(0)=="/"?bw:Aw,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",Wi(d,Rw)),a.join("")};function qt(a){return new Bn(a)}function To(a,l,d){a.j=d?Gi(l,!0):l,a.j&&(a.j=a.j.replace(/:$/,""))}function Ao(a,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);a.s=l}else a.s=null}function cm(a,l,d){l instanceof Ki?(a.i=l,Pw(a.i,a.h)):(d||(l=Wi(l,Sw)),a.i=new Ki(l,a.h))}function ce(a,l,d){a.i.set(l,d)}function bo(a){return ce(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function Gi(a,l){return a?l?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Wi(a,l,d){return typeof a=="string"?(a=encodeURI(a).replace(l,Tw),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Tw(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var um=/[#\/\?@]/g,Aw=/[#\?:]/g,bw=/[#\?]/g,Sw=/[#\?@]/g,Rw=/#/g;function Ki(a,l){this.h=this.g=null,this.i=a||null,this.j=!!l}function an(a){a.g||(a.g=new Map,a.h=0,a.i&&Ew(a.i,function(l,d){a.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}n=Ki.prototype,n.add=function(a,l){an(this),this.i=null,a=Nr(this,a);var d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(l),this.h+=1,this};function lm(a,l){an(a),l=Nr(a,l),a.g.has(l)&&(a.i=null,a.h-=a.g.get(l).length,a.g.delete(l))}function hm(a,l){return an(a),l=Nr(a,l),a.g.has(l)}n.forEach=function(a,l){an(this),this.g.forEach(function(d,g){d.forEach(function(A){a.call(l,A,g,this)},this)},this)},n.na=function(){an(this);let a=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let g=0;g<l.length;g++){let A=a[g];for(let P=0;P<A.length;P++)d.push(l[g])}return d},n.V=function(a){an(this);let l=[];if(typeof a=="string")hm(this,a)&&(l=l.concat(this.g.get(Nr(this,a))));else{a=Array.from(this.g.values());for(let d=0;d<a.length;d++)l=l.concat(a[d])}return l},n.set=function(a,l){return an(this),this.i=null,a=Nr(this,a),hm(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[l]),this.h+=1,this},n.get=function(a,l){return a?(a=this.V(a),0<a.length?String(a[0]):l):l};function dm(a,l,d){lm(a,l),0<d.length&&(a.i=null,a.g.set(Nr(a,l),O(d)),a.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var g=l[d];let P=encodeURIComponent(String(g)),L=this.V(g);for(g=0;g<L.length;g++){var A=P;L[g]!==""&&(A+="="+encodeURIComponent(String(L[g]))),a.push(A)}}return this.i=a.join("&")};function Nr(a,l){return l=String(l),a.j&&(l=l.toLowerCase()),l}function Pw(a,l){l&&!a.j&&(an(a),a.i=null,a.g.forEach(function(d,g){var A=g.toLowerCase();g!=A&&(lm(this,g),dm(this,A,d))},a)),a.j=l}function Cw(a,l){let d=new ji;if(c.Image){let g=new Image;g.onload=b(cn,d,"TestLoadImage: loaded",!0,l,g),g.onerror=b(cn,d,"TestLoadImage: error",!1,l,g),g.onabort=b(cn,d,"TestLoadImage: abort",!1,l,g),g.ontimeout=b(cn,d,"TestLoadImage: timeout",!1,l,g),c.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=a}else l(!1)}function Nw(a,l){let d=new ji,g=new AbortController,A=setTimeout(()=>{g.abort(),cn(d,"TestPingServer: timeout",!1,l)},1e4);fetch(a,{signal:g.signal}).then(P=>{clearTimeout(A),P.ok?cn(d,"TestPingServer: ok",!0,l):cn(d,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(A),cn(d,"TestPingServer: error",!1,l)})}function cn(a,l,d,g,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),g(d)}catch{}}function kw(){this.g=new fw}function Dw(a,l,d){let g=d||"";try{om(a,function(A,P){let L=A;h(A)&&(L=Zc(A)),l.push(g+P+"="+encodeURIComponent(L))})}catch(A){throw l.push(g+"type="+encodeURIComponent("_badmap")),A}}function $i(a){this.l=a.Ub||null,this.j=a.eb||!1}k($i,eu),$i.prototype.g=function(){return new So(this.l,this.j)},$i.prototype.i=(function(a){return function(){return a}})({});function So(a,l){Be.call(this),this.D=a,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(So,Be),n=So.prototype,n.open=function(a,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=l,this.readyState=1,Qi(this)},n.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(l.body=a),(this.D||c).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Hi(this)),this.readyState=0},n.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,Qi(this)),this.g&&(this.readyState=3,Qi(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;fm(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function fm(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}n.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var l=a.value?a.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!a.done}))&&(this.response=this.responseText+=l)}a.done?Hi(this):Qi(this),this.readyState==3&&fm(this)}},n.Ra=function(a){this.g&&(this.response=this.responseText=a,Hi(this))},n.Qa=function(a){this.g&&(this.response=a,Hi(this))},n.ga=function(){this.g&&Hi(this)};function Hi(a){a.readyState=4,a.l=null,a.j=null,a.v=null,Qi(a)}n.setRequestHeader=function(a,l){this.u.append(a,l)},n.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],l=this.h.entries();for(var d=l.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=l.next();return a.join(`\r
`)};function Qi(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(So.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function pm(a){let l="";return K(a,function(d,g){l+=g,l+=":",l+=d,l+=`\r
`}),l}function lu(a,l,d){e:{for(g in d){var g=!1;break e}g=!0}g||(d=pm(d),typeof a=="string"?d!=null&&encodeURIComponent(String(d)):ce(a,l,d))}function me(a){Be.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(me,Be);var xw=/^https?$/i,Ow=["POST","PUT"];n=me.prototype,n.Ha=function(a){this.J=a},n.ea=function(a,l,d,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);l=l?l.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ru.g(),this.v=this.o?zp(this.o):zp(ru),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(l,String(a),!0),this.B=!1}catch(P){mm(this,P);return}if(a=d||"",d=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var A in g)d.set(A,g[A]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(let P of g.keys())d.set(P,g.get(P));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(d.keys()).find(P=>P.toLowerCase()=="content-type"),A=c.FormData&&a instanceof c.FormData,!(0<=Array.prototype.indexOf.call(Ow,l,void 0))||g||A||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,L]of d)this.g.setRequestHeader(P,L);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ym(this),this.u=!0,this.g.send(a),this.u=!1}catch(P){mm(this,P)}};function mm(a,l){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=l,a.m=5,gm(a),Ro(a)}function gm(a){a.A||(a.A=!0,Ke(a,"complete"),Ke(a,"error"))}n.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,Ke(this,"complete"),Ke(this,"abort"),Ro(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ro(this,!0)),me.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?_m(this):this.bb())},n.bb=function(){_m(this)};function _m(a){if(a.h&&typeof o<"u"&&(!a.v[1]||jt(a)!=4||a.Z()!=2)){if(a.u&&jt(a)==4)Up(a.Ea,0,a);else if(Ke(a,"readystatechange"),jt(a)==4){a.h=!1;try{let L=a.Z();e:switch(L){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var g;if(g=L===0){var A=String(a.D).match(am)[1]||null;!A&&c.self&&c.self.location&&(A=c.self.location.protocol.slice(0,-1)),g=!xw.test(A?A.toLowerCase():"")}d=g}if(d)Ke(a,"complete"),Ke(a,"success");else{a.m=6;try{var P=2<jt(a)?a.g.statusText:""}catch{P=""}a.l=P+" ["+a.Z()+"]",gm(a)}}finally{Ro(a)}}}}function Ro(a,l){if(a.g){ym(a);let d=a.g,g=a.v[0]?()=>{}:null;a.g=null,a.v=null,l||Ke(a,"ready");try{d.onreadystatechange=g}catch{}}}function ym(a){a.I&&(c.clearTimeout(a.I),a.I=null)}n.isActive=function(){return!!this.g};function jt(a){return a.g?a.g.readyState:0}n.Z=function(){try{return 2<jt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(a){if(this.g){var l=this.g.responseText;return a&&l.indexOf(a)==0&&(l=l.substring(a.length)),dw(l)}};function vm(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function Vw(a){let l={};a=(a.g&&2<=jt(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<a.length;g++){if(W(a[g]))continue;var d=T(a[g]);let A=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let P=l[A]||[];l[A]=P,P.push(d)}w(l,function(g){return g.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ji(a,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||l}function Im(a){this.Aa=0,this.i=[],this.j=new ji,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ji("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ji("baseRetryDelayMs",5e3,a),this.cb=Ji("retryDelaySeedMs",1e4,a),this.Wa=Ji("forwardChannelMaxRetries",2,a),this.wa=Ji("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new tm(a&&a.concurrentRequestLimit),this.Da=new kw,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Im.prototype,n.la=8,n.G=1,n.connect=function(a,l,d,g){$e(0),this.W=a,this.H=l||{},d&&g!==void 0&&(this.H.OSID=d,this.H.OAID=g),this.F=this.X,this.I=Cm(this,null,this.W),Co(this)};function hu(a){if(wm(a),a.G==3){var l=a.U++,d=qt(a.I);if(ce(d,"SID",a.K),ce(d,"RID",l),ce(d,"TYPE","terminate"),Yi(a,d),l=new on(a,a.j,l),l.L=2,l.v=bo(qt(d)),d=!1,c.navigator&&c.navigator.sendBeacon)try{d=c.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&c.Image&&(new Image().src=l.v,d=!0),d||(l.g=Nm(l.j,null),l.g.ea(l.v)),l.F=Date.now(),Eo(l)}Pm(a)}function Po(a){a.g&&(fu(a),a.g.cancel(),a.g=null)}function wm(a){Po(a),a.u&&(c.clearTimeout(a.u),a.u=null),No(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&c.clearTimeout(a.s),a.s=null)}function Co(a){if(!nm(a.h)&&!a.s){a.s=!0;var l=a.Ga;Oi||xp(),Vi||(Oi(),Vi=!0),Gc.add(l,a),a.B=0}}function Lw(a,l){return rm(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=l.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=qi(_(a.Ga,a,l),Rm(a,a.B)),a.B++,!0)}n.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;let A=new on(this,this.j,a),P=this.o;if(this.S&&(P?(P=y(P),E(P,this.S)):P=this.S),this.m!==null||this.O||(A.H=P,P=null),this.P)e:{for(var l=0,d=0;d<this.i.length;d++){t:{var g=this.i[d];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(l+=g,4096<l){l=d;break e}if(l===4096||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=Tm(this,A,l),d=qt(this.I),ce(d,"RID",a),ce(d,"CVER",22),this.D&&ce(d,"X-HTTP-Session-Id",this.D),Yi(this,d),P&&(this.O?l="headers="+encodeURIComponent(String(pm(P)))+"&"+l:this.m&&lu(d,this.m,P)),uu(this.h,A),this.Ua&&ce(d,"TYPE","init"),this.P?(ce(d,"$req",l),ce(d,"SID","null"),A.T=!0,su(A,d,null)):su(A,d,l),this.G=2}}else this.G==3&&(a?Em(this,a):this.i.length==0||nm(this.h)||Em(this))};function Em(a,l){var d;l?d=l.l:d=a.U++;let g=qt(a.I);ce(g,"SID",a.K),ce(g,"RID",d),ce(g,"AID",a.T),Yi(a,g),a.m&&a.o&&lu(g,a.m,a.o),d=new on(a,a.j,d,a.B+1),a.m===null&&(d.H=a.o),l&&(a.i=l.D.concat(a.i)),l=Tm(a,d,1e3),d.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),uu(a.h,d),su(d,g,l)}function Yi(a,l){a.H&&K(a.H,function(d,g){ce(l,g,d)}),a.l&&om({},function(d,g){ce(l,g,d)})}function Tm(a,l,d){d=Math.min(a.i.length,d);var g=a.l?_(a.l.Na,a.l,a):null;e:{var A=a.i;let P=-1;for(;;){let L=["count="+d];P==-1?0<d?(P=A[0].g,L.push("ofs="+P)):P=0:L.push("ofs="+P);let ie=!0;for(let Le=0;Le<d;Le++){let ne=A[Le].g,qe=A[Le].map;if(ne-=P,0>ne)P=Math.max(0,A[Le].g-100),ie=!1;else try{Dw(qe,L,"req"+ne+"_")}catch{g&&g(qe)}}if(ie){g=L.join("&");break e}}}return a=a.i.splice(0,d),l.D=a,g}function Am(a){if(!a.g&&!a.u){a.Y=1;var l=a.Fa;Oi||xp(),Vi||(Oi(),Vi=!0),Gc.add(l,a),a.v=0}}function du(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=qi(_(a.Fa,a),Rm(a,a.v)),a.v++,!0)}n.Fa=function(){if(this.u=null,bm(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=qi(_(this.ab,this),a)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,$e(10),Po(this),bm(this))};function fu(a){a.A!=null&&(c.clearTimeout(a.A),a.A=null)}function bm(a){a.g=new on(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var l=qt(a.qa);ce(l,"RID","rpc"),ce(l,"SID",a.K),ce(l,"AID",a.T),ce(l,"CI",a.F?"0":"1"),!a.F&&a.ja&&ce(l,"TO",a.ja),ce(l,"TYPE","xmlhttp"),Yi(a,l),a.m&&a.o&&lu(l,a.m,a.o),a.L&&(a.g.I=a.L);var d=a.g;a=a.ia,d.L=1,d.v=bo(qt(l)),d.m=null,d.P=!0,Xp(d,a)}n.Za=function(){this.C!=null&&(this.C=null,Po(this),du(this),$e(19))};function No(a){a.C!=null&&(c.clearTimeout(a.C),a.C=null)}function Sm(a,l){var d=null;if(a.g==l){No(a),fu(a),a.g=null;var g=2}else if(cu(a.h,l))d=l.D,im(a.h,l),g=1;else return;if(a.G!=0){if(l.o)if(g==1){d=l.m?l.m.length:0,l=Date.now()-l.F;var A=a.B;g=vo(),Ke(g,new Hp(g,d)),Co(a)}else Am(a);else if(A=l.s,A==3||A==0&&0<l.X||!(g==1&&Lw(a,l)||g==2&&du(a)))switch(d&&0<d.length&&(l=a.h,l.i=l.i.concat(d)),A){case 1:qn(a,5);break;case 4:qn(a,10);break;case 3:qn(a,6);break;default:qn(a,2)}}}function Rm(a,l){let d=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(d*=2),d*l}function qn(a,l){if(a.j.info("Error code "+l),l==2){var d=_(a.fb,a),g=a.Xa;let A=!g;g=new Bn(g||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||To(g,"https"),bo(g),A?Cw(g.toString(),d):Nw(g.toString(),d)}else $e(2);a.G=0,a.l&&a.l.sa(l),Pm(a),wm(a)}n.fb=function(a){a?(this.j.info("Successfully pinged google.com"),$e(2)):(this.j.info("Failed to ping google.com"),$e(1))};function Pm(a){if(a.G=0,a.ka=[],a.l){let l=sm(a.h);(l.length!=0||a.i.length!=0)&&(D(a.ka,l),D(a.ka,a.i),a.h.i.length=0,O(a.i),a.i.length=0),a.l.ra()}}function Cm(a,l,d){var g=d instanceof Bn?qt(d):new Bn(d);if(g.g!="")l&&(g.g=l+"."+g.g),Ao(g,g.s);else{var A=c.location;g=A.protocol,l=l?l+"."+A.hostname:A.hostname,A=+A.port;var P=new Bn(null);g&&To(P,g),l&&(P.g=l),A&&Ao(P,A),d&&(P.l=d),g=P}return d=a.D,l=a.ya,d&&l&&ce(g,d,l),ce(g,"VER",a.la),Yi(a,g),g}function Nm(a,l,d){if(l&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=a.Ca&&!a.pa?new me(new $i({eb:d})):new me(a.pa),l.Ha(a.J),l}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function km(){}n=km.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function ko(){}ko.prototype.g=function(a,l){return new et(a,l)};function et(a,l){Be.call(this),this.g=new Im(l),this.l=a,this.h=l&&l.messageUrlParams||null,a=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(a?a["X-WebChannel-Content-Type"]=l.messageContentType:a={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(a?a["X-WebChannel-Client-Profile"]=l.va:a={"X-WebChannel-Client-Profile":l.va}),this.g.S=a,(a=l&&l.Sb)&&!W(a)&&(this.g.m=a),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!W(l)&&(this.g.D=l,a=this.h,a!==null&&l in a&&(a=this.h,l in a&&delete a[l])),this.j=new kr(this)}k(et,Be),et.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},et.prototype.close=function(){hu(this.g)},et.prototype.o=function(a){var l=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.u&&(d={},d.__data__=Zc(a),a=d);l.i.push(new vw(l.Ya++,a)),l.G==3&&Co(l)},et.prototype.N=function(){this.g.l=null,delete this.j,hu(this.g),delete this.g,et.aa.N.call(this)};function Dm(a){tu.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var l=a.__sm__;if(l){e:{for(let d in l){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,l=l!==null&&a in l?l[a]:void 0),this.data=l}else this.data=a}k(Dm,tu);function xm(){nu.call(this),this.status=1}k(xm,nu);function kr(a){this.g=a}k(kr,km),kr.prototype.ua=function(){Ke(this.g,"a")},kr.prototype.ta=function(a){Ke(this.g,new Dm(a))},kr.prototype.sa=function(a){Ke(this.g,new xm)},kr.prototype.ra=function(){Ke(this.g,"b")},ko.prototype.createWebChannel=ko.prototype.g,et.prototype.send=et.prototype.o,et.prototype.open=et.prototype.m,et.prototype.close=et.prototype.close,kh=Ht.createWebChannelTransport=function(){return new ko},Nh=Ht.getStatEventTarget=function(){return vo()},Ch=Ht.Event=Fn,Ta=Ht.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Io.NO_ERROR=0,Io.TIMEOUT=8,Io.HTTP_ERROR=6,Ps=Ht.ErrorCode=Io,Qp.COMPLETE="complete",Ph=Ht.EventType=Qp,Gp.EventType=Ui,Ui.OPEN="a",Ui.CLOSE="b",Ui.ERROR="c",Ui.MESSAGE="d",Be.prototype.listen=Be.prototype.K,Kr=Ht.WebChannel=Gp,Xb=Ht.FetchXmlHttpFactory=$i,me.prototype.listenOnce=me.prototype.L,me.prototype.getLastError=me.prototype.Ka,me.prototype.getLastErrorCode=me.prototype.Ba,me.prototype.getStatus=me.prototype.Z,me.prototype.getResponseJson=me.prototype.Oa,me.prototype.getResponseText=me.prototype.oa,me.prototype.send=me.prototype.ea,me.prototype.setWithCredentials=me.prototype.Ha,Rh=Ht.XhrIo=me}).apply(typeof Ea<"u"?Ea:typeof self<"u"?self:typeof window<"u"?window:{});var S_="@firebase/firestore";var Ce=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Ce.UNAUTHENTICATED=new Ce(null),Ce.GOOGLE_CREDENTIALS=new Ce("google-credentials-uid"),Ce.FIRST_PARTY=new Ce("first-party-uid"),Ce.MOCK_USER=new Ce("mock-user");var Ti="10.14.0";var bn=new Et("@firebase/firestore");function Yr(){return bn.logLevel}function Cy(n){bn.setLogLevel(n)}function x(n,...e){if(bn.logLevel<=J.DEBUG){let t=e.map(Mf);bn.debug(`Firestore (${Ti}): ${n}`,...t)}}function ve(n,...e){if(bn.logLevel<=J.ERROR){let t=e.map(Mf);bn.error(`Firestore (${Ti}): ${n}`,...t)}}function gt(n,...e){if(bn.logLevel<=J.WARN){let t=e.map(Mf);bn.warn(`Firestore (${Ti}): ${n}`,...t)}}function Mf(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function U(n="Unexpected state"){let e=`FIRESTORE (${Ti}) INTERNAL ASSERTION FAILED: `+n;throw ve(e),new Error(e)}function B(n,e){n||U()}function Ny(n,e){n||U()}function M(n,e){return n}var C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},N=class extends Te{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var ke=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var xa=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Mh=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ce.UNAUTHENTICATED))}shutdown(){}},Fh=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Uh=class{constructor(e){this.t=e,this.currentUser=Ce.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){B(this.o===void 0);let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new ke;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ke,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>p(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},c=u=>{x("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>c(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?c(u):(x("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ke)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(x("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(B(typeof r.accessToken=="string"),new xa(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return B(e===null||typeof e=="string"),new Ce(e)}},Bh=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Ce.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},qh=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new Bh(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ce.FIRST_PARTY))}shutdown(){}invalidateToken(){}},jh=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},zh=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){B(this.o===void 0);let r=s=>{s.error!=null&&x("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,x("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{x("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):x("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(B(typeof t.token=="string"),this.R=t.token,new jh(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function Zb(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Oa=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=Zb(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function $(n,e){return n<e?-1:n>e?1:0}function oi(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function ky(n){return n+"\0"}var fe=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new N(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new N(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new N(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new N(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?$(this.nanoseconds,e.nanoseconds):$(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var j=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new fe(0,0))}static max(){return new n(new fe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Va=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&U(),r===void 0?r=e.length-t:r>e.length-t&&U(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},Z=class n extends Va{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new N(C.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},eS=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ie=class n extends Va{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return eS.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new N(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let c=e[i];if(c==="\\"){if(i+1===e.length)throw new N(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new N(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else c==="`"?(o=!o,i++):c!=="."||o?(r+=c,i++):(s(),i++)}if(s(),o)throw new N(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var F=class n{constructor(e){this.path=e}static fromPath(e){return new n(Z.fromString(e))}static fromName(e){return new n(Z.fromString(e).popFirst(5))}static empty(){return new n(Z.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Z.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Z.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new Z(e.slice()))}};var ai=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function Gh(n){return n.fields.find(e=>e.kind===2)}function ir(n){return n.fields.filter(e=>e.kind!==2)}ai.UNKNOWN_ID=-1;var ri=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Bs=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,ct.min())}};function Dy(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=j.fromTimestamp(r===1e9?new fe(t+1,0):new fe(t,r));return new ct(i,F.empty(),e)}function xy(n){return new ct(n.readTime,n.key,-1)}var ct=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(j.min(),F.empty(),-1)}static max(){return new n(j.max(),F.empty(),-1)}};function Ff(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=F.comparator(n.documentKey,e.documentKey),t!==0?t:$(n.largestBatchId,e.largestBatchId))}var Oy="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",La=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Vn(n){return p(this,null,function*(){if(n.code!==C.FAILED_PRECONDITION||n.message!==Oy)throw n;x("LocalStore","Unexpectedly lost primary lease")})}var R=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&U(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(c=>{++i,c.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),c=0;for(let u=0;u<s;u++){let h=u;t(e[h]).next(f=>{o[h]=f,++c,c===s&&r(o)},f=>i(f))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var Ma=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new ke,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new lr(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=Uf(r.target.error);this.V.reject(new lr(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new lr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(x("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Kh(t)}},Sn=class n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,n.S(oe())===12.2&&ve("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return x("SimpleDb","Removing database:",e),sr(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!un())return!1;if(n.v())return!0;let e=oe(),t=n.S(e),r=0<t&&t<10,i=Vy(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}M(e){return p(this,null,function*(){return this.db||(x("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new lr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new N(C.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new N(C.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new lr(e,o))},i.onupgradeneeded=s=>{x("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{x("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db})}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return p(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.M(e);let c=Ma.open(this.db,e,s?"readonly":"readwrite",r),u=i(c).next(h=>(c.g(),h)).catch(h=>(c.abort(h),R.reject(h))).toPromise();return u.catch(()=>{}),yield c.m,u}catch(c){let u=c,h=u.name!=="FirebaseError"&&o<3;if(x("SimpleDb","Transaction failed with error:",u.message,"Retrying:",h),this.close(),!h)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function Vy(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Wh=class{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return sr(this.B.delete())}},lr=class extends N{constructor(e,t){super(C.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Ln(n){return n.name==="IndexedDbTransactionError"}var Kh=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(x("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(x("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),sr(r)}add(e){return x("SimpleDb","ADD",this.store.name,e,e),sr(this.store.add(e))}get(e){return sr(this.store.get(e)).next(t=>(t===void 0&&(t=null),x("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return x("SimpleDb","DELETE",this.store.name,e),sr(this.store.delete(e))}count(){return x("SimpleDb","COUNT",this.store.name),sr(this.store.count())}U(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new R((o,c)=>{s.onerror=u=>{c(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.W(s,(c,u)=>{o.push(u)}).next(()=>o)}}G(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new R((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(e,t){x("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.H=!1;let i=this.cursor(r);return this.W(i,(s,o,c)=>c.delete())}J(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.W(i,t)}Y(e){let t=this.cursor({});return new R((r,i)=>{t.onerror=s=>{let o=Uf(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(c=>{c?o.continue():r()}):r()}})}W(e,t){let r=[];return new R((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let c=o.target.result;if(!c)return void i();let u=new Wh(c),h=t(c.primaryKey,c.value,u);if(h instanceof R){let f=h.catch(m=>(u.done(),R.reject(m)));r.push(f)}u.isDone?i():u.K===null?c.continue():c.continue(u.K)}}).next(()=>R.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function sr(n){return new R((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=Uf(r.target.error);t(i)}})}var R_=!1;function Uf(n){let e=Sn.S(oe());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new N("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return R_||(R_=!0,setTimeout(()=>{throw r},0)),r}}return n}var $h=class{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){x("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>p(this,null,function*(){this.task=null;try{x("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(t){Ln(t)?x("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield Vn(t)}yield this.X(6e4)}))}},Hh=class{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){return p(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))})}te(e,t){let r=new Set,i=t,s=!0;return R.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return x("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(c=>{i-=c,r.add(o)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(c=>(x("IndexBackfiller",`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(e,t,c))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=xy(s);Ff(o,r)>0&&(r=o)}),new ct(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var nt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ie(i),this.se=i=>r.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.se&&this.se(t),t}}return n.oe=-1,n})();function ao(n){return n==null}function qs(n){return n===0&&1/n==-1/0}function Ly(n){return typeof n=="number"&&Number.isInteger(n)&&!qs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Qe(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=P_(e)),e=tS(n.get(t),e);return P_(e)}function tS(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function P_(n){return n+""}function Nt(n){let e=n.length;if(B(e>=2),e===2)return B(n.charAt(0)===""&&n.charAt(1)===""),Z.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&U(),n.charAt(o+1)){case"":let c=n.substring(s,o),u;i.length===0?u=c:(i+=c,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:U()}s=o+2}return new Z(r)}var C_=["userId","batchId"];function Pa(n,e){return[n,Qe(e)]}function My(n,e,t){return[n,Qe(e),t]}var nS={},rS=["prefixPath","collectionGroup","readTime","documentId"],iS=["prefixPath","collectionGroup","documentId"],sS=["collectionGroup","readTime","prefixPath","documentId"],oS=["canonicalId","targetId"],aS=["targetId","path"],cS=["path","targetId"],uS=["collectionId","parent"],lS=["indexId","uid"],hS=["uid","sequenceNumber"],dS=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],fS=["indexId","uid","orderedDocumentKey"],pS=["userId","collectionPath","documentId"],mS=["userId","collectionPath","largestBatchId"],gS=["userId","collectionGroup","largestBatchId"],Fy=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],_S=[...Fy,"documentOverlays"],Uy=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],By=Uy,Bf=[...By,"indexConfiguration","indexState","indexEntries"],yS=Bf,vS=[...Bf,"globals"];var js=class extends La{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}};function De(n,e){let t=M(n);return Sn.F(t._e,e)}function N_(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Er(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function qy(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var le=class n{constructor(e,t){this.comparator=e,this.root=t||Dt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Dt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Dt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ni(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ni(this.root,e,this.comparator,!1)}getReverseIterator(){return new ni(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ni(this.root,e,this.comparator,!0)}},ni=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Dt=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw U();let e=this.left.check();if(e!==this.right.check())throw U();return e+(this.isRed()?0:1)}};Dt.EMPTY=null,Dt.RED=!0,Dt.BLACK=!1;Dt.EMPTY=new class{constructor(){this.size=0}get key(){throw U()}get value(){throw U()}get color(){throw U()}get left(){throw U()}get right(){throw U()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Dt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var se=class n{constructor(e){this.comparator=e,this.data=new le(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Fa(this.data.getIterator())}getIteratorFrom(e){return new Fa(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Fa=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function $r(n){return n.hasNext()?n.getNext():void 0}var rt=class n{constructor(e){this.fields=e,e.sort(Ie.comparator)}static empty(){return new n([])}unionWith(e){let t=new se(Ie.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return oi(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Ua=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function jy(){return typeof atob<"u"}var Ee=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Ua("Invalid base64 string: "+s):s}})(e);return new n(t)}static fromUint8Array(e){let t=(function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s})(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return $(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ee.EMPTY_BYTE_STRING=new Ee("");var IS=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Yt(n){if(B(!!n),typeof n=="string"){let e=0,t=IS.exec(n);if(B(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:he(n.seconds),nanos:he(n.nanos)}}function he(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Rn(n){return typeof n=="string"?Ee.fromBase64String(n):Ee.fromUint8Array(n)}function Nc(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function qf(n){let e=n.mapValue.fields.__previous_value__;return Nc(e)?qf(e):e}function zs(n){let e=Yt(n.mapValue.fields.__local_write_time__.timestampValue);return new fe(e.seconds,e.nanos)}var Qh=class{constructor(e,t,r,i,s,o,c,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=h}},Pn=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Tn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ca={nullValue:"NULL_VALUE"};function hr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Nc(n)?4:zy(n)?9007199254740991:kc(n)?10:11:U()}function Vt(n,e){if(n===e)return!0;let t=hr(n);if(t!==hr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return zs(n).isEqual(zs(e));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=Yt(i.timestampValue),c=Yt(s.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,s){return Rn(i.bytesValue).isEqual(Rn(s.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,s){return he(i.geoPointValue.latitude)===he(s.geoPointValue.latitude)&&he(i.geoPointValue.longitude)===he(s.geoPointValue.longitude)})(n,e);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return he(i.integerValue)===he(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=he(i.doubleValue),c=he(s.doubleValue);return o===c?qs(o)===qs(c):isNaN(o)&&isNaN(c)}return!1})(n,e);case 9:return oi(n.arrayValue.values||[],e.arrayValue.values||[],Vt);case 10:case 11:return(function(i,s){let o=i.mapValue.fields||{},c=s.mapValue.fields||{};if(N_(o)!==N_(c))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(c[u]===void 0||!Vt(o[u],c[u])))return!1;return!0})(n,e);default:return U()}}function Gs(n,e){return(n.values||[]).find(t=>Vt(t,e))!==void 0}function Cn(n,e){if(n===e)return 0;let t=hr(n),r=hr(e);if(t!==r)return $(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return $(n.booleanValue,e.booleanValue);case 2:return(function(s,o){let c=he(s.integerValue||s.doubleValue),u=he(o.integerValue||o.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1})(n,e);case 3:return k_(n.timestampValue,e.timestampValue);case 4:return k_(zs(n),zs(e));case 5:return $(n.stringValue,e.stringValue);case 6:return(function(s,o){let c=Rn(s),u=Rn(o);return c.compareTo(u)})(n.bytesValue,e.bytesValue);case 7:return(function(s,o){let c=s.split("/"),u=o.split("/");for(let h=0;h<c.length&&h<u.length;h++){let f=$(c[h],u[h]);if(f!==0)return f}return $(c.length,u.length)})(n.referenceValue,e.referenceValue);case 8:return(function(s,o){let c=$(he(s.latitude),he(o.latitude));return c!==0?c:$(he(s.longitude),he(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return D_(n.arrayValue,e.arrayValue);case 10:return(function(s,o){var c,u,h,f;let m=s.fields||{},_=o.fields||{},b=(c=m.value)===null||c===void 0?void 0:c.arrayValue,k=(u=_.value)===null||u===void 0?void 0:u.arrayValue,O=$(((h=b?.values)===null||h===void 0?void 0:h.length)||0,((f=k?.values)===null||f===void 0?void 0:f.length)||0);return O!==0?O:D_(b,k)})(n.mapValue,e.mapValue);case 11:return(function(s,o){if(s===Tn.mapValue&&o===Tn.mapValue)return 0;if(s===Tn.mapValue)return 1;if(o===Tn.mapValue)return-1;let c=s.fields||{},u=Object.keys(c),h=o.fields||{},f=Object.keys(h);u.sort(),f.sort();for(let m=0;m<u.length&&m<f.length;++m){let _=$(u[m],f[m]);if(_!==0)return _;let b=Cn(c[u[m]],h[f[m]]);if(b!==0)return b}return $(u.length,f.length)})(n.mapValue,e.mapValue);default:throw U()}}function k_(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return $(n,e);let t=Yt(n),r=Yt(e),i=$(t.seconds,r.seconds);return i!==0?i:$(t.nanos,r.nanos)}function D_(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Cn(t[i],r[i]);if(s)return s}return $(t.length,r.length)}function ci(n){return Jh(n)}function Jh(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){let r=Yt(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Rn(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return F.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=Jh(s);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${Jh(t.fields[o])}`;return i+"}"})(n.mapValue):U()}function dr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Yh(n){return!!n&&"integerValue"in n}function Ws(n){return!!n&&"arrayValue"in n}function x_(n){return!!n&&"nullValue"in n}function O_(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Na(n){return!!n&&"mapValue"in n}function kc(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Vs(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Er(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Vs(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Vs(n.arrayValue.values[t]);return e}return Object.assign({},n)}function zy(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var Gy={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function wS(n){return"nullValue"in n?Ca:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?dr(Pn.empty(),F.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?kc(n)?Gy:{mapValue:{}}:U()}function ES(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?dr(Pn.empty(),F.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Gy:"mapValue"in n?kc(n)?{mapValue:{}}:Tn:U()}function V_(n,e){let t=Cn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function L_(n,e){let t=Cn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var We=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Na(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Vs(t)}setAll(e){let t=Ie.emptyPath(),r={},i=[];e.forEach((o,c)=>{if(!t.isImmediateParentOf(c)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=c.popLast()}o?r[c.lastSegment()]=Vs(o):i.push(c.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Na(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Vt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Na(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Er(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Vs(this.value))}};function Wy(n){let e=[];return Er(n.fields,(t,r)=>{let i=new Ie([t]);if(Na(r)){let s=Wy(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new rt(e)}var Ne=class n{constructor(e,t,r,i,s,o,c){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=c}static newInvalidDocument(e){return new n(e,0,j.min(),j.min(),j.min(),We.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,j.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,j.min(),j.min(),We.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,j.min(),j.min(),We.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(j.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=We.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=We.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Lt=class{constructor(e,t){this.position=e,this.inclusive=t}};function M_(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=F.comparator(F.fromName(o.referenceValue),t.key):r=Cn(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function F_(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Vt(n.position[t],e.position[t]))return!1;return!0}var fr=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function TS(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Ba=class{},Y=class n extends Ba{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new ed(e,t,r):t==="array-contains"?new rd(e,r):t==="in"?new qa(e,r):t==="not-in"?new id(e,r):t==="array-contains-any"?new sd(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new td(e,r):new nd(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Cn(t,this.value)):t!==null&&hr(this.value)===hr(t)&&this.matchesComparison(Cn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return U()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},re=class n extends Ba{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new n(e,t)}matches(e){return ui(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function ui(n){return n.op==="and"}function Xh(n){return n.op==="or"}function jf(n){return Ky(n)&&ui(n)}function Ky(n){for(let e of n.filters)if(e instanceof re)return!1;return!0}function Zh(n){if(n instanceof Y)return n.field.canonicalString()+n.op.toString()+ci(n.value);if(jf(n))return n.filters.map(e=>Zh(e)).join(",");{let e=n.filters.map(t=>Zh(t)).join(",");return`${n.op}(${e})`}}function $y(n,e){return n instanceof Y?(function(r,i){return i instanceof Y&&r.op===i.op&&r.field.isEqual(i.field)&&Vt(r.value,i.value)})(n,e):n instanceof re?(function(r,i){return i instanceof re&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,c)=>s&&$y(o,i.filters[c]),!0):!1})(n,e):void U()}function Hy(n,e){let t=n.filters.concat(e);return re.create(t,n.op)}function Qy(n){return n instanceof Y?(function(t){return`${t.field.canonicalString()} ${t.op} ${ci(t.value)}`})(n):n instanceof re?(function(t){return t.op.toString()+" {"+t.getFilters().map(Qy).join(" ,")+"}"})(n):"Filter"}var ed=class extends Y{constructor(e,t,r){super(e,t,r),this.key=F.fromName(r.referenceValue)}matches(e){let t=F.comparator(e.key,this.key);return this.matchesComparison(t)}},td=class extends Y{constructor(e,t){super(e,"in",t),this.keys=Jy("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},nd=class extends Y{constructor(e,t){super(e,"not-in",t),this.keys=Jy("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Jy(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>F.fromName(r.referenceValue))}var rd=class extends Y{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Ws(t)&&Gs(t.arrayValue,this.value)}},qa=class extends Y{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Gs(this.value.arrayValue,t)}},id=class extends Y{constructor(e,t){super(e,"not-in",t)}matches(e){if(Gs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Gs(this.value.arrayValue,t)}},sd=class extends Y{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Ws(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Gs(this.value.arrayValue,r))}};var od=class{constructor(e,t=null,r=[],i=[],s=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=c,this.ue=null}};function ad(n,e=null,t=[],r=[],i=null,s=null,o=null){return new od(n,e,t,r,i,s,o)}function pr(n){let e=M(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Zh(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>(function(s){return s.field.canonicalString()+s.dir})(r)).join(","),ao(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>ci(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>ci(r)).join(",")),e.ue=t}return e.ue}function co(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!TS(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!$y(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!F_(n.startAt,e.startAt)&&F_(n.endAt,e.endAt)}function ja(n){return F.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function za(n,e){return n.filters.filter(t=>t instanceof Y&&t.field.isEqual(e))}function U_(n,e,t){let r=Ca,i=!0;for(let s of za(n,e)){let o=Ca,c=!0;switch(s.op){case"<":case"<=":o=wS(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,c=!1;break;case"!=":case"not-in":o=Ca}V_({value:r,inclusive:i},{value:o,inclusive:c})<0&&(r=o,i=c)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];V_({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function B_(n,e,t){let r=Tn,i=!0;for(let s of za(n,e)){let o=Tn,c=!0;switch(s.op){case">=":case">":o=ES(s.value),c=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,c=!1;break;case"!=":case"not-in":o=Tn}L_({value:r,inclusive:i},{value:o,inclusive:c})>0&&(r=o,i=c)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];L_({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var _t=class{constructor(e,t=null,r=[],i=[],s=null,o="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=c,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function Yy(n,e,t,r,i,s,o,c){return new _t(n,e,t,r,i,s,o,c)}function Ai(n){return new _t(n)}function q_(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function zf(n){return n.collectionGroup!==null}function ii(n){let e=M(n);if(e.ce===null){e.ce=[];let t=new Set;for(let s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new se(Ie.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(h=>{h.isInequality()&&(c=c.add(h.field))})}),c})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new fr(s,r))}),t.has(Ie.keyField().canonicalString())||e.ce.push(new fr(Ie.keyField(),r))}return e.ce}function Je(n){let e=M(n);return e.le||(e.le=AS(e,ii(n))),e.le}function AS(n,e){if(n.limitType==="F")return ad(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new fr(i.field,s)});let t=n.endAt?new Lt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Lt(n.startAt.position,n.startAt.inclusive):null;return ad(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function cd(n,e){let t=n.filters.concat([e]);return new _t(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Ga(n,e,t){return new _t(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function uo(n,e){return co(Je(n),Je(e))&&n.limitType===e.limitType}function Xy(n){return`${pr(Je(n))}|lt:${n.limitType}`}function Xr(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Qy(i)).join(", ")}]`),ao(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>ci(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>ci(i)).join(",")),`Target(${r})`})(Je(n))}; limitType=${n.limitType})`}function lo(n,e){return e.isFoundDocument()&&(function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):F.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)})(n,e)&&(function(r,i){for(let s of ii(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(o,c,u){let h=M_(o,c,u);return o.inclusive?h<=0:h<0})(r.startAt,ii(r),i)||r.endAt&&!(function(o,c,u){let h=M_(o,c,u);return o.inclusive?h>=0:h>0})(r.endAt,ii(r),i))})(n,e)}function Zy(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function ev(n){return(e,t)=>{let r=!1;for(let i of ii(n)){let s=bS(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function bS(n,e,t){let r=n.field.isKeyField()?F.comparator(e.key,t.key):(function(s,o,c){let u=o.data.field(s),h=c.data.field(s);return u!==null&&h!==null?Cn(u,h):U()})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return U()}}var Mt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Er(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return qy(this.inner)}size(){return this.innerSize}};var SS=new le(F.comparator);function Ze(){return SS}var tv=new le(F.comparator);function xs(...n){let e=tv;for(let t of n)e=e.insert(t.key,t);return e}function nv(n){let e=tv;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function kt(){return Ls()}function rv(){return Ls()}function Ls(){return new Mt(n=>n.toString(),(n,e)=>n.isEqual(e))}var RS=new le(F.comparator),PS=new se(F.comparator);function H(...n){let e=PS;for(let t of n)e=e.add(t);return e}var CS=new se($);function Gf(){return CS}function Wf(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qs(e)?"-0":e}}function iv(n){return{integerValue:""+n}}function sv(n,e){return Ly(e)?iv(e):Wf(n,e)}var li=class{constructor(){this._=void 0}};function NS(n,e,t){return n instanceof Nn?(function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Nc(s)&&(s=qf(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}})(t,e):n instanceof Xt?av(n,e):n instanceof Zt?cv(n,e):(function(i,s){let o=ov(i,s),c=j_(o)+j_(i.Pe);return Yh(o)&&Yh(i.Pe)?iv(c):Wf(i.serializer,c)})(n,e)}function kS(n,e,t){return n instanceof Xt?av(n,e):n instanceof Zt?cv(n,e):t}function ov(n,e){return n instanceof kn?(function(r){return Yh(r)||(function(s){return!!s&&"doubleValue"in s})(r)})(e)?e:{integerValue:0}:null}var Nn=class extends li{},Xt=class extends li{constructor(e){super(),this.elements=e}};function av(n,e){let t=uv(e);for(let r of n.elements)t.some(i=>Vt(i,r))||t.push(r);return{arrayValue:{values:t}}}var Zt=class extends li{constructor(e){super(),this.elements=e}};function cv(n,e){let t=uv(e);for(let r of n.elements)t=t.filter(i=>!Vt(i,r));return{arrayValue:{values:t}}}var kn=class extends li{constructor(e,t){super(),this.serializer=e,this.Pe=t}};function j_(n){return he(n.integerValue||n.doubleValue)}function uv(n){return Ws(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var mr=class{constructor(e,t){this.field=e,this.transform=t}};function DS(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof Xt&&i instanceof Xt||r instanceof Zt&&i instanceof Zt?oi(r.elements,i.elements,Vt):r instanceof kn&&i instanceof kn?Vt(r.Pe,i.Pe):r instanceof Nn&&i instanceof Nn})(n.transform,e.transform)}var ud=class{constructor(e,t){this.version=e,this.transformResults=t}},ye=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function ka(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var hi=class{};function lv(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new xn(n.key,ye.none()):new Dn(n.key,n.data,ye.none());{let t=n.data,r=We.empty(),i=new se(Ie.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new yt(n.key,r,new rt(i.toArray()),ye.none())}}function xS(n,e,t){n instanceof Dn?(function(i,s,o){let c=i.value.clone(),u=G_(i.fieldTransforms,s,o.transformResults);c.setAll(u),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()})(n,e,t):n instanceof yt?(function(i,s,o){if(!ka(i.precondition,s))return void s.convertToUnknownDocument(o.version);let c=G_(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(hv(i)),u.setAll(c),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()})(n,e,t):(function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function Ms(n,e,t,r){return n instanceof Dn?(function(s,o,c,u){if(!ka(s.precondition,o))return c;let h=s.value.clone(),f=W_(s.fieldTransforms,u,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null})(n,e,t,r):n instanceof yt?(function(s,o,c,u){if(!ka(s.precondition,o))return c;let h=W_(s.fieldTransforms,u,o),f=o.data;return f.setAll(hv(s)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))})(n,e,t,r):(function(s,o,c){return ka(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c})(n,e,t)}function OS(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=ov(r.transform,i||null);s!=null&&(t===null&&(t=We.empty()),t.set(r.field,s))}return t||null}function z_(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&oi(r,i,(s,o)=>DS(s,o))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Dn=class extends hi{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},yt=class extends hi{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function hv(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function G_(n,e,t){let r=new Map;B(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,c=e.data.field(s.field);r.set(s.field,kS(o,c,t[i]))}return r}function W_(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,NS(s,o,e))}return r}var xn=class extends hi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Ks=class extends hi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var $s=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&xS(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ms(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Ms(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=rv();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,c=this.applyToLocalView(o,s.mutatedFields);c=t.has(i.key)?null:c;let u=lv(o,c);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(j.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),H())}isEqual(e){return this.batchId===e.batchId&&oi(this.mutations,e.mutations,(t,r)=>z_(t,r))&&oi(this.baseMutations,e.baseMutations,(t,r)=>z_(t,r))}},ld=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){B(e.mutations.length===r.length);let i=(function(){return RS})(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Hs=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var hd=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var Re,X;function dv(n){switch(n){default:return U();case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0}}function fv(n){if(n===void 0)return ve("GRPC error has no .code"),C.UNKNOWN;switch(n){case Re.OK:return C.OK;case Re.CANCELLED:return C.CANCELLED;case Re.UNKNOWN:return C.UNKNOWN;case Re.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case Re.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case Re.INTERNAL:return C.INTERNAL;case Re.UNAVAILABLE:return C.UNAVAILABLE;case Re.UNAUTHENTICATED:return C.UNAUTHENTICATED;case Re.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case Re.NOT_FOUND:return C.NOT_FOUND;case Re.ALREADY_EXISTS:return C.ALREADY_EXISTS;case Re.PERMISSION_DENIED:return C.PERMISSION_DENIED;case Re.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case Re.ABORTED:return C.ABORTED;case Re.OUT_OF_RANGE:return C.OUT_OF_RANGE;case Re.UNIMPLEMENTED:return C.UNIMPLEMENTED;case Re.DATA_LOSS:return C.DATA_LOSS;default:return U()}}(X=Re||(Re={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";var K_=null;function pv(){return new TextEncoder}var VS=new yn([4294967295,4294967295],0);function $_(n){let e=pv().encode(n),t=new Sh;return t.update(e),new Uint8Array(t.digest())}function H_(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new yn([t,r],0),new yn([i,s],0)]}var dd=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ur(`Invalid padding: ${t}`);if(r<0)throw new ur(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ur(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ur(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=yn.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(yn.fromNumber(r)));return i.compare(VS)===1&&(i=new yn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;let t=$_(e),[r,i]=H_(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(c=>o.insert(c)),o}insert(e){if(this.Ie===0)return;let t=$_(e),[r,i]=H_(t);for(let s=0;s<this.hashCount;s++){let o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},ur=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Qs=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Js.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(j.min(),i,new le($),Ze(),H())}},Js=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,H(),H(),H())}};var si=class{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}},Wa=class{constructor(e,t){this.targetId=e,this.me=t}},Ka=class{constructor(e,t,r=Ee.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},$a=class{constructor(){this.fe=0,this.ge=J_(),this.pe=Ee.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=H(),t=H(),r=H();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:U()}}),new Js(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=J_()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,B(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},fd=class{constructor(e){this.Le=e,this.Be=new Map,this.ke=Ze(),this.qe=Q_(),this.Qe=new le($)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:U()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){let t=e.targetId,r=e.me.count,i=this.Je(t);if(i){let s=i.target;if(ja(s))if(r===0){let o=new F(s.path);this.Ue(t,o,Ne.newNoDocument(o,j.min()))}else B(r===1);else{let o=this.Ye(t);if(o!==r){let c=this.Ze(e),u=c?this.Xe(c,e,o):1;if(u!==0){this.je(t);let h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,h)}K_?.et((function(f,m,_,b,k){var O,D,G,W,q,Q;let te={localCacheCount:f,existenceFilterCount:m.count,databaseId:_.database,projectId:_.projectId},K=m.unchangedNames;return K&&(te.bloomFilter={applied:k===0,hashCount:(O=K?.hashCount)!==null&&O!==void 0?O:0,bitmapLength:(W=(G=(D=K?.bits)===null||D===void 0?void 0:D.bitmap)===null||G===void 0?void 0:G.length)!==null&&W!==void 0?W:0,padding:(Q=(q=K?.bits)===null||q===void 0?void 0:q.padding)!==null&&Q!==void 0?Q:0,mightContain:w=>{var y;return(y=b?.mightContain(w))!==null&&y!==void 0&&y}}),te})(o,e.me,this.Le.tt(),c,u))}}}}Ze(e){let t=e.me.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,c;try{o=Rn(r).toUint8Array()}catch(u){if(u instanceof Ua)return gt("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new dd(o,i,s)}catch(u){return gt(u instanceof ur?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.Ie===0?null:c}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){let r=this.Le.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Le.tt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.Ue(t,s,null),i++)}),i}rt(e){let t=new Map;this.Be.forEach((s,o)=>{let c=this.Je(o);if(c){if(s.current&&ja(c.target)){let u=new F(c.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,Ne.newNoDocument(u,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let r=H();this.qe.forEach((s,o)=>{let c=!0;o.forEachWhile(u=>{let h=this.Je(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));let i=new Qs(e,t,this.Qe,this.ke,r);return this.ke=Ze(),this.qe=Q_(),this.Qe=new le($),i}$e(e,t){if(!this.ze(e))return;let r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;let i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new $a,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new se($),this.qe=this.qe.insert(e,t)),t}ze(e){let t=this.Je(e)!==null;return t||x("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new $a),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}};function Q_(){return new le(F.comparator)}function J_(){return new le(F.comparator)}var LS={asc:"ASCENDING",desc:"DESCENDING"},MS={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},FS={and:"AND",or:"OR"},pd=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function md(n,e){return n.useProto3Json||ao(e)?e:{value:e}}function di(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function mv(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function US(n,e){return di(n,e.toTimestamp())}function we(n){return B(!!n),j.fromTimestamp((function(t){let r=Yt(t);return new fe(r.seconds,r.nanos)})(n))}function Kf(n,e){return gd(n,e).canonicalString()}function gd(n,e){let t=(function(i){return new Z(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function gv(n){let e=Z.fromString(n);return B(Sv(e)),e}function Ys(n,e){return Kf(n.databaseId,e.path)}function xt(n,e){let t=gv(e);if(t.get(1)!==n.databaseId.projectId)throw new N(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new N(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new F(vv(t))}function _v(n,e){return Kf(n.databaseId,e)}function yv(n){let e=gv(n);return e.length===4?Z.emptyPath():vv(e)}function _d(n){return new Z(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function vv(n){return B(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Y_(n,e,t){return{name:Ys(n,e),fields:t.value.mapValue.fields}}function Iv(n,e,t){let r=xt(n,e.name),i=we(e.updateTime),s=e.createTime?we(e.createTime):j.min(),o=new We({mapValue:{fields:e.fields}}),c=Ne.newFoundDocument(r,i,s,o);return t&&c.setHasCommittedMutations(),t?c.setHasCommittedMutations():c}function BS(n,e){return"found"in e?(function(r,i){B(!!i.found),i.found.name,i.found.updateTime;let s=xt(r,i.found.name),o=we(i.found.updateTime),c=i.found.createTime?we(i.found.createTime):j.min(),u=new We({mapValue:{fields:i.found.fields}});return Ne.newFoundDocument(s,o,c,u)})(n,e):"missing"in e?(function(r,i){B(!!i.missing),B(!!i.readTime);let s=xt(r,i.missing),o=we(i.readTime);return Ne.newNoDocument(s,o)})(n,e):U()}function qS(n,e){let t;if("targetChange"in e){e.targetChange;let r=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:U()})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=(function(h,f){return h.useProto3Json?(B(f===void 0||typeof f=="string"),Ee.fromBase64String(f||"")):(B(f===void 0||f instanceof Buffer||f instanceof Uint8Array),Ee.fromUint8Array(f||new Uint8Array))})(n,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&(function(h){let f=h.code===void 0?C.UNKNOWN:fv(h.code);return new N(f,h.message||"")})(o);t=new Ka(r,i,s,c||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=xt(n,r.document.name),s=we(r.document.updateTime),o=r.document.createTime?we(r.document.createTime):j.min(),c=new We({mapValue:{fields:r.document.fields}}),u=Ne.newFoundDocument(i,s,o,c),h=r.targetIds||[],f=r.removedTargetIds||[];t=new si(h,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=xt(n,r.document),s=r.readTime?we(r.readTime):j.min(),o=Ne.newNoDocument(i,s),c=r.removedTargetIds||[];t=new si([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=xt(n,r.document),s=r.removedTargetIds||[];t=new si([],s,i,null)}else{if(!("filter"in e))return U();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new hd(i,s),c=r.targetId;t=new Wa(c,o)}}return t}function Xs(n,e){let t;if(e instanceof Dn)t={update:Y_(n,e.key,e.value)};else if(e instanceof xn)t={delete:Ys(n,e.key)};else if(e instanceof yt)t={update:Y_(n,e.key,e.data),updateMask:$S(e.fieldMask)};else{if(!(e instanceof Ks))return U();t={verify:Ys(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>(function(s,o){let c=o.transform;if(c instanceof Nn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Xt)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Zt)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof kn)return{fieldPath:o.field.canonicalString(),increment:c.Pe};throw U()})(0,r))),e.precondition.isNone||(t.currentDocument=(function(i,s){return s.updateTime!==void 0?{updateTime:US(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:U()})(n,e.precondition)),t}function yd(n,e){let t=e.currentDocument?(function(s){return s.updateTime!==void 0?ye.updateTime(we(s.updateTime)):s.exists!==void 0?ye.exists(s.exists):ye.none()})(e.currentDocument):ye.none(),r=e.updateTransforms?e.updateTransforms.map(i=>(function(o,c){let u=null;if("setToServerValue"in c)B(c.setToServerValue==="REQUEST_TIME"),u=new Nn;else if("appendMissingElements"in c){let f=c.appendMissingElements.values||[];u=new Xt(f)}else if("removeAllFromArray"in c){let f=c.removeAllFromArray.values||[];u=new Zt(f)}else"increment"in c?u=new kn(o,c.increment):U();let h=Ie.fromServerFormat(c.fieldPath);return new mr(h,u)})(n,i)):[];if(e.update){e.update.name;let i=xt(n,e.update.name),s=new We({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=(function(u){let h=u.fieldPaths||[];return new rt(h.map(f=>Ie.fromServerFormat(f)))})(e.updateMask);return new yt(i,s,o,t,r)}return new Dn(i,s,t,r)}if(e.delete){let i=xt(n,e.delete);return new xn(i,t)}if(e.verify){let i=xt(n,e.verify);return new Ks(i,t)}return U()}function jS(n,e){return n&&n.length>0?(B(e!==void 0),n.map(t=>(function(i,s){let o=i.updateTime?we(i.updateTime):we(s);return o.isEqual(j.min())&&(o=we(s)),new ud(o,i.transformResults||[])})(t,e))):[]}function wv(n,e){return{documents:[_v(n,e.path)]}}function Ev(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=_v(n,i);let s=(function(h){if(h.length!==0)return bv(re.create(h,"and"))})(e.filters);s&&(t.structuredQuery.where=s);let o=(function(h){if(h.length!==0)return h.map(f=>(function(_){return{field:Zr(_.field),direction:GS(_.dir)}})(f))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);let c=md(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{_t:t,parent:i}}function Tv(n){let e=yv(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){B(r===1);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=(function(m){let _=Av(m);return _ instanceof re&&jf(_)?_.getFilters():[_]})(t.where));let o=[];t.orderBy&&(o=(function(m){return m.map(_=>(function(k){return new fr(ei(k.field),(function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(k.direction))})(_))})(t.orderBy));let c=null;t.limit&&(c=(function(m){let _;return _=typeof m=="object"?m.value:m,ao(_)?null:_})(t.limit));let u=null;t.startAt&&(u=(function(m){let _=!!m.before,b=m.values||[];return new Lt(b,_)})(t.startAt));let h=null;return t.endAt&&(h=(function(m){let _=!m.before,b=m.values||[];return new Lt(b,_)})(t.endAt)),Yy(e,i,o,s,c,"F",u,h)}function zS(n,e){let t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return U()}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Av(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=ei(t.unaryFilter.field);return Y.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=ei(t.unaryFilter.field);return Y.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=ei(t.unaryFilter.field);return Y.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=ei(t.unaryFilter.field);return Y.create(o,"!=",{nullValue:"NULL_VALUE"});default:return U()}})(n):n.fieldFilter!==void 0?(function(t){return Y.create(ei(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return U()}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return re.create(t.compositeFilter.filters.map(r=>Av(r)),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return U()}})(t.compositeFilter.op))})(n):U()}function GS(n){return LS[n]}function WS(n){return MS[n]}function KS(n){return FS[n]}function Zr(n){return{fieldPath:n.canonicalString()}}function ei(n){return Ie.fromServerFormat(n.fieldPath)}function bv(n){return n instanceof Y?(function(t){if(t.op==="=="){if(O_(t.value))return{unaryFilter:{field:Zr(t.field),op:"IS_NAN"}};if(x_(t.value))return{unaryFilter:{field:Zr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(O_(t.value))return{unaryFilter:{field:Zr(t.field),op:"IS_NOT_NAN"}};if(x_(t.value))return{unaryFilter:{field:Zr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Zr(t.field),op:WS(t.op),value:t.value}}})(n):n instanceof re?(function(t){let r=t.getFilters().map(i=>bv(i));return r.length===1?r[0]:{compositeFilter:{op:KS(t.op),filters:r}}})(n):U()}function $S(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Sv(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var fi=class n{constructor(e,t,r,i,s=j.min(),o=j.min(),c=Ee.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Ha=class{constructor(e){this.ct=e}};function HS(n,e){let t;if(e.document)t=Iv(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=F.fromSegments(e.noDocument.path),i=_r(e.noDocument.readTime);t=Ne.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return U();{let r=F.fromSegments(e.unknownDocument.path),i=_r(e.unknownDocument.version);t=Ne.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime((function(i){let s=new fe(i[0],i[1]);return j.fromTimestamp(s)})(e.readTime)),t}function X_(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Qa(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=(function(s,o){return{name:Ys(s,o.key),fields:o.data.value.mapValue.fields,updateTime:di(s,o.version.toTimestamp()),createTime:di(s,o.createTime.toTimestamp())}})(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:gr(e.version)};else{if(!e.isUnknownDocument())return U();r.unknownDocument={path:t.path.toArray(),version:gr(e.version)}}return r}function Qa(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function gr(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function _r(n){let e=new fe(n.seconds,n.nanoseconds);return j.fromTimestamp(e)}function or(n,e){let t=(e.baseMutations||[]).map(s=>yd(n.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let c=e.mutations[s+1];o.updateTransforms=c.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>yd(n.ct,s)),i=fe.fromMillis(e.localWriteTimeMs);return new $s(e.batchId,i,t,r)}function Os(n){let e=_r(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?_r(n.lastLimboFreeSnapshotVersion):j.min(),r;return r=(function(s){return s.documents!==void 0})(n.query)?(function(s){return B(s.documents.length===1),Je(Ai(yv(s.documents[0])))})(n.query):(function(s){return Je(Tv(s))})(n.query),new fi(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ee.fromBase64String(n.resumeToken))}function Rv(n,e){let t=gr(e.snapshotVersion),r=gr(e.lastLimboFreeSnapshotVersion),i;i=ja(e.target)?wv(n.ct,e.target):Ev(n.ct,e.target)._t;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:pr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function $f(n){let e=Tv({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ga(e,e.limit,"L"):e}function Dh(n,e){return new Hs(e.largestBatchId,yd(n.ct,e.overlayMutation))}function Z_(n,e){let t=e.path.lastSegment();return[n,Qe(e.path.popLast()),t]}function ey(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:gr(r.readTime),documentKey:Qe(r.documentKey.path),largestBatchId:r.largestBatchId}}var vd=class{getBundleMetadata(e,t){return ty(e).get(t).next(r=>{if(r)return(function(s){return{id:s.bundleId,createTime:_r(s.createTime),version:s.version}})(r)})}saveBundleMetadata(e,t){return ty(e).put((function(i){return{bundleId:i.id,createTime:gr(we(i.createTime)),version:i.version}})(t))}getNamedQuery(e,t){return ny(e).get(t).next(r=>{if(r)return(function(s){return{name:s.name,query:$f(s.bundledQuery),readTime:_r(s.readTime)}})(r)})}saveNamedQuery(e,t){return ny(e).put((function(i){return{name:i.name,readTime:gr(we(i.readTime)),bundledQuery:i.bundledQuery}})(t))}};function ty(n){return De(n,"bundles")}function ny(n){return De(n,"namedQueries")}var Ja=class n{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Cs(e).get(Z_(this.userId,t)).next(r=>r?Dh(this.serializer,r):null)}getOverlays(e,t){let r=kt();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let c=new Hs(t,o);i.push(this.ht(e,c))}),R.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Qe(o.getCollectionPath())));let s=[];return i.forEach(o=>{let c=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Cs(e).j("collectionPathOverlayIndex",c))}),R.waitFor(s)}getOverlaysForCollection(e,t,r){let i=kt(),s=Qe(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Cs(e).U("collectionPathOverlayIndex",o).next(c=>{for(let u of c){let h=Dh(this.serializer,u);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=kt(),o,c=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Cs(e).J({index:"collectionGroupOverlayIndex",range:c},(u,h,f)=>{let m=Dh(this.serializer,h);s.size()<i||m.largestBatchId===o?(s.set(m.getKey(),m),o=m.largestBatchId):f.done()}).next(()=>s)}ht(e,t){return Cs(e).put((function(i,s,o){let[c,u,h]=Z_(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:h,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Xs(i.ct,o.mutation)}})(this.serializer,this.userId,t))}};function Cs(n){return De(n,"documentOverlays")}var Id=class{Pt(e){return De(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{let r=t?.value;return r?Ee.fromUint8Array(r):Ee.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var Qt=class{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(he(e.integerValue));else if("doubleValue"in e){let r=he(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),qs(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=Yt(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Rn(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?zy(e)?this.dt(t,Number.MAX_SAFE_INTEGER):kc(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):U()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){let r=e.fields||{};this.dt(t,55);for(let i of Object.keys(r))this.Vt(i,t),this.Tt(r[i],t)}wt(e,t){var r,i;let s=e.fields||{};this.dt(t,53);let o="value",c=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.dt(t,15),t.At(he(c)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){let r=e.values||[];this.dt(t,50);for(let i of r)this.Tt(i,t)}yt(e,t){this.dt(t,37),F.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}};Qt.vt=new Qt;function QS(n){if(n===0)return 8;let e=0;return n>>4==0&&(e+=4,n<<=4),n>>6==0&&(e+=2,n<<=2),n>>7==0&&(e+=1),e}function ry(n){let e=64-(function(r){let i=0;for(let s=0;s<8;++s){let o=QS(255&r[s]);if(i+=o,o!==8)break}return i})(n);return Math.ceil(e/8)}var wd=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{let i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{let i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){let t=this.qt(e),r=ry(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){let t=this.qt(e),r=ry(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){let t=(function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)})(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ft(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){let t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Ed=class{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}},Td=class{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}},ar=class{constructor(){this.jt=new wd,this.Ht=new Ed(this.jt),this.Jt=new Td(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var cr=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Zt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function vn(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=iy(n.arrayValue,e.arrayValue),t!==0?t:(t=iy(n.directionalValue,e.directionalValue),t!==0?t:F.comparator(n.documentKey,e.documentKey)))}function iy(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var Ya=class{constructor(e){this.Xt=new se((t,r)=>Ie.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(let t of e.filters){let r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(B(e.collectionGroup===this.collectionId),this.nn)return!1;let t=Gh(e);if(t!==void 0&&!this.sn(t))return!1;let r=ir(e),i=new Set,s=0,o=0;for(;s<r.length&&this.sn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Xt.size>0){let c=this.Xt.getIterator().getNext();if(!i.has(c.field.canonicalString())){let u=r[s];if(!this.on(c,u)||!this._n(this.en[o++],u))return!1}++s}for(;s<r.length;++s){let c=r[s];if(o>=this.en.length||!this._n(this.en[o++],c))return!1}return!0}an(){if(this.nn)return null;let e=new se(Ie.comparator),t=[];for(let r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new ri(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new ri(r.field,0))}for(let r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new ri(r.field,r.dir==="asc"?0:1)));return new ai(ai.UNKNOWN_ID,this.collectionId,t,Bs.empty())}sn(e){for(let t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function Pv(n){var e,t;if(B(n instanceof Y||n instanceof re),n instanceof Y){if(n instanceof qa){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>Y.create(n.field,"==",s)))||[];return re.create(i,"or")}return n}let r=n.filters.map(i=>Pv(i));return re.create(r,n.op)}function JS(n){if(n.getFilters().length===0)return[];let e=Sd(Pv(n));return B(Cv(e)),Ad(e)||bd(e)?[e]:e.getFilters()}function Ad(n){return n instanceof Y}function bd(n){return n instanceof re&&jf(n)}function Cv(n){return Ad(n)||bd(n)||(function(t){if(t instanceof re&&Xh(t)){for(let r of t.getFilters())if(!Ad(r)&&!bd(r))return!1;return!0}return!1})(n)}function Sd(n){if(B(n instanceof Y||n instanceof re),n instanceof Y)return n;if(n.filters.length===1)return Sd(n.filters[0]);let e=n.filters.map(r=>Sd(r)),t=re.create(e,n.op);return t=Xa(t),Cv(t)?t:(B(t instanceof re),B(ui(t)),B(t.filters.length>1),t.filters.reduce((r,i)=>Hf(r,i)))}function Hf(n,e){let t;return B(n instanceof Y||n instanceof re),B(e instanceof Y||e instanceof re),t=n instanceof Y?e instanceof Y?(function(i,s){return re.create([i,s],"and")})(n,e):sy(n,e):e instanceof Y?sy(e,n):(function(i,s){if(B(i.filters.length>0&&s.filters.length>0),ui(i)&&ui(s))return Hy(i,s.getFilters());let o=Xh(i)?i:s,c=Xh(i)?s:i,u=o.filters.map(h=>Hf(h,c));return re.create(u,"or")})(n,e),Xa(t)}function sy(n,e){if(ui(e))return Hy(e,n.getFilters());{let t=e.filters.map(r=>Hf(n,r));return re.create(t,"or")}}function Xa(n){if(B(n instanceof Y||n instanceof re),n instanceof Y)return n;let e=n.getFilters();if(e.length===1)return Xa(e[0]);if(Ky(n))return n;let t=e.map(i=>Xa(i)),r=[];return t.forEach(i=>{i instanceof Y?r.push(i):i instanceof re&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:re.create(r,n.op)}var Rd=class{constructor(){this.un=new Zs}addToCollectionParentIndex(e,t){return this.un.add(t),R.resolve()}getCollectionParents(e,t){return R.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return R.resolve()}deleteFieldIndex(e,t){return R.resolve()}deleteAllFieldIndexes(e){return R.resolve()}createTargetIndexes(e,t){return R.resolve()}getDocumentsMatchingTarget(e,t){return R.resolve(null)}getIndexType(e,t){return R.resolve(0)}getFieldIndexes(e,t){return R.resolve([])}getNextCollectionGroupToUpdate(e){return R.resolve(null)}getMinOffset(e,t){return R.resolve(ct.min())}getMinOffsetFromCollectionGroup(e,t){return R.resolve(ct.min())}updateCollectionGroup(e,t,r){return R.resolve()}updateIndexEntries(e,t){return R.resolve()}},Zs=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new se(Z.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new se(Z.comparator)).toArray()}};var Aa=new Uint8Array(0),Pd=class{constructor(e,t){this.databaseId=t,this.cn=new Zs,this.ln=new Mt(r=>pr(r),(r,i)=>co(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});let s={collectionId:r,parent:Qe(i)};return oy(e).put(s)}return R.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[ky(t),""],!1,!0);return oy(e).U(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(Nt(o.parent))}return r})}addFieldIndex(e,t){let r=Ns(e),i=(function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}})(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Qr(e);return s.next(c=>{o.put(ey(c,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=Ns(e),i=Qr(e),s=Hr(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Ns(e),r=Hr(e),i=Qr(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return R.forEach(this.hn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new Ya(r).an();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=Hr(e),i=!0,s=new Map;return R.forEach(this.hn(t),o=>this.Pn(e,o).next(c=>{i&&(i=!!c),s.set(o,c)})).next(()=>{if(i){let o=H(),c=[];return R.forEach(s,(u,h)=>{x("IndexedDbIndexManager",`Using index ${(function(q){return`id=${q.indexId}|cg=${q.collectionGroup}|f=${q.fields.map(Q=>`${Q.fieldPath}:${Q.kind}`).join(",")}`})(u)} to execute ${pr(t)}`);let f=(function(q,Q){let te=Gh(Q);if(te===void 0)return null;for(let K of za(q,te.fieldPath))switch(K.op){case"array-contains-any":return K.value.arrayValue.values||[];case"array-contains":return[K.value]}return null})(h,u),m=(function(q,Q){let te=new Map;for(let K of ir(Q))for(let w of za(q,K.fieldPath))switch(w.op){case"==":case"in":te.set(K.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return te.set(K.fieldPath.canonicalString(),w.value),Array.from(te.values())}return null})(h,u),_=(function(q,Q){let te=[],K=!0;for(let w of ir(Q)){let y=w.kind===0?U_(q,w.fieldPath,q.startAt):B_(q,w.fieldPath,q.startAt);te.push(y.value),K&&(K=y.inclusive)}return new Lt(te,K)})(h,u),b=(function(q,Q){let te=[],K=!0;for(let w of ir(Q)){let y=w.kind===0?B_(q,w.fieldPath,q.endAt):U_(q,w.fieldPath,q.endAt);te.push(y.value),K&&(K=y.inclusive)}return new Lt(te,K)})(h,u),k=this.In(u,h,_),O=this.In(u,h,b),D=this.Tn(u,h,m),G=this.En(u.indexId,f,k,_.inclusive,O,b.inclusive,D);return R.forEach(G,W=>r.G(W,t.limit).next(q=>{q.forEach(Q=>{let te=F.fromSegments(Q.documentKey);o.has(te)||(o=o.add(te),c.push(te))})}))}).next(()=>c)}return R.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=JS(re.create(e.filters,"and")).map(r=>ad(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,i,s,o,c){let u=(t!=null?t.length:1)*Math.max(r.length,s.length),h=u/(t!=null?t.length:1),f=[];for(let m=0;m<u;++m){let _=t?this.dn(t[m/h]):Aa,b=this.An(e,_,r[m%h],i),k=this.Rn(e,_,s[m%h],o),O=c.map(D=>this.An(e,_,D,!0));f.push(...this.createRange(b,k,O))}return f}An(e,t,r,i){let s=new cr(e,F.empty(),t,r);return i?s:s.Zt()}Rn(e,t,r,i){let s=new cr(e,F.empty(),t,r);return i?s.Zt():s}Pn(e,t){let r=new Ya(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let c of s)r.rn(c)&&(!o||c.fields.length>o.fields.length)&&(o=c);return o})}getIndexType(e,t){let r=2,i=this.hn(t);return R.forEach(i,s=>this.Pn(e,s).next(o=>{o?r!==0&&o.fields.length<(function(u){let h=new se(Ie.comparator),f=!1;for(let m of u.filters)for(let _ of m.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?f=!0:h=h.add(_.field));for(let m of u.orderBy)m.field.isKeyField()||(h=h.add(m.field));return h.size+(f?1:0)})(s)&&(r=1):r=0})).next(()=>(function(o){return o.limit!==null})(t)&&i.length>1&&r===2?1:r)}Vn(e,t){let r=new ar;for(let i of ir(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.Yt(i.kind);Qt.vt.It(s,o)}return r.zt()}dn(e){let t=new ar;return Qt.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){let r=new ar;return Qt.vt.It(dr(this.databaseId,t),r.Yt((function(s){let o=ir(s);return o.length===0?0:o[o.length-1].kind})(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let i=[];i.push(new ar);let s=0;for(let o of ir(e)){let c=r[s++];for(let u of i)if(this.fn(t,o.fieldPath)&&Ws(c))i=this.gn(i,o,c);else{let h=u.Yt(o.kind);Qt.vt.It(c,h)}}return this.pn(i)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let c of i){let u=new ar;u.seed(c.zt()),Qt.vt.It(o,u.Yt(t.kind)),s.push(u)}return s}fn(e,t){return!!e.filters.find(r=>r instanceof Y&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Ns(e),i=Qr(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{let o=[];return R.forEach(s,c=>i.get([c.indexId,this.uid]).next(u=>{o.push((function(f,m){let _=m?new Bs(m.sequenceNumber,new ct(_r(m.readTime),new F(Nt(m.documentKey)),m.largestBatchId)):Bs.empty(),b=f.fields.map(([k,O])=>new ri(Ie.fromServerFormat(k),O));return new ai(f.indexId,f.collectionGroup,b,_)})(c,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:$(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Ns(e),s=Qr(e);return this.yn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(c=>R.forEach(c,u=>s.put(ey(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return R.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?R.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(c=>(r.set(i.collectionGroup,c),R.forEach(c,u=>this.wn(e,i,u).next(h=>{let f=this.Sn(s,u);return h.isEqual(f)?R.resolve():this.bn(e,s,u,h,f)}))))})}Dn(e,t,r,i){return Hr(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,i){return Hr(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){let i=Hr(e),s=new se(vn);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,c)=>{s=s.add(new cr(r.indexId,t,c.arrayValue,c.directionalValue))}).next(()=>s)}Sn(e,t){let r=new se(vn),i=this.Vn(t,e);if(i==null)return r;let s=Gh(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Ws(o))for(let c of o.arrayValue.values||[])r=r.add(new cr(t.indexId,e.key,this.dn(c),i))}else r=r.add(new cr(t.indexId,e.key,Aa,i));return r}bn(e,t,r,i,s){x("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return(function(u,h,f,m,_){let b=u.getIterator(),k=h.getIterator(),O=$r(b),D=$r(k);for(;O||D;){let G=!1,W=!1;if(O&&D){let q=f(O,D);q<0?W=!0:q>0&&(G=!0)}else O!=null?W=!0:G=!0;G?(m(D),D=$r(k)):W?(_(O),O=$r(b)):(O=$r(b),D=$r(k))}})(i,s,vn,c=>{o.push(this.Dn(e,t,r,c))},c=>{o.push(this.vn(e,t,r,c))}),R.waitFor(o)}yn(e){let t=1;return Qr(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,c)=>vn(o,c)).filter((o,c,u)=>!c||vn(o,u[c-1])!==0);let i=[];i.push(e);for(let o of r){let c=vn(o,e),u=vn(o,t);if(c===0)i[0]=e.Zt();else if(c>0&&u<0)i.push(o),i.push(o.Zt());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Cn(i[o],i[o+1]))return[];let c=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Aa,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Aa,[]];s.push(IDBKeyRange.bound(c,u))}return s}Cn(e,t){return vn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(ay)}getMinOffset(e,t){return R.mapArray(this.hn(t),r=>this.Pn(e,r).next(i=>i||U())).next(ay)}};function oy(n){return De(n,"collectionParents")}function Hr(n){return De(n,"indexEntries")}function Ns(n){return De(n,"indexConfiguration")}function Qr(n){return De(n,"indexState")}function ay(n){B(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Ff(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new ct(e.readTime,e.documentKey,t)}var cy={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},at=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function Nv(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),c=0,u=r.J({range:o},(f,m,_)=>(c++,_.delete()));s.push(u.next(()=>{B(c===1)}));let h=[];for(let f of t.mutations){let m=My(e,f.key.path,t.batchId);s.push(i.delete(m)),h.push(f.key)}return R.waitFor(s).next(()=>h)}function Za(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw U();e=n.noDocument}return JSON.stringify(e).length}at.DEFAULT_COLLECTION_PERCENTILE=10,at.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,at.DEFAULT=new at(41943040,at.DEFAULT_COLLECTION_PERCENTILE,at.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),at.DISABLED=new at(-1,0,0);var ec=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Fn={}}static lt(e,t,r,i){B(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return In(e).J({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=ti(e),o=In(e);return o.add({}).next(c=>{B(typeof c=="number");let u=new $s(c,t,r,i),h=(function(b,k,O){let D=O.baseMutations.map(W=>Xs(b.ct,W)),G=O.mutations.map(W=>Xs(b.ct,W));return{userId:k,batchId:O.batchId,localWriteTimeMs:O.localWriteTime.toMillis(),baseMutations:D,mutations:G}})(this.serializer,this.userId,u),f=[],m=new se((_,b)=>$(_.canonicalString(),b.canonicalString()));for(let _ of i){let b=My(this.userId,_.key.path,c);m=m.add(_.key.path.popLast()),f.push(o.put(h)),f.push(s.put(b,nS))}return m.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(e,_))}),e.addOnCommittedListener(()=>{this.Fn[c]=u.keys()}),R.waitFor(f).next(()=>u)})}lookupMutationBatch(e,t){return In(e).get(t).next(r=>r?(B(r.userId===this.userId),or(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?R.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return In(e).J({index:"userMutationsIndex",range:i},(o,c,u)=>{c.userId===this.userId&&(B(c.batchId>=r),s=or(this.serializer,c)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return In(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return In(e).U("userMutationsIndex",t).next(r=>r.map(i=>or(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Pa(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return ti(e).J({range:i},(o,c,u)=>{let[h,f,m]=o,_=Nt(f);if(h===this.userId&&t.path.isEqual(_))return In(e).get(m).next(b=>{if(!b)throw U();B(b.userId===this.userId),s.push(or(this.serializer,b))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new se($),i=[];return t.forEach(s=>{let o=Pa(this.userId,s.path),c=IDBKeyRange.lowerBound(o),u=ti(e).J({range:c},(h,f,m)=>{let[_,b,k]=h,O=Nt(b);_===this.userId&&s.path.isEqual(O)?r=r.add(k):m.done()});i.push(u)}),R.waitFor(i).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Pa(this.userId,r),o=IDBKeyRange.lowerBound(s),c=new se($);return ti(e).J({range:o},(u,h,f)=>{let[m,_,b]=u,k=Nt(_);m===this.userId&&r.isPrefixOf(k)?k.length===i&&(c=c.add(b)):f.done()}).next(()=>this.xn(e,c))}xn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(In(e).get(s).next(o=>{if(o===null)throw U();B(o.userId===this.userId),r.push(or(this.serializer,o))}))}),R.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return Nv(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),R.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return R.resolve();let r=IDBKeyRange.lowerBound((function(o){return[o]})(this.userId)),i=[];return ti(e).J({range:r},(s,o,c)=>{if(s[0]===this.userId){let u=Nt(s[1]);i.push(u)}else c.done()}).next(()=>{B(i.length===0)})})}containsKey(e,t){return kv(e,this.userId,t)}Nn(e){return Dv(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function kv(n,e,t){let r=Pa(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return ti(n).J({range:s,H:!0},(c,u,h)=>{let[f,m,_]=c;f===e&&m===i&&(o=!0),h.done()}).next(()=>o)}function In(n){return De(n,"mutations")}function ti(n){return De(n,"documentMutations")}function Dv(n){return De(n,"mutationQueues")}var pi=class n{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new n(0)}static kn(){return new n(-1)}};var Cd=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{let r=new pi(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>j.fromTimestamp(new fe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Jr(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(B(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Jr(e).J((o,c)=>{let u=Os(c);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>R.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Jr(e).J((r,i)=>{let s=Os(i);t(s)})}qn(e){return uy(e).get("targetGlobalKey").next(t=>(B(t!==null),t))}Qn(e,t){return uy(e).put("targetGlobalKey",t)}Kn(e,t){return Jr(e).put(Rv(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){let r=pr(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Jr(e).J({range:i,index:"queryTargetsIndex"},(o,c,u)=>{let h=Os(c);co(t,h.target)&&(s=h,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=wn(e);return t.forEach(o=>{let c=Qe(o.path);i.push(s.put({targetId:r,path:c})),i.push(this.referenceDelegate.addReference(e,r,o))}),R.waitFor(i)}removeMatchingKeys(e,t,r){let i=wn(e);return R.forEach(t,s=>{let o=Qe(s.path);return R.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=wn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=wn(e),s=H();return i.J({range:r,H:!0},(o,c,u)=>{let h=Nt(o[1]),f=new F(h);s=s.add(f)}).next(()=>s)}containsKey(e,t){let r=Qe(t.path),i=IDBKeyRange.bound([r],[ky(r)],!1,!0),s=0;return wn(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,c],u,h)=>{o!==0&&(s++,h.done())}).next(()=>s>0)}ot(e,t){return Jr(e).get(t).next(r=>r?Os(r):null)}};function Jr(n){return De(n,"targets")}function uy(n){return De(n,"targetGlobal")}function wn(n){return De(n,"targetDocuments")}function ly([n,e],[t,r]){let i=$(n,t);return i===0?$(e,r):i}var Nd=class{constructor(e){this.Un=e,this.buffer=new se(ly),this.Wn=0}Gn(){return++this.Wn}zn(e){let t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();ly(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},kd=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){x("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>p(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ln(t)?x("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield Vn(t)}yield this.Hn(3e5)}))}},Dd=class{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return R.resolve(nt.oe);let r=new Nd(t);return this.Jn.forEachTarget(e,i=>r.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>r.zn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(x("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(cy)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),cy):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,i,s,o,c,u,h,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(x("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,o=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(r=m,c=Date.now(),this.removeTargets(e,r,t))).next(m=>(s=m,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(m=>(h=Date.now(),Yr()<=J.DEBUG&&x("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(c-o)+`ms
	Removed ${s} targets in `+(u-c)+`ms
	Removed ${m} documents in `+(h-u)+`ms
Total Duration: ${h-f}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})))}};function YS(n,e){return new Dd(n,e)}var xd=class{constructor(e,t){this.db=e,this.garbageCollector=YS(this,t)}Yn(e){let t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,i)=>t(i))}addReference(e,t,r){return ba(e,r)}removeReference(e,t,r){return ba(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return ba(e,t)}nr(e,t){return(function(i,s){let o=!1;return Dv(i).Y(c=>kv(i,c,s).next(u=>(u&&(o=!0),R.resolve(!u)))).next(()=>o)})(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.tr(e,(o,c)=>{if(c<=t){let u=this.nr(e,o).next(h=>{if(!h)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,j.min()),wn(e).delete((function(m){return[0,Qe(m.path)]})(o))))});i.push(u)}}).next(()=>R.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return ba(e,t)}tr(e,t){let r=wn(e),i,s=nt.oe;return r.J({index:"documentTargetsIndex"},([o,c],{path:u,sequenceNumber:h})=>{o===0?(s!==nt.oe&&t(new F(Nt(i)),s),s=h,i=u):s=nt.oe}).next(()=>{s!==nt.oe&&t(new F(Nt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function ba(n,e){return wn(n).put((function(r,i){return{targetId:0,path:Qe(r.path),sequenceNumber:i}})(e,n.currentSequenceNumber))}var tc=class{constructor(){this.changes=new Mt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ne.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?R.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Od=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return rr(e).put(r)}removeEntry(e,t,r){return rr(e).delete((function(s,o){let c=s.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],Qa(o),c[c.length-1]]})(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Ne.newInvalidDocument(t);return rr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ks(t))},(i,s)=>{r=this.ir(t,s)}).next(()=>r)}sr(e,t){let r={size:0,document:Ne.newInvalidDocument(t)};return rr(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ks(t))},(i,s)=>{r={document:this.ir(t,s),size:Za(s)}}).next(()=>r)}getEntries(e,t){let r=Ze();return this._r(e,t,(i,s)=>{let o=this.ir(i,s);r=r.insert(i,o)}).next(()=>r)}ar(e,t){let r=Ze(),i=new le(F.comparator);return this._r(e,t,(s,o)=>{let c=this.ir(s,o);r=r.insert(s,c),i=i.insert(s,Za(o))}).next(()=>({documents:r,ur:i}))}_r(e,t,r){if(t.isEmpty())return R.resolve();let i=new se(fy);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(ks(i.first()),ks(i.last())),o=i.getIterator(),c=o.getNext();return rr(e).J({index:"documentKeyIndex",range:s},(u,h,f)=>{let m=F.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;c&&fy(c,m)<0;)r(c,null),c=o.getNext();c&&c.isEqual(m)&&(r(c,h),c=o.hasNext()?o.getNext():null),c?f.$(ks(c)):f.done()}).next(()=>{for(;c;)r(c,null),c=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,c=[o.popLast().toArray(),o.lastSegment(),Qa(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return rr(e).U(IDBKeyRange.bound(c,u,!0)).next(h=>{s?.incrementDocumentReadCount(h.length);let f=Ze();for(let m of h){let _=this.ir(F.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);_.isFoundDocument()&&(lo(t,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(e,t,r,i){let s=Ze(),o=dy(t,r),c=dy(t,ct.max());return rr(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,c,!0)},(u,h,f)=>{let m=this.ir(F.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(m.key,m),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new Vd(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return hy(e).get("remoteDocumentGlobalKey").next(t=>(B(!!t),t))}rr(e,t){return hy(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){let r=HS(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(j.min())))return r}return Ne.newInvalidDocument(e)}};function xv(n){return new Od(n)}var Vd=class extends tc{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Mt(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new se((s,o)=>$(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let c=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,c.readTime)),o.isValidDocument()){let u=X_(this.cr.serializer,o);i=i.add(s.path.popLast());let h=Za(u);r+=h-c.size,t.push(this.cr.addEntry(e,s,u))}else if(r-=c.size,this.trackRemovals){let u=X_(this.cr.serializer,o.convertToNoDocument(j.min()));t.push(this.cr.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,r)),R.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:i})=>(i.forEach((s,o)=>{this.lr.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function hy(n){return De(n,"remoteDocumentGlobal")}function rr(n){return De(n,"remoteDocumentsV14")}function ks(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function dy(n,e){let t=e.documentKey.path.toArray();return[n,Qa(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function fy(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=$(t[s],r[s]),i)return i;return i=$(t.length,r.length),i||(i=$(t[t.length-2],r[r.length-2]),i||$(t[t.length-1],r[r.length-1]))}var Ld=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var nc=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Ms(r.mutation,i,rt.empty(),fe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,H()).next(()=>r))}getLocalViewOfDocuments(e,t,r=H()){let i=kt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=xs();return s.forEach((c,u)=>{o=o.insert(c,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=kt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,H()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,c)=>{t.set(o,c)})})}computeViews(e,t,r,i){let s=Ze(),o=Ls(),c=(function(){return Ls()})();return t.forEach((u,h)=>{let f=r.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof yt)?s=s.insert(h.key,h):f!==void 0?(o.set(h.key,f.mutation.getFieldMask()),Ms(f.mutation,h,f.mutation.getFieldMask(),fe.now())):o.set(h.key,rt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((h,f)=>o.set(h,f)),t.forEach((h,f)=>{var m;return c.set(h,new Ld(f,(m=o.get(h))!==null&&m!==void 0?m:null))}),c))}recalculateAndSaveOverlays(e,t){let r=Ls(),i=new le((o,c)=>o-c),s=H();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let c of o)c.keys().forEach(u=>{let h=t.get(u);if(h===null)return;let f=r.get(u)||rt.empty();f=c.applyToLocalView(h,f),r.set(u,f);let m=(i.get(c.batchId)||H()).add(u);i=i.insert(c.batchId,m)})}).next(()=>{let o=[],c=i.getReverseIterator();for(;c.hasNext();){let u=c.getNext(),h=u.key,f=u.value,m=rv();f.forEach(_=>{if(!s.has(_)){let b=lv(t.get(_),r.get(_));b!==null&&m.set(_,b),s=s.add(_)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,m))}return R.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return(function(o){return F.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):zf(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):R.resolve(kt()),c=-1,u=s;return o.next(h=>R.forEach(h,(f,m)=>(c<m.largestBatchId&&(c=m.largestBatchId),s.get(f)?R.resolve():this.remoteDocumentCache.getEntry(e,f).next(_=>{u=u.insert(f,_)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,u,h,H())).next(f=>({batchId:c,changes:nv(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new F(t)).next(r=>{let i=xs();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=xs();return this.indexManager.getCollectionParents(e,s).next(c=>R.forEach(c,u=>{let h=(function(m,_){return new _t(_,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,r,i).next(f=>{f.forEach((m,_)=>{o=o.insert(m,_)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,h)=>{let f=h.getKey();o.get(f)===null&&(o=o.insert(f,Ne.newInvalidDocument(f)))});let c=xs();return o.forEach((u,h)=>{let f=s.get(u);f!==void 0&&Ms(f.mutation,h,rt.empty(),fe.now()),lo(t,h)&&(c=c.insert(u,h))}),c})}};var Md=class{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return R.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:we(i.createTime)}})(t)),R.resolve()}getNamedQuery(e,t){return R.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,(function(i){return{name:i.name,query:$f(i.bundledQuery),readTime:we(i.readTime)}})(t)),R.resolve()}};var Fd=class{constructor(){this.overlays=new le(F.comparator),this.Ir=new Map}getOverlay(e,t){return R.resolve(this.overlays.get(t))}getOverlays(e,t){let r=kt();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),R.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Ir.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(r)),R.resolve()}getOverlaysForCollection(e,t,r){let i=kt(),s=t.length+1,o=new F(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){let u=c.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return R.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new le((h,f)=>h-f),o=this.overlays.getIterator();for(;o.hasNext();){let h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>r){let f=s.get(h.largestBatchId);f===null&&(f=kt(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let c=kt(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((h,f)=>c.set(h,f)),!(c.size()>=i)););return R.resolve(c)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Hs(t,r));let s=this.Ir.get(t);s===void 0&&(s=H(),this.Ir.set(t,s)),this.Ir.set(t,s.add(r.key))}};var Ud=class{constructor(){this.sessionToken=Ee.EMPTY_BYTE_STRING}getSessionToken(e){return R.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,R.resolve()}};var eo=class{constructor(){this.Tr=new se(Pe.Er),this.dr=new se(Pe.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){let r=new Pe(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Pe(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){let t=new F(new Z([])),r=new Pe(t,e),i=new Pe(t,e+1),s=[];return this.dr.forEachInRange([r,i],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){let t=new F(new Z([])),r=new Pe(t,e),i=new Pe(t,e+1),s=H();return this.dr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Pe(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Pe=class{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return F.comparator(e.key,t.key)||$(e.wr,t.wr)}static Ar(e,t){return $(e.wr,t.wr)||F.comparator(e.key,t.key)}};var Bd=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new se(Pe.Er)}checkEmpty(e){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new $s(s,t,r,i);this.mutationQueue.push(o);for(let c of i)this.br=this.br.add(new Pe(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return R.resolve(o)}lookupMutationBatch(e,t){return R.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.vr(r),s=i<0?0:i;return R.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Pe(t,0),i=new Pe(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([r,i],o=>{let c=this.Dr(o.wr);s.push(c)}),R.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new se($);return t.forEach(i=>{let s=new Pe(i,0),o=new Pe(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],c=>{r=r.add(c.wr)})}),R.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;F.isDocumentKey(s)||(s=s.child(""));let o=new Pe(new F(s),0),c=new se($);return this.br.forEachWhile(u=>{let h=u.key.path;return!!r.isPrefixOf(h)&&(h.length===i&&(c=c.add(u.wr)),!0)},o),R.resolve(this.Cr(c))}Cr(e){let t=[];return e.forEach(r=>{let i=this.Dr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){B(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return R.forEach(t.mutations,i=>{let s=new Pe(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){let r=new Pe(t,0),i=this.br.firstAfterOrEqual(r);return R.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,R.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){let t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var qd=class{constructor(e){this.Mr=e,this.docs=(function(){return new le(F.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return R.resolve(r?r.document.mutableCopy():Ne.newInvalidDocument(t))}getEntries(e,t){let r=Ze();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ne.newInvalidDocument(i))}),R.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Ze(),o=t.path,c=new F(o.child("")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){let{key:h,value:{document:f}}=u.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Ff(xy(f),r)<=0||(i.has(f.key)||lo(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return R.resolve(s)}getAllFromCollectionGroup(e,t,r,i){U()}Or(e,t){return R.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new jd(this)}getSize(e){return R.resolve(this.size)}},jd=class extends tc{constructor(e){super(),this.cr=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(r)}),R.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}};var zd=class{constructor(e){this.persistence=e,this.Nr=new Mt(t=>pr(t),co),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.Lr=0,this.Br=new eo,this.targetCount=0,this.kr=pi.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,i)=>t(i)),R.resolve()}getLastRemoteSnapshotVersion(e){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return R.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),R.resolve()}Kn(e){this.Nr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.kr=new pi(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,R.resolve()}updateTargetData(e,t){return this.Kn(t),R.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,R.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Nr.forEach((o,c)=>{c.sequenceNumber<=t&&r.get(c.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),R.waitFor(s).next(()=>i)}getTargetCount(e){return R.resolve(this.targetCount)}getTargetData(e,t){let r=this.Nr.get(t)||null;return R.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),R.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),R.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),R.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Br.yr(t);return R.resolve(r)}containsKey(e,t){return R.resolve(this.Br.containsKey(t))}};var rc=class{constructor(e,t){this.qr={},this.overlays={},this.Qr=new nt(0),this.Kr=!1,this.Kr=!0,this.$r=new Ud,this.referenceDelegate=e(this),this.Ur=new zd(this),this.indexManager=new Rd,this.remoteDocumentCache=(function(i){return new qd(i)})(r=>this.referenceDelegate.Wr(r)),this.serializer=new Ha(t),this.Gr=new Md(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Fd,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new Bd(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){x("MemoryPersistence","Starting transaction:",e);let i=new Gd(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return R.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}},Gd=class extends La{constructor(e){super(),this.currentSequenceNumber=e}},ic=class n{constructor(e){this.persistence=e,this.Jr=new eo,this.Yr=null}static Zr(e){return new n(e)}get Xr(){if(this.Yr)return this.Yr;throw U()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),R.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),R.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),R.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.Xr,r=>{let i=F.fromPath(r);return this.ei(e,i).next(s=>{s||t.removeEntry(i,j.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return R.or([()=>R.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}};var Wd=class{constructor(e){this.serializer=e}O(e,t,r,i){let s=new Ma("createOrUpgrade",t);r<1&&i>=1&&((function(u){u.createObjectStore("owner")})(e),(function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",C_,{unique:!0}),u.createObjectStore("documentMutations")})(e),py(e),(function(u){u.createObjectStore("remoteDocuments")})(e));let o=R.resolve();return r<3&&i>=3&&(r!==0&&((function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")})(e),py(e)),o=o.next(()=>(function(u){let h=u.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:j.min().toTimestamp(),targetCount:0};return h.put("targetGlobalKey",f)})(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>(function(u,h){return h.store("mutations").U().next(f=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",C_,{unique:!0});let m=h.store("mutations"),_=f.map(b=>m.put(b));return R.waitFor(_)})})(e,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.ni(s))),r<6&&i>=6&&(o=o.next(()=>((function(u){u.createObjectStore("remoteDocumentGlobal")})(e),this.ri(s)))),r<7&&i>=7&&(o=o.next(()=>this.ii(s))),r<8&&i>=8&&(o=o.next(()=>this.si(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.oi(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),(function(u){u.createObjectStore("namedQueries",{keyPath:"name"})})(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let h=u.createObjectStore("documentOverlays",{keyPath:pS});h.createIndex("collectionPathOverlayIndex",mS,{unique:!1}),h.createIndex("collectionGroupOverlayIndex",gS,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>(function(u){let h=u.createObjectStore("remoteDocumentsV14",{keyPath:rS});h.createIndex("documentKeyIndex",iS),h.createIndex("collectionGroupIndex",sS)})(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ai(e,s))),r<15&&i>=15&&(o=o.next(()=>(function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:lS}).createIndex("sequenceNumberIndex",hS,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:dS}).createIndex("documentKeyIndex",fS,{unique:!1})})(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&i>=17&&(o=o.next(()=>{(function(u){u.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=Za(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>R.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(c=>R.forEach(c,u=>{B(u.userId===s.userId);let h=or(this.serializer,u);return Nv(e,s.userId,h).next(()=>{})}))}))}ii(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.J((o,c)=>{let u=new Z(o),h=(function(m){return[0,Qe(m)]})(u);s.push(t.get(h).next(f=>f?R.resolve():(m=>t.put({targetId:0,path:Qe(m),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>R.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:uS});let r=t.store("collectionParents"),i=new Zs,s=o=>{if(i.add(o)){let c=o.lastSegment(),u=o.popLast();return r.put({collectionId:c,parent:Qe(u)})}};return t.store("remoteDocuments").J({H:!0},(o,c)=>{let u=new Z(o);return s(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,c,u],h)=>{let f=Nt(c);return s(f.popLast())}))}oi(e){let t=e.store("targets");return t.J((r,i)=>{let s=Os(i),o=Rv(this.serializer,s);return t.put(o)})}_i(e,t){let r=t.store("remoteDocuments"),i=[];return r.J((s,o)=>{let c=t.store("remoteDocumentsV14"),u=(function(m){return m.document?new F(Z.fromString(m.document.name).popFirst(5)):m.noDocument?F.fromSegments(m.noDocument.path):m.unknownDocument?F.fromSegments(m.unknownDocument.path):U()})(o).path.toArray(),h={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(c.put(h))}).next(()=>R.waitFor(i))}ai(e,t){let r=t.store("mutations"),i=xv(this.serializer),s=new rc(ic.Zr,this.serializer.ct);return r.U().next(o=>{let c=new Map;return o.forEach(u=>{var h;let f=(h=c.get(u.userId))!==null&&h!==void 0?h:H();or(this.serializer,u).keys().forEach(m=>f=f.add(m)),c.set(u.userId,f)}),R.forEach(c,(u,h)=>{let f=new Ce(h),m=Ja.lt(this.serializer,f),_=s.getIndexManager(f),b=ec.lt(f,this.serializer,_,s.referenceDelegate);return new nc(i,b,m,_).recalculateAndSaveOverlaysForDocumentKeys(new js(t,nt.oe),u).next()})})}};function py(n){n.createObjectStore("targetDocuments",{keyPath:aS}).createIndex("documentTargetsIndex",cS,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",oS,{unique:!0}),n.createObjectStore("targetGlobal")}var xh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Kd=class n{constructor(e,t,r,i,s,o,c,u,h,f,m=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=s,this.window=o,this.document=c,this.ci=h,this.li=f,this.hi=m,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=_=>Promise.resolve(),!n.D())throw new N(C.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new xd(this,i),this.Ai=t+"main",this.serializer=new Ha(u),this.Ri=new Sn(this.Ai,this.hi,new Wd(this.serializer)),this.$r=new Id,this.Ur=new Cd(this.referenceDelegate,this.serializer),this.remoteDocumentCache=xv(this.serializer),this.Gr=new vd,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,f===!1&&ve("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new N(C.FAILED_PRECONDITION,xh);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new nt(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=t=>p(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(t=>p(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(()=>p(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Sa(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Ln(e))return x("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return x("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Ds(e).get("owner").next(t=>R.resolve(this.vi(t)))}Ci(e){return Sa(e).delete(this.clientId)}Fi(){return p(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=De(t,"clientMetadata");return r.U().next(i=>{let s=this.xi(i,18e5),o=i.filter(c=>s.indexOf(c)===-1);return R.forEach(o,c=>r.delete(c.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(let t of e)this.Vi.removeItem(this.Oi(t.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?R.resolve(!0):Ds(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new N(C.FAILED_PRECONDITION,xh);return!1}}return!(!this.networkEnabled||!this.inForeground)||Sa(e).U().next(r=>this.xi(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,c=this.networkEnabled===i.networkEnabled;if(s||o&&c)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&x("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return p(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new js(e,nt.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()})}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Sa(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return ec.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Pd(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Ja.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){x("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=(function(u){return u===17?vS:u===16?yS:u===15?Bf:u===14?By:u===13?Uy:u===12?_S:u===11?Fy:void U()})(this.hi),o;return this.Ri.runTransaction(e,i,s,c=>(o=new js(c,this.Qr?this.Qr.next():nt.oe),t==="readwrite-primary"?this.wi(o).next(u=>!!u||this.Si(o)).next(u=>{if(!u)throw ve(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new N(C.FAILED_PRECONDITION,Oy);return r(o)}).next(u=>this.Di(o).next(()=>u)):this.Ki(o).next(()=>r(o)))).then(c=>(o.raiseOnCommittedEvent(),c))}Ki(e){return Ds(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new N(C.FAILED_PRECONDITION,xh)})}Di(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ds(e).put("owner",t)}static D(){return Sn.D()}bi(e){let t=Ds(e);return t.get("owner").next(r=>this.vi(r)?(x("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):R.resolve())}Mi(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(ve(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let t=/(?:Version|Mobile)\/1[456]/;bu()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{let r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return x("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return ve("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){ve("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Ds(n){return De(n,"owner")}function Sa(n){return De(n,"clientMetadata")}function Qf(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var $d=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=i}static Wi(e,t){let r=H(),i=H();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var Hd=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var sc=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(function(){return bu()?8:Vy(oe())>0?6:4})()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Hd;return this.Xi(e,t,o).next(c=>{if(s.result=c,this.zi)return this.es(e,t,o,c.size)})}).next(()=>s.result)}es(e,t,r,i){return r.documentReadCount<this.ji?(Yr()<=J.DEBUG&&x("QueryEngine","SDK will not create cache indexes for query:",Xr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),R.resolve()):(Yr()<=J.DEBUG&&x("QueryEngine","Query:",Xr(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(Yr()<=J.DEBUG&&x("QueryEngine","The SDK decides to create cache indexes for query:",Xr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Je(t))):R.resolve())}Yi(e,t){if(q_(t))return R.resolve(null);let r=Je(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Ga(t,null,"F"),r=Je(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=H(...s);return this.Ji.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,r).next(u=>{let h=this.ts(t,c);return this.ns(t,h,o,u.readTime)?this.Yi(e,Ga(t,null,"F")):this.rs(e,h,t,u)}))})))}Zi(e,t,r,i){return q_(t)||i.isEqual(j.min())?R.resolve(null):this.Ji.getDocuments(e,r).next(s=>{let o=this.ts(t,s);return this.ns(t,o,r,i)?R.resolve(null):(Yr()<=J.DEBUG&&x("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Xr(t)),this.rs(e,o,t,Dy(i,-1)).next(c=>c))})}ts(e,t){let r=new se(ev(e));return t.forEach((i,s)=>{lo(e,s)&&(r=r.add(s))}),r}ns(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,r){return Yr()<=J.DEBUG&&x("QueryEngine","Using full collection scan to execute query:",Xr(t)),this.Ji.getDocumentsMatchingQuery(e,t,ct.min(),r)}rs(e,t,r,i){return this.Ji.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Qd=class{constructor(e,t,r,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new le($),this._s=new Mt(s=>pr(s),co),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new nc(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}};function Ov(n,e,t,r){return new Qd(n,e,t,r)}function Vv(n,e){return p(this,null,function*(){let t=M(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],c=[],u=H();for(let h of i){o.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}for(let h of s){c.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(r,u).next(h=>({hs:h,removedBatchIds:o,addedBatchIds:c}))})})})}function XS(n,e){let t=M(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return(function(c,u,h,f){let m=h.batch,_=m.keys(),b=R.resolve();return _.forEach(k=>{b=b.next(()=>f.getEntry(u,k)).next(O=>{let D=h.docVersions.get(k);B(D!==null),O.version.compareTo(D)<0&&(m.applyToRemoteDocument(O,h),O.isValidDocument()&&(O.setReadTime(h.commitVersion),f.addEntry(O)))})}),b.next(()=>c.mutationQueue.removeMutationBatch(u,m))})(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(c){let u=H();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(u=u.add(c.batch.mutations[h].key));return u})(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Lv(n){let e=M(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function ZS(n,e){let t=M(n),r=e.snapshotVersion,i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;let c=[];e.targetChanges.forEach((f,m)=>{let _=i.get(m);if(!_)return;c.push(t.Ur.removeMatchingKeys(s,f.removedDocuments,m).next(()=>t.Ur.addMatchingKeys(s,f.addedDocuments,m)));let b=_.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?b=b.withResumeToken(Ee.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):f.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(f.resumeToken,r)),i=i.insert(m,b),(function(O,D,G){return O.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-O.snapshotVersion.toMicroseconds()>=3e8?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0})(_,b,f)&&c.push(t.Ur.updateTargetData(s,b))});let u=Ze(),h=H();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),c.push(Mv(s,o,e.documentUpdates).next(f=>{u=f.Ps,h=f.Is})),!r.isEqual(j.min())){let f=t.Ur.getLastRemoteSnapshotVersion(s).next(m=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,r));c.push(f)}return R.waitFor(c).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,h)).next(()=>u)}).then(s=>(t.os=i,s))}function Mv(n,e,t){let r=H(),i=H();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Ze();return t.forEach((c,u)=>{let h=s.get(c);u.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(c)),u.isNoDocument()&&u.version.isEqual(j.min())?(e.removeEntry(c,u.readTime),o=o.insert(c,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),o=o.insert(c,u)):x("LocalStore","Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",u.version)}),{Ps:o,Is:i}})}function e0(n,e){let t=M(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function mi(n,e){let t=M(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Ur.getTargetData(r,e).next(s=>s?(i=s,R.resolve(i)):t.Ur.allocateTargetId(r).next(o=>(i=new fi(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}function gi(n,e,t){return p(this,null,function*(){let r=M(n),i=r.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Ln(o))throw o;x("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(i.target)})}function oc(n,e,t){let r=M(n),i=j.min(),s=H();return r.persistence.runTransaction("Execute query","readwrite",o=>(function(u,h,f){let m=M(u),_=m._s.get(f);return _!==void 0?R.resolve(m.os.get(_)):m.Ur.getTargetData(h,f)})(r,o,Je(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,c.targetId).next(u=>{s=u})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?i:j.min(),t?s:H())).next(c=>(Bv(r,Zy(e),c),{documents:c,Ts:s})))}function Fv(n,e){let t=M(n),r=M(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(o=>o?o.target:null))}function Uv(n,e){let t=M(n),r=t.us.get(e)||j.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,Dy(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Bv(t,e,i),i))}function Bv(n,e,t){let r=n.us.get(e)||j.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.us.set(e,r)}function t0(n,e,t,r){return p(this,null,function*(){let i=M(n),s=H(),o=Ze();for(let h of t){let f=e.Es(h.metadata.name);h.document&&(s=s.add(f));let m=e.ds(h);m.setReadTime(e.As(h.metadata.readTime)),o=o.insert(f,m)}let c=i.cs.newChangeBuffer({trackRemovals:!0}),u=yield mi(i,(function(f){return Je(Ai(Z.fromString(`__bundle__/docs/${f}`)))})(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",h=>Mv(h,c,o).next(f=>(c.apply(h),f)).next(f=>i.Ur.removeMatchingKeysForTargetId(h,u.targetId).next(()=>i.Ur.addMatchingKeys(h,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(h,f.Ps,f.Is)).next(()=>f.Ps)))})}function n0(r,i){return p(this,arguments,function*(n,e,t=H()){let s=yield mi(n,Je($f(e.bundledQuery))),o=M(n);return o.persistence.runTransaction("Save named query","readwrite",c=>{let u=we(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.Gr.saveNamedQuery(c,e);let h=s.withResumeToken(Ee.EMPTY_BYTE_STRING,u);return o.os=o.os.insert(h.targetId,h),o.Ur.updateTargetData(c,h).next(()=>o.Ur.removeMatchingKeysForTargetId(c,s.targetId)).next(()=>o.Ur.addMatchingKeys(c,t,s.targetId)).next(()=>o.Gr.saveNamedQuery(c,e))})})}function my(n,e){return`firestore_clients_${n}_${e}`}function gy(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Oh(n,e){return`firestore_targets_${n}_${e}`}var ac=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Rs(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new N(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(ve("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Fs=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new N(r.error.code,r.error.message))),s?new n(e,r.state,i):(ve("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},cc=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Gf();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=Ly(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(ve("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},Jd=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(ve("SharedClientState",`Failed to parse online state: ${e}`),null)}},to=class{constructor(){this.activeTargetIds=Gf()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Us=class{constructor(e,t,r,i,s){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new le($),this.started=!1,this.bs=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=my(this.persistenceKey,this.ps),this.vs=(function(u){return`firestore_sequence_number_${u}`})(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new to),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=(function(u){return`firestore_online_state_${u}`})(this.persistenceKey),this.Os=(function(u){return`firestore_bundle_loaded_v2_${u}`})(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){return p(this,null,function*(){let e=yield this.syncEngine.Qi();for(let r of e){if(r===this.ps)continue;let i=this.getItem(my(this.persistenceKey,r));if(i){let s=cc.Rs(r,i);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let t=this.storage.getItem(this.xs);if(t){let r=this.Ls(t);r&&this.Bs(r)}for(let r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(Oh(this.persistenceKey,e));if(i){let s=Fs.Rs(e,i);s&&(r=s.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Oh(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return x("SharedClientState","READ",e,t),t}setItem(e,t){x("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){x("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){let t=e;if(t.storageArea===this.storage){if(x("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void ve("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>p(this,null,function*(){if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){let r=this.Gs(t.key);return this.zs(r,null)}{let r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){let r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){let r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){let r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){let r=(function(s){let o=nt.oe;if(s!=null)try{let c=JSON.parse(s);B(typeof c=="number"),o=c}catch(c){ve("SharedClientState","Failed to read sequence number from WebStorage",c)}return o})(t.newValue);r!==nt.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){let r=this.Xs(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.eo(i)))}}}else this.bs.push(t)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){let i=new ac(this.currentUser,e,t,r),s=gy(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){let t=gy(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){let t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){let i=Oh(this.persistenceKey,e),s=new Fs(e,t,r);this.setItem(i,s.Vs())}Ws(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){let t=this.Cs.exec(e);return t?t[1]:null}js(e,t){let r=this.Gs(e);return cc.Rs(r,t)}Hs(e,t){let r=this.Fs.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return ac.Rs(new Ce(s),i,t)}Ys(e,t){let r=this.Ms.exec(e),i=Number(r[1]);return Fs.Rs(i,t)}Ls(e){return Jd.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){return p(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);x("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){let r=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(r),o=[],c=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||c.push(u)}),this.syncEngine.io(o,c).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Gf();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},uc=class{constructor(){this.so=new to,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new to,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Yd=class{_o(e){}shutdown(){}};var lc=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){x("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.ho)e(0)}lo(){x("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Ra=null;function Vh(){return Ra===null?Ra=(function(){return 268435456+Math.round(2147483648*Math.random())})():Ra++,"0x"+Ra.toString(16)}var r0={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Xd=class{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}};var Ge="WebChannelConnection",Zd=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,r,i,s,o){let c=Vh(),u=this.xo(t,r.toUriEncodedString());x("RestConnection",`Sending RPC '${t}' ${c}:`,u,i);let h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,s,o),this.No(t,u,h,i).then(f=>(x("RestConnection",`Received RPC '${t}' ${c}: `,f),f),f=>{throw gt("RestConnection",`RPC '${t}' ${c} failed with error: `,f,"url: ",u,"request:",i),f})}Lo(t,r,i,s,o,c){return this.Mo(t,r,i,s,o)}Oo(t,r,i){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Ti})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}xo(t,r){let i=r0[t];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,i){let s=Vh();return new Promise((o,c)=>{let u=new Rh;u.setWithCredentials(!0),u.listenOnce(Ph.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Ps.NO_ERROR:let f=u.getResponseJson();x(Ge,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),o(f);break;case Ps.TIMEOUT:x(Ge,`RPC '${e}' ${s} timed out`),c(new N(C.DEADLINE_EXCEEDED,"Request time out"));break;case Ps.HTTP_ERROR:let m=u.getStatus();if(x(Ge,`RPC '${e}' ${s} failed with status:`,m,"response text:",u.getResponseText()),m>0){let _=u.getResponseJson();Array.isArray(_)&&(_=_[0]);let b=_?.error;if(b&&b.status&&b.message){let k=(function(D){let G=D.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(G)>=0?G:C.UNKNOWN})(b.status);c(new N(k,b.message))}else c(new N(C.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new N(C.UNAVAILABLE,"Connection failed."));break;default:U()}}finally{x(Ge,`RPC '${e}' ${s} completed.`)}});let h=JSON.stringify(i);x(Ge,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",h,r,15)})}Bo(e,t,r){let i=Vh(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=kh(),c=Nh(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Oo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let f=s.join("");x(Ge,`Creating RPC '${e}' stream ${i}: ${f}`,u);let m=o.createWebChannel(f,u),_=!1,b=!1,k=new Xd({Io:D=>{b?x(Ge,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(_||(x(Ge,`Opening RPC '${e}' stream ${i} transport.`),m.open(),_=!0),x(Ge,`RPC '${e}' stream ${i} sending:`,D),m.send(D))},To:()=>m.close()}),O=(D,G,W)=>{D.listen(G,q=>{try{W(q)}catch(Q){setTimeout(()=>{throw Q},0)}})};return O(m,Kr.EventType.OPEN,()=>{b||(x(Ge,`RPC '${e}' stream ${i} transport opened.`),k.yo())}),O(m,Kr.EventType.CLOSE,()=>{b||(b=!0,x(Ge,`RPC '${e}' stream ${i} transport closed`),k.So())}),O(m,Kr.EventType.ERROR,D=>{b||(b=!0,gt(Ge,`RPC '${e}' stream ${i} transport errored:`,D),k.So(new N(C.UNAVAILABLE,"The operation could not be completed")))}),O(m,Kr.EventType.MESSAGE,D=>{var G;if(!b){let W=D.data[0];B(!!W);let q=W,Q=q.error||((G=q[0])===null||G===void 0?void 0:G.error);if(Q){x(Ge,`RPC '${e}' stream ${i} received error:`,Q);let te=Q.status,K=(function(I){let E=Re[I];if(E!==void 0)return fv(E)})(te),w=Q.message;K===void 0&&(K=C.INTERNAL,w="Unknown error status: "+te+" with message "+Q.message),b=!0,k.So(new N(K,w)),m.close()}else x(Ge,`RPC '${e}' stream ${i} received:`,W),k.bo(W)}}),O(c,Ch.STAT_EVENT,D=>{D.stat===Ta.PROXY?x(Ge,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===Ta.NOPROXY&&x(Ge,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{k.wo()},0),k}};function qv(){return typeof window<"u"?window:null}function Da(){return typeof document<"u"?document:null}function ho(n){return new pd(n,!0)}var no=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();let t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-r);i>0&&x("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var hc=class{constructor(e,t,r,i,s,o,c,u){this.ui=e,this.Ho=r,this.Jo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new no(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return p(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){return p(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){return p(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(ve(t.toString()),ve("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.mo(t)})}l_(){}auth(){this.state=1;let e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===t&&this.P_(r,i)},r=>{e(()=>{let i=new N(C.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(e,t){let r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>p(this,null,function*(){this.state=0,this.start()}))}I_(e){return x("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(x("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},ef=class extends hc{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();let t=qS(this.serializer,e),r=(function(s){if(!("targetChange"in s))return j.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?j.min():o.readTime?we(o.readTime):j.min()})(e);return this.listener.d_(t,r)}A_(e){let t={};t.database=_d(this.serializer),t.addTarget=(function(s,o){let c,u=o.target;if(c=ja(u)?{documents:wv(s,u)}:{query:Ev(s,u)._t},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=mv(s,o.resumeToken);let h=md(s,o.expectedCount);h!==null&&(c.expectedCount=h)}else if(o.snapshotVersion.compareTo(j.min())>0){c.readTime=di(s,o.snapshotVersion.toTimestamp());let h=md(s,o.expectedCount);h!==null&&(c.expectedCount=h)}return c})(this.serializer,e);let r=zS(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){let t={};t.database=_d(this.serializer),t.removeTarget=e,this.a_(t)}},tf=class extends hc{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return B(!!e.streamToken),this.lastStreamToken=e.streamToken,B(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){B(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();let t=jS(e.writeResults,e.commitTime),r=we(e.commitTime);return this.listener.g_(r,t)}p_(){let e={};e.database=_d(this.serializer),this.a_(e)}m_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Xs(this.serializer,r))};this.a_(t)}};var nf=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new N(C.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,gd(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new N(C.UNKNOWN,s.toString())})}Lo(e,t,r,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Lo(e,gd(t,r),i,o,c,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new N(C.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},rf=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(ve(t),this.D_=!1):x("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var sf=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{r.enqueueAndForget(()=>p(this,null,function*(){Mn(this)&&(x("RemoteStore","Restarting streams for network reachability change."),yield(function(u){return p(this,null,function*(){let h=M(u);h.L_.add(4),yield bi(h),h.q_.set("Unknown"),h.L_.delete(4),yield fo(h)})})(this))}))}),this.q_=new rf(r,i)}};function fo(n){return p(this,null,function*(){if(Mn(n))for(let e of n.B_)yield e(!0)})}function bi(n){return p(this,null,function*(){for(let e of n.B_)yield e(!1)})}function Dc(n,e){let t=M(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Xf(t)?Yf(t):Ri(t).r_()&&Jf(t,e))}function _i(n,e){let t=M(n),r=Ri(t);t.N_.delete(e),r.r_()&&jv(t,e),t.N_.size===0&&(r.r_()?r.o_():Mn(t)&&t.q_.set("Unknown"))}function Jf(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(j.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ri(n).A_(e)}function jv(n,e){n.Q_.xe(e),Ri(n).R_(e)}function Yf(n){n.Q_=new fd({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Ri(n).start(),n.q_.v_()}function Xf(n){return Mn(n)&&!Ri(n).n_()&&n.N_.size>0}function Mn(n){return M(n).L_.size===0}function zv(n){n.Q_=void 0}function i0(n){return p(this,null,function*(){n.q_.set("Online")})}function s0(n){return p(this,null,function*(){n.N_.forEach((e,t)=>{Jf(n,e)})})}function o0(n,e){return p(this,null,function*(){zv(n),Xf(n)?(n.q_.M_(e),Yf(n)):n.q_.set("Unknown")})}function a0(n,e,t){return p(this,null,function*(){if(n.q_.set("Online"),e instanceof Ka&&e.state===2&&e.cause)try{yield(function(i,s){return p(this,null,function*(){let o=s.cause;for(let c of s.targetIds)i.N_.has(c)&&(yield i.remoteSyncer.rejectListen(c,o),i.N_.delete(c),i.Q_.removeTarget(c))})})(n,e)}catch(r){x("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield dc(n,r)}else if(e instanceof si?n.Q_.Ke(e):e instanceof Wa?n.Q_.He(e):n.Q_.We(e),!t.isEqual(j.min()))try{let r=yield Lv(n.localStore);t.compareTo(r)>=0&&(yield(function(s,o){let c=s.Q_.rt(o);return c.targetChanges.forEach((u,h)=>{if(u.resumeToken.approximateByteSize()>0){let f=s.N_.get(h);f&&s.N_.set(h,f.withResumeToken(u.resumeToken,o))}}),c.targetMismatches.forEach((u,h)=>{let f=s.N_.get(u);if(!f)return;s.N_.set(u,f.withResumeToken(Ee.EMPTY_BYTE_STRING,f.snapshotVersion)),jv(s,u);let m=new fi(f.target,u,h,f.sequenceNumber);Jf(s,m)}),s.remoteSyncer.applyRemoteEvent(c)})(n,t))}catch(r){x("RemoteStore","Failed to raise snapshot:",r),yield dc(n,r)}})}function dc(n,e,t){return p(this,null,function*(){if(!Ln(e))throw e;n.L_.add(1),yield bi(n),n.q_.set("Offline"),t||(t=()=>Lv(n.localStore)),n.asyncQueue.enqueueRetryable(()=>p(null,null,function*(){x("RemoteStore","Retrying IndexedDB access"),yield t(),n.L_.delete(1),yield fo(n)}))})}function Gv(n,e){return e().catch(t=>dc(n,t,e))}function Si(n){return p(this,null,function*(){let e=M(n),t=On(e),r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;c0(e);)try{let i=yield e0(e.localStore,r);if(i===null){e.O_.length===0&&t.o_();break}r=i.batchId,u0(e,i)}catch(i){yield dc(e,i)}Wv(e)&&Kv(e)})}function c0(n){return Mn(n)&&n.O_.length<10}function u0(n,e){n.O_.push(e);let t=On(n);t.r_()&&t.V_&&t.m_(e.mutations)}function Wv(n){return Mn(n)&&!On(n).n_()&&n.O_.length>0}function Kv(n){On(n).start()}function l0(n){return p(this,null,function*(){On(n).p_()})}function h0(n){return p(this,null,function*(){let e=On(n);for(let t of n.O_)e.m_(t.mutations)})}function d0(n,e,t){return p(this,null,function*(){let r=n.O_.shift(),i=ld.from(r,e,t);yield Gv(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Si(n)})}function f0(n,e){return p(this,null,function*(){e&&On(n).V_&&(yield(function(r,i){return p(this,null,function*(){if((function(o){return dv(o)&&o!==C.ABORTED})(i.code)){let s=r.O_.shift();On(r).s_(),yield Gv(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Si(r)}})})(n,e)),Wv(n)&&Kv(n)})}function _y(n,e){return p(this,null,function*(){let t=M(n);t.asyncQueue.verifyOperationInProgress(),x("RemoteStore","RemoteStore received new credentials");let r=Mn(t);t.L_.add(3),yield bi(t),r&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield fo(t)})}function of(n,e){return p(this,null,function*(){let t=M(n);e?(t.L_.delete(2),yield fo(t)):e||(t.L_.add(2),yield bi(t),t.q_.set("Unknown"))})}function Ri(n){return n.K_||(n.K_=(function(t,r,i){let s=M(t);return s.w_(),new ef(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Eo:i0.bind(null,n),Ro:s0.bind(null,n),mo:o0.bind(null,n),d_:a0.bind(null,n)}),n.B_.push(e=>p(null,null,function*(){e?(n.K_.s_(),Xf(n)?Yf(n):n.q_.set("Unknown")):(yield n.K_.stop(),zv(n))}))),n.K_}function On(n){return n.U_||(n.U_=(function(t,r,i){let s=M(t);return s.w_(),new tf(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:l0.bind(null,n),mo:f0.bind(null,n),f_:h0.bind(null,n),g_:d0.bind(null,n)}),n.B_.push(e=>p(null,null,function*(){e?(n.U_.s_(),yield Si(n)):(yield n.U_.stop(),n.O_.length>0&&(x("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))}))),n.U_}var af=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ke,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,c=new n(e,t,o,i,s);return c.start(r),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new N(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Pi(n,e){if(ve("AsyncQueue",`${e}: ${n}`),Ln(n))return new N(C.UNAVAILABLE,`${e}: ${n}`);throw n}var fc=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||F.comparator(t.key,r.key):(t,r)=>F.comparator(t.key,r.key),this.keyedMap=xs(),this.sortedSet=new le(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var pc=class{constructor(){this.W_=new le(F.comparator)}track(e){let t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):U():this.W_=this.W_.insert(t,e)}G_(){let e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}},yi=class n{constructor(e,t,r,i,s,o,c,u,h){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(c=>{o.push({type:0,doc:c})}),new n(e,t,fc.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&uo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var cf=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}},uf=class{constructor(){this.queries=yy(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){let i=M(t),s=i.queries;i.queries=yy(),s.forEach((o,c)=>{for(let u of c.j_)u.onError(r)})})(this,new N(C.ABORTED,"Firestore shutting down"))}};function yy(){return new Mt(n=>Xy(n),uo)}function Zf(n,e){return p(this,null,function*(){let t=M(n),r=3,i=e.query,s=t.queries.get(i);s?!s.H_()&&e.J_()&&(r=2):(s=new cf,r=e.J_()?0:1);try{switch(r){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let c=Pi(o,`Initialization of query '${Xr(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&tp(t)})}function ep(n,e){return p(this,null,function*(){let t=M(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function p0(n,e){let t=M(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let c of o.j_)c.X_(i)&&(r=!0);o.z_=i}}r&&tp(t)}function m0(n,e,t){let r=M(n),i=r.queries.get(e);if(i)for(let s of i.j_)s.onError(t);r.queries.delete(e)}function tp(n){n.Y_.forEach(e=>{e.next()})}var lf,vy;(vy=lf||(lf={})).ea="default",vy.Cache="cache";var ro=class{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new yi(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;let r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;let t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=yi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==lf.Cache}};var hf=class{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}};var mc=class{constructor(e){this.serializer=e}Es(e){return xt(this.serializer,e)}ds(e){return e.metadata.exists?Iv(this.serializer,e.document,!1):Ne.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return we(e)}},df=class{constructor(e,t,r){this.ca=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=$v(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;let r=Z.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){let t=new Map,r=new mc(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Es(i.metadata.name);for(let o of i.metadata.queries){let c=(t.get(o)||H()).add(s);t.set(o,c)}}return t}complete(){return p(this,null,function*(){let e=yield t0(this.localStore,new mc(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(let r of this.queries)yield n0(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}})}};function $v(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var gc=class{constructor(e){this.key=e}},_c=class{constructor(e){this.key=e}},yc=class{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=H(),this.mutatedKeys=H(),this.Aa=ev(e),this.Ra=new fc(this.Aa)}get Va(){return this.Ta}ma(e,t){let r=t?t.fa:new pc,i=t?t.Ra:this.Ra,s=t?t.mutatedKeys:this.mutatedKeys,o=i,c=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,m)=>{let _=i.get(f),b=lo(this.query,m)?m:null,k=!!_&&this.mutatedKeys.has(_.key),O=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations),D=!1;_&&b?_.data.isEqual(b.data)?k!==O&&(r.track({type:3,doc:b}),D=!0):this.ga(_,b)||(r.track({type:2,doc:b}),D=!0,(u&&this.Aa(b,u)>0||h&&this.Aa(b,h)<0)&&(c=!0)):!_&&b?(r.track({type:0,doc:b}),D=!0):_&&!b&&(r.track({type:1,doc:_}),D=!0,(u||h)&&(c=!0)),D&&(b?(o=o.add(b),s=O?s.add(f):s.delete(f)):(o=o.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),s=s.delete(f.key),r.track({type:1,doc:f})}return{Ra:o,fa:r,ns:c,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;let o=e.fa.G_();o.sort((f,m)=>(function(b,k){let O=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return U()}};return O(b)-O(k)})(f.type,m.type)||this.Aa(f.doc,m.doc)),this.pa(r),i=i!=null&&i;let c=t&&!i?this.ya():[],u=this.da.size===0&&this.current&&!i?1:0,h=u!==this.Ea;return this.Ea=u,o.length!==0||h?{snapshot:new yi(this.query,e.Ra,s,o,e.mutatedKeys,u===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:c}:{wa:c}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new pc,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];let e=this.da;this.da=H(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});let t=[];return e.forEach(r=>{this.da.has(r)||t.push(new _c(r))}),this.da.forEach(r=>{e.has(r)||t.push(new gc(r))}),t}ba(e){this.Ta=e.Ts,this.da=H();let t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return yi.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},ff=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},pf=class{constructor(e){this.key=e,this.va=!1}},mf=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Mt(c=>Xy(c),uo),this.Ma=new Map,this.xa=new Set,this.Oa=new le(F.comparator),this.Na=new Map,this.La=new eo,this.Ba={},this.ka=new Map,this.qa=pi.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function g0(n,e,t=!0){return p(this,null,function*(){let r=xc(n),i,s=r.Fa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield Hv(r,e,t,!0),i})}function _0(n,e){return p(this,null,function*(){let t=xc(n);yield Hv(t,e,!0,!1)})}function Hv(n,e,t,r){return p(this,null,function*(){let i=yield mi(n.localStore,Je(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),c;return r&&(c=yield np(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Dc(n.remoteStore,i),c})}function np(n,e,t,r,i){return p(this,null,function*(){n.Ka=(m,_,b)=>(function(O,D,G,W){return p(this,null,function*(){let q=D.view.ma(G);q.ns&&(q=yield oc(O.localStore,D.query,!1).then(({documents:w})=>D.view.ma(w,q)));let Q=W&&W.targetChanges.get(D.targetId),te=W&&W.targetMismatches.get(D.targetId)!=null,K=D.view.applyChanges(q,O.isPrimaryClient,Q,te);return gf(O,D.targetId,K.wa),K.snapshot})})(n,m,_,b);let s=yield oc(n.localStore,e,!0),o=new yc(e,s.Ts),c=o.ma(s.documents),u=Js.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),h=o.applyChanges(c,n.isPrimaryClient,u);gf(n,t,h.wa);let f=new ff(e,t,o);return n.Fa.set(e,f),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),h.snapshot})}function y0(n,e,t){return p(this,null,function*(){let r=M(n),i=r.Fa.get(e),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter(o=>!uo(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield gi(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&_i(r.remoteStore,i.targetId),vi(r,i.targetId)}).catch(Vn))):(vi(r,i.targetId),yield gi(r.localStore,i.targetId,!0))})}function v0(n,e){return p(this,null,function*(){let t=M(n),r=t.Fa.get(e),i=t.Ma.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),_i(t.remoteStore,r.targetId))})}function I0(n,e,t){return p(this,null,function*(){let r=op(n);try{let i=yield(function(o,c){let u=M(o),h=fe.now(),f=c.reduce((b,k)=>b.add(k.key),H()),m,_;return u.persistence.runTransaction("Locally write mutations","readwrite",b=>{let k=Ze(),O=H();return u.cs.getEntries(b,f).next(D=>{k=D,k.forEach((G,W)=>{W.isValidDocument()||(O=O.add(G))})}).next(()=>u.localDocuments.getOverlayedDocuments(b,k)).next(D=>{m=D;let G=[];for(let W of c){let q=OS(W,m.get(W.key).overlayedDocument);q!=null&&G.push(new yt(W.key,q,Wy(q.value.mapValue),ye.exists(!0)))}return u.mutationQueue.addMutationBatch(b,h,G,c)}).next(D=>{_=D;let G=D.applyToLocalDocumentSet(m,O);return u.documentOverlayCache.saveOverlays(b,D.batchId,G)})}).then(()=>({batchId:_.batchId,changes:nv(m)}))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(o,c,u){let h=o.Ba[o.currentUser.toKey()];h||(h=new le($)),h=h.insert(c,u),o.Ba[o.currentUser.toKey()]=h})(r,i.batchId,t),yield nn(r,i.changes),yield Si(r.remoteStore)}catch(i){let s=Pi(i,"Failed to persist write");t.reject(s)}})}function Qv(n,e){return p(this,null,function*(){let t=M(n);try{let r=yield ZS(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Na.get(s);o&&(B(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.va=!0:i.modifiedDocuments.size>0?B(o.va):i.removedDocuments.size>0&&(B(o.va),o.va=!1))}),yield nn(t,r,e)}catch(r){yield Vn(r)}})}function Iy(n,e,t){let r=M(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Fa.forEach((s,o)=>{let c=o.view.Z_(e);c.snapshot&&i.push(c.snapshot)}),(function(o,c){let u=M(o);u.onlineState=c;let h=!1;u.queries.forEach((f,m)=>{for(let _ of m.j_)_.Z_(c)&&(h=!0)}),h&&tp(u)})(r.eventManager,e),i.length&&r.Ca.d_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function w0(n,e,t){return p(this,null,function*(){let r=M(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Na.get(e),s=i&&i.key;if(s){let o=new le(F.comparator);o=o.insert(s,Ne.newNoDocument(s,j.min()));let c=H().add(s),u=new Qs(j.min(),new Map,new le($),o,c);yield Qv(r,u),r.Oa=r.Oa.remove(s),r.Na.delete(e),sp(r)}else yield gi(r.localStore,e,!1).then(()=>vi(r,e,t)).catch(Vn)})}function E0(n,e){return p(this,null,function*(){let t=M(n),r=e.batch.batchId;try{let i=yield XS(t.localStore,e);ip(t,r,null),rp(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield nn(t,i)}catch(i){yield Vn(i)}})}function T0(n,e,t){return p(this,null,function*(){let r=M(n);try{let i=yield(function(o,c){let u=M(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return u.mutationQueue.lookupMutationBatch(h,c).next(m=>(B(m!==null),f=m.keys(),u.mutationQueue.removeMutationBatch(h,m))).next(()=>u.mutationQueue.performConsistencyCheck(h)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(h,f,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>u.localDocuments.getDocuments(h,f))})})(r.localStore,e);ip(r,e,t),rp(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield nn(r,i)}catch(i){yield Vn(i)}})}function A0(n,e){return p(this,null,function*(){let t=M(n);Mn(t.remoteStore)||x("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield(function(o){let c=M(o);return c.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>c.mutationQueue.getHighestUnacknowledgedBatchId(u))})(t.localStore);if(r===-1)return void e.resolve();let i=t.ka.get(r)||[];i.push(e),t.ka.set(r,i)}catch(r){let i=Pi(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function rp(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function ip(n,e,t){let r=M(n),i=r.Ba[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function vi(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||Jv(n,r)})}function Jv(n,e){n.xa.delete(e.path.canonicalString());let t=n.Oa.get(e);t!==null&&(_i(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),sp(n))}function gf(n,e,t){for(let r of t)r instanceof gc?(n.La.addReference(r.key,e),b0(n,r)):r instanceof _c?(x("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||Jv(n,r.key)):U()}function b0(n,e){let t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(x("SyncEngine","New document in limbo: "+t),n.xa.add(r),sp(n))}function sp(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){let e=n.xa.values().next().value;n.xa.delete(e);let t=new F(Z.fromString(e)),r=n.qa.next();n.Na.set(r,new pf(t)),n.Oa=n.Oa.insert(t,r),Dc(n.remoteStore,new fi(Je(Ai(t.path)),r,"TargetPurposeLimboResolution",nt.oe))}}function nn(n,e,t){return p(this,null,function*(){let r=M(n),i=[],s=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((c,u)=>{o.push(r.Ka(u,e,t).then(h=>{var f;if((h||t)&&r.isPrimaryClient){let m=h?!h.fromCache:(f=t?.targetChanges.get(u.targetId))===null||f===void 0?void 0:f.current;r.sharedClientState.updateQueryState(u.targetId,m?"current":"not-current")}if(h){i.push(h);let m=$d.Wi(u.targetId,h);s.push(m)}}))}),yield Promise.all(o),r.Ca.d_(i),yield(function(u,h){return p(this,null,function*(){let f=M(u);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>R.forEach(h,_=>R.forEach(_.$i,b=>f.persistence.referenceDelegate.addReference(m,_.targetId,b)).next(()=>R.forEach(_.Ui,b=>f.persistence.referenceDelegate.removeReference(m,_.targetId,b)))))}catch(m){if(!Ln(m))throw m;x("LocalStore","Failed to update sequence numbers: "+m)}for(let m of h){let _=m.targetId;if(!m.fromCache){let b=f.os.get(_),k=b.snapshotVersion,O=b.withLastLimboFreeSnapshotVersion(k);f.os=f.os.insert(_,O)}}})})(r.localStore,s))})}function S0(n,e){return p(this,null,function*(){let t=M(n);if(!t.currentUser.isEqual(e)){x("SyncEngine","User change. New user:",e.toKey());let r=yield Vv(t.localStore,e);t.currentUser=e,(function(s,o){s.ka.forEach(c=>{c.forEach(u=>{u.reject(new N(C.CANCELLED,o))})}),s.ka.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield nn(t,r.hs)}})}function R0(n,e){let t=M(n),r=t.Na.get(e);if(r&&r.va)return H().add(r.key);{let i=H(),s=t.Ma.get(e);if(!s)return i;for(let o of s){let c=t.Fa.get(o);i=i.unionWith(c.view.Va)}return i}}function P0(n,e){return p(this,null,function*(){let t=M(n),r=yield oc(t.localStore,e.query,!0),i=e.view.ba(r);return t.isPrimaryClient&&gf(t,e.targetId,i.wa),i})}function C0(n,e){return p(this,null,function*(){let t=M(n);return Uv(t.localStore,e).then(r=>nn(t,r))})}function N0(n,e,t,r){return p(this,null,function*(){let i=M(n),s=yield(function(c,u){let h=M(c),f=M(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",m=>f.Mn(m,u).next(_=>_?h.localDocuments.getDocuments(m,_):R.resolve(null)))})(i.localStore,e);s!==null?(t==="pending"?yield Si(i.remoteStore):t==="acknowledged"||t==="rejected"?(ip(i,e,r||null),rp(i,e),(function(c,u){M(M(c).mutationQueue).On(u)})(i.localStore,e)):U(),yield nn(i,s)):x("SyncEngine","Cannot apply mutation batch with id: "+e)})}function k0(n,e){return p(this,null,function*(){let t=M(n);if(xc(t),op(t),e===!0&&t.Qa!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield wy(t,r.toArray());t.Qa=!0,yield of(t.remoteStore,!0);for(let s of i)Dc(t.remoteStore,s)}else if(e===!1&&t.Qa!==!1){let r=[],i=Promise.resolve();t.Ma.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(vi(t,o),gi(t.localStore,o,!0))),_i(t.remoteStore,o)}),yield i,yield wy(t,r),(function(o){let c=M(o);c.Na.forEach((u,h)=>{_i(c.remoteStore,h)}),c.La.pr(),c.Na=new Map,c.Oa=new le(F.comparator)})(t),t.Qa=!1,yield of(t.remoteStore,!1)}})}function wy(n,e,t){return p(this,null,function*(){let r=M(n),i=[],s=[];for(let o of e){let c,u=r.Ma.get(o);if(u&&u.length!==0){c=yield mi(r.localStore,Je(u[0]));for(let h of u){let f=r.Fa.get(h),m=yield P0(r,f);m.snapshot&&s.push(m.snapshot)}}else{let h=yield Fv(r.localStore,o);c=yield mi(r.localStore,h),yield np(r,Yv(h),o,!1,c.resumeToken)}i.push(c)}return r.Ca.d_(s),i})}function Yv(n){return Yy(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function D0(n){return(function(t){return M(M(t).persistence).Qi()})(M(n).localStore)}function x0(n,e,t,r){return p(this,null,function*(){let i=M(n);if(i.Qa)return void x("SyncEngine","Ignoring unexpected query state notification.");let s=i.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield Uv(i.localStore,Zy(s[0])),c=Qs.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ee.EMPTY_BYTE_STRING);yield nn(i,o,c);break}case"rejected":yield gi(i.localStore,e,!0),vi(i,e,r);break;default:U()}})}function O0(n,e,t){return p(this,null,function*(){let r=xc(n);if(r.Qa){for(let i of e){if(r.Ma.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){x("SyncEngine","Adding an already active target "+i);continue}let s=yield Fv(r.localStore,i),o=yield mi(r.localStore,s);yield np(r,Yv(s),o.targetId,!1,o.resumeToken),Dc(r.remoteStore,o)}for(let i of t)r.Ma.has(i)&&(yield gi(r.localStore,i,!1).then(()=>{_i(r.remoteStore,i),vi(r,i)}).catch(Vn))}})}function xc(n){let e=M(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Qv.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=R0.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=w0.bind(null,e),e.Ca.d_=p0.bind(null,e.eventManager),e.Ca.$a=m0.bind(null,e.eventManager),e}function op(n){let e=M(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=E0.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=T0.bind(null,e),e}function V0(n,e,t){let r=M(n);(function(s,o,c){return p(this,null,function*(){try{let u=yield o.getMetadata();if(yield(function(b,k){let O=M(b),D=we(k.createTime);return O.persistence.runTransaction("hasNewerBundle","readonly",G=>O.Gr.getBundleMetadata(G,k.id)).then(G=>!!G&&G.createTime.compareTo(D)>=0)})(s.localStore,u))return yield o.close(),c._completeWith((function(b){return{taskState:"Success",documentsLoaded:b.totalDocuments,bytesLoaded:b.totalBytes,totalDocuments:b.totalDocuments,totalBytes:b.totalBytes}})(u)),Promise.resolve(new Set);c._updateProgress($v(u));let h=new df(u,s.localStore,o.serializer),f=yield o.Ua();for(;f;){let _=yield h.la(f);_&&c._updateProgress(_),f=yield o.Ua()}let m=yield h.complete();return yield nn(s,m.Ia,void 0),yield(function(b,k){let O=M(b);return O.persistence.runTransaction("Save bundle","readwrite",D=>O.Gr.saveBundleMetadata(D,k))})(s.localStore,u),c._completeWith(m.progress),Promise.resolve(m.Pa)}catch(u){return gt("SyncEngine",`Loading bundle failed with ${u}`),c._failWith(u),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var _f=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return p(this,null,function*(){this.serializer=ho(t.databaseInfo.databaseId),this.sharedClientState=this.Wa(t),this.persistence=this.Ga(t),yield this.persistence.start(),this.localStore=this.za(t),this.gcScheduler=this.ja(t,this.localStore),this.indexBackfillerScheduler=this.Ha(t,this.localStore)})}ja(t,r){return null}Ha(t,r){return null}za(t){return Ov(this.persistence,new sc,t.initialUser,this.serializer)}Ga(t){return new rc(ic.Zr,this.serializer)}Wa(t){return new uc}terminate(){return p(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var vc=class n extends _f{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return p(this,null,function*(){yield wt(n.prototype,this,"initialize").call(this,e),yield this.Ja.initialize(this,e),yield op(this.Ja.syncEngine),yield Si(this.Ja.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}za(e){return Ov(this.persistence,new sc,e.initialUser,this.serializer)}ja(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new kd(r,e.asyncQueue,t)}Ha(e,t){let r=new Hh(t,this.persistence);return new $h(e.asyncQueue,r)}Ga(e){let t=Qf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?at.withCacheSize(this.cacheSizeBytes):at.DEFAULT;return new Kd(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,qv(),Da(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new uc}},yf=class n extends vc{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return p(this,null,function*(){yield wt(n.prototype,this,"initialize").call(this,e);let t=this.Ja.syncEngine;this.sharedClientState instanceof Us&&(this.sharedClientState.syncEngine={no:N0.bind(null,t),ro:x0.bind(null,t),io:O0.bind(null,t),Qi:D0.bind(null,t),eo:C0.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.yi(r=>p(this,null,function*(){yield k0(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}Wa(e){let t=qv();if(!Us.D(t))throw new N(C.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Qf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Us(t,e.asyncQueue,r,e.clientId,e.initialUser)}},ap=(()=>{class n{initialize(t,r){return p(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Iy(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=S0.bind(null,this.syncEngine),yield of(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return(function(){return new uf})()}createDatastore(t){let r=ho(t.databaseInfo.databaseId),i=(function(o){return new Zd(o)})(t.databaseInfo);return(function(o,c,u,h){return new nf(o,c,u,h)})(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return(function(i,s,o,c,u){return new sf(i,s,o,c,u)})(this.localStore,this.datastore,t.asyncQueue,r=>Iy(this.syncEngine,r,0),(function(){return lc.D()?new lc:new Yd})())}createSyncEngine(t,r){return(function(s,o,c,u,h,f,m){let _=new mf(s,o,c,u,h,f);return m&&(_.Qa=!0),_})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return p(this,null,function*(){var t,r;yield(function(s){return p(this,null,function*(){let o=M(s);x("RemoteStore","RemoteStore shutting down."),o.L_.add(5),yield bi(o),o.k_.shutdown(),o.q_.set("Unknown")})})(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();function Ey(n,e=10240){let t=0;return{read(){return p(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return p(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Ii=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):ve("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var vf=class{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new ke,this.buffer=new Uint8Array,this.eu=(function(){return new TextDecoder("utf-8")})(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}getMetadata(){return p(this,null,function*(){return this.metadata.promise})}Ua(){return p(this,null,function*(){return yield this.getMetadata(),this.tu()})}tu(){return p(this,null,function*(){let e=yield this.nu();if(e===null)return null;let t=this.eu.decode(e),r=Number(t);isNaN(r)&&this.ru(`length string (${t}) is not valid number`);let i=yield this.iu(r);return new hf(JSON.parse(i),e.length+r)})}su(){return this.buffer.findIndex(e=>e===123)}nu(){return p(this,null,function*(){for(;this.su()<0&&!(yield this.ou()););if(this.buffer.length===0)return null;let e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}iu(e){return p(this,null,function*(){for(;this.buffer.length<e;)(yield this.ou())&&this.ru("Reached the end of bundle when more is expected.");let t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}ou(){return p(this,null,function*(){let e=yield this.Xa.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var If=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return p(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new N(C.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield(function(i,s){return p(this,null,function*(){let o=M(i),c={documents:s.map(m=>Ys(o.serializer,m))},u=yield o.Lo("BatchGetDocuments",o.serializer.databaseId,Z.emptyPath(),c,s.length),h=new Map;u.forEach(m=>{let _=BS(o.serializer,m);h.set(_.key.toString(),_)});let f=[];return s.forEach(m=>{let _=h.get(m.toString());B(!!_),f.push(_)}),f})})(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new xn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return p(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=F.fromPath(r);this.mutations.push(new Ks(i,this.precondition(i)))}),yield(function(r,i){return p(this,null,function*(){let s=M(r),o={writes:i.map(c=>Xs(s.serializer,c))};yield s.Mo("Commit",s.serializer.databaseId,Z.emptyPath(),o)})})(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw U();t=j.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new N(C.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(j.min())?ye.exists(!1):ye.updateTime(t):ye.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(j.min()))throw new N(C.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ye.updateTime(t)}return ye.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var wf=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this._u=r.maxAttempts,this.t_=new no(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(()=>p(this,null,function*(){let e=new If(this.datastore),t=this.cu(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.lu(i)}))}).catch(r=>{this.lu(r)})}))}cu(e){try{let t=this.updateFunction(e);return!ao(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!dv(t)}return!1}};var Ef=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Ce.UNAUTHENTICATED,this.clientId=Oa.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>p(this,null,function*(){x("FirestoreClient","Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(x("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ke;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>p(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Pi(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Lh(n,e){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),x("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>p(null,null,function*(){r.isEqual(i)||(yield Vv(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Ty(n,e){return p(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield cp(n);x("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>_y(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>_y(e.remoteStore,i)),n._onlineComponents=e})}function cp(n){return p(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){x("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Lh(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===C.FAILED_PRECONDITION||i.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;gt("Error using user provided cache. Falling back to memory cache: "+t),yield Lh(n,new _f)}}else x("FirestoreClient","Using default OfflineComponentProvider"),yield Lh(n,new _f);return n._offlineComponents})}function Oc(n){return p(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(x("FirestoreClient","Using user provided OnlineComponentProvider"),yield Ty(n,n._uninitializedComponentsProvider._online)):(x("FirestoreClient","Using default OnlineComponentProvider"),yield Ty(n,new ap))),n._onlineComponents})}function Xv(n){return cp(n).then(e=>e.persistence)}function up(n){return cp(n).then(e=>e.localStore)}function Zv(n){return Oc(n).then(e=>e.remoteStore)}function lp(n){return Oc(n).then(e=>e.syncEngine)}function L0(n){return Oc(n).then(e=>e.datastore)}function wi(n){return p(this,null,function*(){let e=yield Oc(n),t=e.eventManager;return t.onListen=g0.bind(null,e.syncEngine),t.onUnlisten=y0.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=_0.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=v0.bind(null,e.syncEngine),t})}function M0(n){return n.asyncQueue.enqueue(()=>p(null,null,function*(){let e=yield Xv(n),t=yield Zv(n);return e.setNetworkEnabled(!0),(function(i){let s=M(i);return s.L_.delete(0),fo(s)})(t)}))}function F0(n){return n.asyncQueue.enqueue(()=>p(null,null,function*(){let e=yield Xv(n),t=yield Zv(n);return e.setNetworkEnabled(!1),(function(i){return p(this,null,function*(){let s=M(i);s.L_.add(0),yield bi(s),s.q_.set("Offline")})})(t)}))}function U0(n,e){let t=new ke;return n.asyncQueue.enqueueAndForget(()=>p(null,null,function*(){return(function(i,s,o){return p(this,null,function*(){try{let c=yield(function(h,f){let m=M(h);return m.persistence.runTransaction("read document","readonly",_=>m.localDocuments.getDocument(_,f))})(i,s);c.isFoundDocument()?o.resolve(c):c.isNoDocument()?o.resolve(null):o.reject(new N(C.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(c){let u=Pi(c,`Failed to get document '${s} from cache`);o.reject(u)}})})(yield up(n),e,t)})),t.promise}function eI(n,e,t={}){let r=new ke;return n.asyncQueue.enqueueAndForget(()=>p(null,null,function*(){return(function(s,o,c,u,h){let f=new Ii({next:_=>{f.Za(),o.enqueueAndForget(()=>ep(s,m));let b=_.docs.has(c);!b&&_.fromCache?h.reject(new N(C.UNAVAILABLE,"Failed to get document because the client is offline.")):b&&_.fromCache&&u&&u.source==="server"?h.reject(new N(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(_)},error:_=>h.reject(_)}),m=new ro(Ai(c.path),f,{includeMetadataChanges:!0,_a:!0});return Zf(s,m)})(yield wi(n),n.asyncQueue,e,t,r)})),r.promise}function B0(n,e){let t=new ke;return n.asyncQueue.enqueueAndForget(()=>p(null,null,function*(){return(function(i,s,o){return p(this,null,function*(){try{let c=yield oc(i,s,!0),u=new yc(s,c.Ts),h=u.ma(c.documents),f=u.applyChanges(h,!1);o.resolve(f.snapshot)}catch(c){let u=Pi(c,`Failed to execute query '${s} against cache`);o.reject(u)}})})(yield up(n),e,t)})),t.promise}function tI(n,e,t={}){let r=new ke;return n.asyncQueue.enqueueAndForget(()=>p(null,null,function*(){return(function(s,o,c,u,h){let f=new Ii({next:_=>{f.Za(),o.enqueueAndForget(()=>ep(s,m)),_.fromCache&&u.source==="server"?h.reject(new N(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(_)},error:_=>h.reject(_)}),m=new ro(c,f,{includeMetadataChanges:!0,_a:!0});return Zf(s,m)})(yield wi(n),n.asyncQueue,e,t,r)})),r.promise}function q0(n,e){let t=new Ii(e);return n.asyncQueue.enqueueAndForget(()=>p(null,null,function*(){return(function(i,s){M(i).Y_.add(s),s.next()})(yield wi(n),t)})),()=>{t.Za(),n.asyncQueue.enqueueAndForget(()=>p(null,null,function*(){return(function(i,s){M(i).Y_.delete(s)})(yield wi(n),t)}))}}function j0(n,e,t,r){let i=(function(o,c){let u;return u=typeof o=="string"?pv().encode(o):o,(function(f,m){return new vf(f,m)})((function(f,m){if(f instanceof Uint8Array)return Ey(f,m);if(f instanceof ArrayBuffer)return Ey(new Uint8Array(f),m);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")})(u),c)})(t,ho(e));n.asyncQueue.enqueueAndForget(()=>p(null,null,function*(){V0(yield lp(n),i,r)}))}function z0(n,e){return n.asyncQueue.enqueue(()=>p(null,null,function*(){return(function(r,i){let s=M(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Gr.getNamedQuery(o,i))})(yield up(n),e)}))}function nI(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Ay=new Map;function hp(n,e,t){if(!t)throw new N(C.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function dp(n,e,t,r){if(e===!0&&r===!0)throw new N(C.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function by(n){if(!F.isDocumentKey(n))throw new N(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Sy(n){if(F.isDocumentKey(n))throw new N(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Vc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":U()}function ee(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new N(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Vc(n);throw new N(C.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function rI(n,e){if(e<=0)throw new N(C.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var Ic=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new N(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new N(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}dp("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=nI((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new N(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new N(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new N(C.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},yr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ic({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new N(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new N(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ic(e),e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new Mh;switch(r.type){case"firstParty":return new qh(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new N(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return p(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){let r=Ay.get(t);r&&(x("ComponentProvider","Removing Datastore"),Ay.delete(t),r.terminate())})(this),Promise.resolve()}};function iI(n,e,t,r={}){var i;let s=(n=ee(n,yr))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&gt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let c,u;if(typeof r.mockUserToken=="string")c=r.mockUserToken,u=Ce.MOCK_USER;else{c=Gm(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let h=r.mockUserToken.sub||r.mockUserToken.user_id;if(!h)throw new N(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Ce(h)}n._authCredentials=new Fh(new xa(c,u))}}var Me=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ae=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ot(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Ot=class n extends Me{constructor(e,t,r){super(e,t,Ai(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ae(this.firestore,null,new F(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function fp(n,e,...t){if(n=z(n),hp("collection","path",e),n instanceof yr){let r=Z.fromString(e,...t);return Sy(r),new Ot(n,null,r)}{if(!(n instanceof ae||n instanceof Ot))throw new N(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Z.fromString(e,...t));return Sy(r),new Ot(n.firestore,null,r)}}function sI(n,e){if(n=ee(n,yr),hp("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new N(C.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Me(n,null,(function(r){return new _t(Z.emptyPath(),r)})(e))}function po(n,e,...t){if(n=z(n),arguments.length===1&&(e=Oa.newId()),hp("doc","path",e),n instanceof yr){let r=Z.fromString(e,...t);return by(r),new ae(n,null,new F(r))}{if(!(n instanceof ae||n instanceof Ot))throw new N(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(Z.fromString(e,...t));return by(r),new ae(n.firestore,n instanceof Ot?n.converter:null,new F(r))}}function pp(n,e){return n=z(n),e=z(e),(n instanceof ae||n instanceof Ot)&&(e instanceof ae||e instanceof Ot)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function mp(n,e){return n=z(n),e=z(e),n instanceof Me&&e instanceof Me&&n.firestore===e.firestore&&uo(n._query,e._query)&&n.converter===e.converter}var wc=class{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new no(this,"async_queue_retry"),this.Vu=()=>{let r=Da();r&&x("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;let t=Da();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;let t=Da();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});let t=new ke;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){return p(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Ln(e))throw e;x("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(e){let t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;let i=(function(o){let c=o.message||"";return o.stack&&(c=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),c})(r);throw ve("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);let i=af.createAndSchedule(this,e,t,r,s=>this.yu(s));return this.Tu.push(i),i}fu(){this.Eu&&U()}verifyOperationInProgress(){}wu(){return p(this,null,function*(){let e;do e=this.mu,yield e;while(e!==this.mu)})}Su(e){for(let t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){let t=this.Tu.indexOf(e);this.Tu.splice(t,1)}};function Tf(n){return(function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1})(n,["next","error","complete"])}var Af=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new ke,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var oI=-1,pe=class extends yr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new wc,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return p(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new wc(e),this._firestoreClient=void 0,yield e}})}};function Fe(n){if(n._terminated)throw new N(C.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||aI(n),n._firestoreClient}function aI(n){var e,t,r;let i=n._freezeSettings(),s=(function(c,u,h,f){return new Qh(c,u,h,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,nI(f.experimentalLongPollingOptions),f.useFetchStreams)})(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new Ef(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&(function(c){let u=c?._online.build();return{_offline:c?._offline.build(u),_online:u}})(n._componentsProvider))}function cI(n,e){gt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return lI(n,ap.provider,{build:r=>new vc(r,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function uI(n){return p(this,null,function*(){gt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();lI(n,ap.provider,{build:t=>new yf(t,e.cacheSizeBytes)})})}function lI(n,e,t){if((n=ee(n,pe))._firestoreClient||n._terminated)throw new N(C.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new N(C.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},aI(n)}function hI(n){if(n._initialized&&!n._terminated)throw new N(C.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new ke;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>p(null,null,function*(){try{yield(function(r){return p(this,null,function*(){if(!Sn.D())return Promise.resolve();let i=r+"main";yield Sn.delete(i)})})(Qf(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function dI(n){return(function(t){let r=new ke;return t.asyncQueue.enqueueAndForget(()=>p(null,null,function*(){return A0(yield lp(t),r)})),r.promise})(Fe(n=ee(n,pe)))}function fI(n){return M0(Fe(n=ee(n,pe)))}function pI(n){return F0(Fe(n=ee(n,pe)))}function mI(n,e){let t=Fe(n=ee(n,pe)),r=new Af;return j0(t,n._databaseId,e,r),r}function gI(n,e){return z0(Fe(n=ee(n,pe)),e).then(t=>t?new Me(n,null,t.query):null)}var Ft=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ee.fromBase64String(e))}catch(t){throw new N(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ee.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var vt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new N(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ie(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var en=class{constructor(e){this._methodName=e}};var vr=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new N(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new N(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return $(this._lat,e._lat)||$(this._long,e._long)}};var io=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0})(this._values,e._values)}};var G0=/^__.*__$/,bf=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new yt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Dn(e,this.data,t,this.fieldTransforms)}},Ec=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new yt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function _I(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U()}}var Tc=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.Ou(e),i}Nu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Ac(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(_I(this.Cu)&&G0.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}},Sf=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ho(e)}Qu(e,t,r,i=!1){return new Tc({Cu:e,methodName:t,qu:r,path:Ie.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Tr(n){let e=n._freezeSettings(),t=ho(n._databaseId);return new Sf(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Lc(n,e,t,r,i,s={}){let o=n.Qu(s.merge||s.mergeFields?2:0,e,t,i);yp("Data must be an object, but it was:",o,r);let c=II(r,o),u,h;if(s.merge)u=new rt(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){let f=[];for(let m of s.mergeFields){let _=kf(e,m,t);if(!o.contains(_))throw new N(C.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);EI(f,_)||f.push(_)}u=new rt(f),h=o.fieldTransforms.filter(m=>u.covers(m.field))}else u=null,h=o.fieldTransforms;return new bf(new We(c),u,h)}var so=class n extends en{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function yI(n,e,t){return new Tc({Cu:3,qu:e.settings.qu,methodName:n._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var Rf=class n extends en{_toFieldTransform(e){return new mr(e.path,new Nn)}isEqual(e){return e instanceof n}},Pf=class n extends en{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=yI(this,e,!0),r=this.Ku.map(s=>Ar(s,t)),i=new Xt(r);return new mr(e.path,i)}isEqual(e){return e instanceof n&&ln(this.Ku,e.Ku)}},Cf=class n extends en{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){let t=yI(this,e,!0),r=this.Ku.map(s=>Ar(s,t)),i=new Zt(r);return new mr(e.path,i)}isEqual(e){return e instanceof n&&ln(this.Ku,e.Ku)}},Nf=class n extends en{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){let t=new kn(e.serializer,sv(e.serializer,this.$u));return new mr(e.path,t)}isEqual(e){return e instanceof n&&this.$u===e.$u}};function gp(n,e,t,r){let i=n.Qu(1,e,t);yp("Data must be an object, but it was:",i,r);let s=[],o=We.empty();Er(r,(u,h)=>{let f=vp(e,u,t);h=z(h);let m=i.Nu(f);if(h instanceof so)s.push(f);else{let _=Ar(h,m);_!=null&&(s.push(f),o.set(f,_))}});let c=new rt(s);return new Ec(o,c,i.fieldTransforms)}function _p(n,e,t,r,i,s){let o=n.Qu(1,e,t),c=[kf(e,r,t)],u=[i];if(s.length%2!=0)throw new N(C.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)c.push(kf(e,s[_])),u.push(s[_+1]);let h=[],f=We.empty();for(let _=c.length-1;_>=0;--_)if(!EI(h,c[_])){let b=c[_],k=u[_];k=z(k);let O=o.Nu(b);if(k instanceof so)h.push(b);else{let D=Ar(k,O);D!=null&&(h.push(b),f.set(b,D))}}let m=new rt(h);return new Ec(f,m,o.fieldTransforms)}function vI(n,e,t,r=!1){return Ar(t,n.Qu(r?4:3,e))}function Ar(n,e){if(wI(n=z(n)))return yp("Unsupported field value:",e,n),II(n,e);if(n instanceof en)return(function(r,i){if(!_I(i.Cu))throw i.Bu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return(function(r,i){let s=[],o=0;for(let c of r){let u=Ar(c,i.Lu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}})(n,e)}return(function(r,i){if((r=z(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return sv(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=fe.fromDate(r);return{timestampValue:di(i.serializer,s)}}if(r instanceof fe){let s=new fe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:di(i.serializer,s)}}if(r instanceof vr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ft)return{bytesValue:mv(i.serializer,r._byteString)};if(r instanceof ae){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Kf(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof io)return(function(o,c){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw c.Bu("VectorValues must only contain numeric values.");return Wf(c.serializer,u)})}}}}}})(r,i);throw i.Bu(`Unsupported field value: ${Vc(r)}`)})(n,e)}function II(n,e){let t={};return qy(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Er(n,(r,i)=>{let s=Ar(i,e.Mu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function wI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof fe||n instanceof vr||n instanceof Ft||n instanceof ae||n instanceof en||n instanceof io)}function yp(n,e,t){if(!wI(t)||!(function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)})(t)){let r=Vc(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function kf(n,e,t){if((e=z(e))instanceof vt)return e._internalPath;if(typeof e=="string")return vp(n,e);throw Ac("Field path arguments must be of type string or ",n,!1,void 0,t)}var W0=new RegExp("[~\\*/\\[\\]]");function vp(n,e,t){if(e.search(W0)>=0)throw Ac(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new vt(...e.split("."))._internalPath}catch{throw Ac(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ac(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new N(C.INVALID_ARGUMENT,c+n+u)}function EI(n,e){return n.some(t=>t.isEqual(e))}var Ir=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ae(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Df(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Mc("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Df=class extends Ir{data(){return super.data()}};function Mc(n,e){return typeof e=="string"?vp(n,e):e instanceof vt?e._internalPath:e._delegate._internalPath}function TI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new N(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var oo=class{},wr=class extends oo{};function rn(n,e,...t){let r=[];e instanceof oo&&r.push(e),r=r.concat(t),(function(s){let o=s.filter(u=>u instanceof xf).length,c=s.filter(u=>u instanceof bc).length;if(o>1||o>0&&c>0)throw new N(C.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(let i of r)n=i._apply(n);return n}var bc=class n extends wr{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return xI(e._query,t),new Me(e.firestore,e.converter,cd(e._query,t))}_parse(e){let t=Tr(e.firestore);return(function(s,o,c,u,h,f,m){let _;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new N(C.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){Py(m,f);let b=[];for(let k of m)b.push(Ry(u,s,k));_={arrayValue:{values:b}}}else _=Ry(u,s,m)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||Py(m,f),_=vI(c,o,m,f==="in"||f==="not-in");return Y.create(h,f,_)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function AI(n,e,t){let r=e,i=Mc("where",n);return bc._create(i,r,t)}var xf=class n extends oo{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:re.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:((function(i,s){let o=i,c=s.getFlattenedFilters();for(let u of c)xI(o,u),o=cd(o,u)})(e._query,t),new Me(e.firestore,e.converter,cd(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Of=class n extends wr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=(function(i,s,o){if(i.startAt!==null)throw new N(C.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new N(C.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new fr(s,o)})(e._query,this._field,this._direction);return new Me(e.firestore,e.converter,(function(i,s){let o=i.explicitOrderBy.concat([s]);return new _t(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(e._query,t))}};function bI(n,e="asc"){let t=e,r=Mc("orderBy",n);return Of._create(r,t)}var Sc=class n extends wr{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Me(e.firestore,e.converter,Ga(e._query,this._limit,this._limitType))}};function SI(n){return rI("limit",n),Sc._create("limit",n,"F")}function RI(n){return rI("limitToLast",n),Sc._create("limitToLast",n,"L")}var Rc=class n extends wr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=DI(e,this.type,this._docOrFields,this._inclusive);return new Me(e.firestore,e.converter,(function(i,s){return new _t(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)})(e._query,t))}};function PI(...n){return Rc._create("startAt",n,!0)}function CI(...n){return Rc._create("startAfter",n,!1)}var Pc=class n extends wr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=DI(e,this.type,this._docOrFields,this._inclusive);return new Me(e.firestore,e.converter,(function(i,s){return new _t(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)})(e._query,t))}};function NI(...n){return Pc._create("endBefore",n,!1)}function kI(...n){return Pc._create("endAt",n,!0)}function DI(n,e,t,r){if(t[0]=z(t[0]),t[0]instanceof Ir)return(function(s,o,c,u,h){if(!u)throw new N(C.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${c}().`);let f=[];for(let m of ii(s))if(m.field.isKeyField())f.push(dr(o,u.key));else{let _=u.data.field(m.field);if(Nc(_))throw new N(C.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(_===null){let b=m.field.canonicalString();throw new N(C.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${b}' (used as the orderBy) does not exist.`)}f.push(_)}return new Lt(f,h)})(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Tr(n.firestore);return(function(o,c,u,h,f,m){let _=o.explicitOrderBy;if(f.length>_.length)throw new N(C.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let b=[];for(let k=0;k<f.length;k++){let O=f[k];if(_[k].field.isKeyField()){if(typeof O!="string")throw new N(C.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof O}`);if(!zf(o)&&O.indexOf("/")!==-1)throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${O}' contains a slash.`);let D=o.path.child(Z.fromString(O));if(!F.isDocumentKey(D))throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);let G=new F(D);b.push(dr(c,G))}else{let D=vI(u,h,O);b.push(D)}}return new Lt(b,m)})(n._query,n.firestore._databaseId,i,e,t,r)}}function Ry(n,e,t){if(typeof(t=z(t))=="string"){if(t==="")throw new N(C.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!zf(e)&&t.indexOf("/")!==-1)throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(Z.fromString(t));if(!F.isDocumentKey(r))throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return dr(n,new F(r))}if(t instanceof ae)return dr(n,t._key);throw new N(C.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Vc(t)}.`)}function Py(n,e){if(!Array.isArray(n)||n.length===0)throw new N(C.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function xI(n,e){let t=(function(i,s){for(let o of i)for(let c of o.getFlattenedFilters())if(s.indexOf(c.op)>=0)return c.op;return null})(n.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new N(C.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new N(C.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Ei=class{convertValue(e,t="none"){switch(hr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return he(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Rn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw U()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Er(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>he(o.doubleValue));return new io(s)}convertGeoPoint(e){return new vr(he(e.latitude),he(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=qf(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(zs(e));default:return null}}convertTimestamp(e){let t=Yt(e);return new fe(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=Z.fromString(e);B(Sv(r));let i=new Pn(r.get(1),r.get(3)),s=new F(r.popFirst(5));return i.isEqual(t)||ve(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function Fc(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Vf=class extends Ei{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ft(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ae(this.firestore,null,t)}};var Jt=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},ut=class extends Ir{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new An(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Mc("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},An=class extends ut{data(e={}){return super.data(e)}},It=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Jt(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new An(this._firestore,this._userDataWriter,r.key,r,new Jt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new N(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(c=>{let u=new An(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Jt(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>s||c.type!==3).map(c=>{let u=new An(i._firestore,i._userDataWriter,c.doc.key,c.doc,new Jt(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),h=-1,f=-1;return c.type!==0&&(h=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),f=o.indexOf(c.doc.key)),{type:K0(c.type),doc:u,oldIndex:h,newIndex:f}})}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function K0(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U()}}function Ip(n,e){return n instanceof ut&&e instanceof ut?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof It&&e instanceof It&&n._firestore===e._firestore&&mp(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function OI(n){n=ee(n,ae);let e=ee(n.firestore,pe);return eI(Fe(e),n._key).then(t=>Ap(e,n,t))}var tn=class extends Ei{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ft(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ae(this.firestore,null,t)}};function VI(n){n=ee(n,ae);let e=ee(n.firestore,pe),t=Fe(e),r=new tn(e);return U0(t,n._key).then(i=>new ut(e,r,n._key,i,new Jt(i!==null&&i.hasLocalMutations,!0),n.converter))}function LI(n){n=ee(n,ae);let e=ee(n.firestore,pe);return eI(Fe(e),n._key,{source:"server"}).then(t=>Ap(e,n,t))}function MI(n){n=ee(n,Me);let e=ee(n.firestore,pe),t=Fe(e),r=new tn(e);return TI(n._query),tI(t,n._query).then(i=>new It(e,r,n,i))}function FI(n){n=ee(n,Me);let e=ee(n.firestore,pe),t=Fe(e),r=new tn(e);return B0(t,n._query).then(i=>new It(e,r,n,i))}function UI(n){n=ee(n,Me);let e=ee(n.firestore,pe),t=Fe(e),r=new tn(e);return tI(t,n._query,{source:"server"}).then(i=>new It(e,r,n,i))}function wp(n,e,t){n=ee(n,ae);let r=ee(n.firestore,pe),i=Fc(n.converter,e,t);return Ci(r,[Lc(Tr(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,ye.none())])}function Ep(n,e,t,...r){n=ee(n,ae);let i=ee(n.firestore,pe),s=Tr(i),o;return o=typeof(e=z(e))=="string"||e instanceof vt?_p(s,"updateDoc",n._key,e,t,r):gp(s,"updateDoc",n._key,e),Ci(i,[o.toMutation(n._key,ye.exists(!0))])}function BI(n){return Ci(ee(n.firestore,pe),[new xn(n._key,ye.none())])}function qI(n,e){let t=ee(n.firestore,pe),r=po(n),i=Fc(n.converter,e);return Ci(t,[Lc(Tr(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,ye.exists(!1))]).then(()=>r)}function Tp(n,...e){var t,r,i;n=z(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Tf(e[o])||(s=e[o],o++);let c={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Tf(e[o])){let m=e[o];e[o]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[o+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[o+2]=(i=m.complete)===null||i===void 0?void 0:i.bind(m)}let u,h,f;if(n instanceof ae)h=ee(n.firestore,pe),f=Ai(n._key.path),u={next:m=>{e[o]&&e[o](Ap(h,n,m))},error:e[o+1],complete:e[o+2]};else{let m=ee(n,Me);h=ee(m.firestore,pe),f=m._query;let _=new tn(h);u={next:b=>{e[o]&&e[o](new It(h,_,m,b))},error:e[o+1],complete:e[o+2]},TI(n._query)}return(function(_,b,k,O){let D=new Ii(O),G=new ro(b,D,k);return _.asyncQueue.enqueueAndForget(()=>p(null,null,function*(){return Zf(yield wi(_),G)})),()=>{D.Za(),_.asyncQueue.enqueueAndForget(()=>p(null,null,function*(){return ep(yield wi(_),G)}))}})(Fe(h),f,c,u)}function jI(n,e){return q0(Fe(n=ee(n,pe)),Tf(e)?e:{next:e})}function Ci(n,e){return(function(r,i){let s=new ke;return r.asyncQueue.enqueueAndForget(()=>p(null,null,function*(){return I0(yield lp(r),i,s)})),s.promise})(Fe(n),e)}function Ap(n,e,t){let r=t.docs.get(e._key),i=new tn(n);return new ut(n,i,e._key,r,new Jt(t.hasPendingWrites,t.fromCache),e.converter)}var $0={maxAttempts:5};var Cc=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Tr(e)}set(e,t,r){this._verifyNotCommitted();let i=En(e,this._firestore),s=Fc(i.converter,t,r),o=Lc(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,ye.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=En(e,this._firestore),o;return o=typeof(t=z(t))=="string"||t instanceof vt?_p(this._dataReader,"WriteBatch.update",s._key,t,r,i):gp(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,ye.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=En(e,this._firestore);return this._mutations=this._mutations.concat(new xn(t._key,ye.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new N(C.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function En(n,e){if((n=z(n)).firestore!==e)throw new N(C.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Lf=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Tr(t)}get(t){let r=En(t,this._firestore),i=new Vf(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return U();let o=s[0];if(o.isFoundDocument())return new Ir(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Ir(this._firestore,i,r._key,null,r.converter);throw U()})}set(t,r,i){let s=En(t,this._firestore),o=Fc(s.converter,r,i),c=Lc(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,c),this}update(t,r,i,...s){let o=En(t,this._firestore),c;return c=typeof(r=z(r))=="string"||r instanceof vt?_p(this._dataReader,"Transaction.update",o._key,r,i,s):gp(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,c),this}delete(t){let r=En(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=En(e,this._firestore),r=new tn(this._firestore);return super.get(e).then(i=>new ut(this._firestore,r,t._key,i._document,new Jt(!1,!1),t.converter))}};function zI(n,e,t){n=ee(n,pe);let r=Object.assign(Object.assign({},$0),t);return(function(s){if(s.maxAttempts<1)throw new N(C.INVALID_ARGUMENT,"Max attempts must be at least 1")})(r),(function(s,o,c){let u=new ke;return s.asyncQueue.enqueueAndForget(()=>p(null,null,function*(){let h=yield L0(s);new wf(s.asyncQueue,h,c,o,u).au()})),u.promise})(Fe(n),i=>e(new Lf(n,i)),r)}function GI(){return new so("deleteField")}function WI(){return new Rf("serverTimestamp")}function KI(...n){return new Pf("arrayUnion",n)}function $I(...n){return new Cf("arrayRemove",n)}function HI(n){return new Nf("increment",n)}(function(e,t=!0){(function(i){Ti=i})(dt),ht(new xe("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),c=new pe(new Uh(r.getProvider("auth-internal")),new zh(r.getProvider("app-check-internal")),(function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new N(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Pn(h.options.projectId,f)})(o,i),o);return s=Object.assign({useFetchStreams:t},s),c._setSettings(s),c},"PUBLIC").setMultipleInstances(!0)),He(S_,"4.7.3",e),He(S_,"4.7.3","esm2017")})();var H0="@firebase/firestore-compat",Q0="0.3.38";function Np(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new N("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function QI(){if(typeof Uint8Array>"u")throw new N("unimplemented","Uint8Arrays are not available in this environment.")}function JI(){if(!jy())throw new N("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Uc=class n{constructor(e){this._delegate=e}static fromBase64String(e){return JI(),new n(Ft.fromBase64String(e))}static fromUint8Array(e){return QI(),new n(Ft.fromUint8Array(e))}toBase64(){return JI(),this._delegate.toBase64()}toUint8Array(){return QI(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function bp(n){return J0(n,["next","error","complete"])}function J0(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var Sp=class{enableIndexedDbPersistence(e,t){return cI(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return uI(e._delegate)}clearIndexedDbPersistence(e){return hI(e._delegate)}},Bc=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Pn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&gt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){iI(this._delegate,e,t,r)}enableNetwork(){return fI(this._delegate)}disableNetwork(){return pI(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,dp("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return dI(this._delegate)}onSnapshotsInSync(e){return jI(this._delegate,e)}get app(){if(!this._appCompat)throw new N("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Di(this,fp(this._delegate,e))}catch(t){throw Ye(t,"collection()","Firestore.collection()")}}doc(e){try{return new Ut(this,po(this._delegate,e))}catch(t){throw Ye(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Pr(this,sI(this._delegate,e))}catch(t){throw Ye(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return zI(this._delegate,t=>e(new qc(this,t)))}batch(){return Fe(this._delegate),new jc(new Cc(this._delegate,e=>Ci(this._delegate,e)))}loadBundle(e){return mI(this._delegate,e)}namedQuery(e){return gI(this._delegate,e).then(t=>t?new Pr(this,t):null)}},Ni=class extends Ei{constructor(e){super(),this.firestore=e}convertBytes(e){return new Uc(new Ft(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Ut.forKey(t,this.firestore,null)}};function Y0(n){Cy(n)}var qc=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Ni(e)}get(e){let t=br(e);return this._delegate.get(t).then(r=>new Sr(this._firestore,new ut(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=br(e);return r?(Np("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=br(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=br(e);return this._delegate.delete(t),this}},jc=class{constructor(e){this._delegate=e}set(e,t,r){let i=br(e);return r?(Np("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=br(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=br(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},ki=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new An(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Rr(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new Ni(e),t),i.set(t,s)),s}};ki.INSTANCES=new WeakMap;var Ut=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ni(e)}static forPath(e,t,r){if(e.length%2!==0)throw new N("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new ae(t._delegate,r,new F(e)))}static forKey(e,t,r){return new n(t,new ae(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Di(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Di(this.firestore,fp(this._delegate,e))}catch(t){throw Ye(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=z(e),e instanceof ae?pp(this._delegate,e):!1}set(e,t){t=Np("DocumentReference.set",t);try{return t?wp(this._delegate,e,t):wp(this._delegate,e)}catch(r){throw Ye(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?Ep(this._delegate,e):Ep(this._delegate,e,t,...r)}catch(i){throw Ye(i,"updateDoc()","DocumentReference.update()")}}delete(){return BI(this._delegate)}onSnapshot(...e){let t=YI(e),r=XI(e,i=>new Sr(this.firestore,new ut(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Tp(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=VI(this._delegate):e?.source==="server"?t=LI(this._delegate):t=OI(this._delegate),t.then(r=>new Sr(this.firestore,new ut(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(ki.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Ye(n,e,t){return n.message=n.message.replace(e,t),n}function YI(n){for(let e of n)if(typeof e=="object"&&!bp(e))return e;return{}}function XI(n,e){var t,r;let i;return bp(n[0])?i=n[0]:bp(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Sr=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Ut(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Ip(this._delegate,e._delegate)}},Rr=class extends Sr{data(e){let t=this._delegate.data(e);return this._delegate._converter||Ny(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Pr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ni(e)}where(e,t,r){try{return new n(this.firestore,rn(this._delegate,AI(e,t,r)))}catch(i){throw Ye(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,rn(this._delegate,bI(e,t)))}catch(r){throw Ye(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,rn(this._delegate,SI(e)))}catch(t){throw Ye(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,rn(this._delegate,RI(e)))}catch(t){throw Ye(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,rn(this._delegate,PI(...e)))}catch(t){throw Ye(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,rn(this._delegate,CI(...e)))}catch(t){throw Ye(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,rn(this._delegate,NI(...e)))}catch(t){throw Ye(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,rn(this._delegate,kI(...e)))}catch(t){throw Ye(t,"endAt()","Query.endAt()")}}isEqual(e){return mp(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=FI(this._delegate):e?.source==="server"?t=UI(this._delegate):t=MI(this._delegate),t.then(r=>new mo(this.firestore,new It(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=YI(e),r=XI(e,i=>new mo(this.firestore,new It(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Tp(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(ki.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},Rp=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Rr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},mo=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Pr(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Rr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Rp(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Rr(this._firestore,r))})}isEqual(e){return Ip(this._delegate,e._delegate)}},Di=class n extends Pr{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Ut(this.firestore,e):null}doc(e){try{return e===void 0?new Ut(this.firestore,po(this._delegate)):new Ut(this.firestore,po(this._delegate,e))}catch(t){throw Ye(t,"doc()","CollectionReference.doc()")}}add(e){return qI(this._delegate,e).then(t=>new Ut(this.firestore,t))}isEqual(e){return pp(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(ki.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function br(n){return ee(n,ae)}var Pp=class n{constructor(...e){this._delegate=new vt(...e)}static documentId(){return new n(Ie.keyField().canonicalString())}isEqual(e){return e=z(e),e instanceof vt?this._delegate._internalPath.isEqual(e._internalPath):!1}};var Cp=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=WI();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=GI();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=KI(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=$I(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=HI(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var X0={Firestore:Bc,GeoPoint:vr,Timestamp:fe,Blob:Uc,Transaction:qc,WriteBatch:jc,DocumentReference:Ut,DocumentSnapshot:Sr,Query:Pr,QueryDocumentSnapshot:Rr,QuerySnapshot:mo,CollectionReference:Di,FieldPath:Pp,FieldValue:Cp,setLogLevel:Y0,CACHE_SIZE_UNLIMITED:oI};function Z0(n,e){n.INTERNAL.registerComponent(new xe("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},X0)))}function eR(n){Z0(n,(e,t)=>new Bc(e,t,new Sp)),n.registerVersion(H0,Q0)}eR(Oe);var kp=class{constructor(e){this.registerUser=(t,r)=>new Promise((i,s)=>{Oe.auth().createUserWithEmailAndPassword(t,r).then(c=>{var c=Oe.auth().currentUser;i(c)},o=>{s(this._handleError(o))})}),this.loginUser=(t,r)=>new Promise((i,s)=>{Oe.auth().signInWithEmailAndPassword(t,r).then(c=>{var c=Oe.auth().currentUser;i(c)},o=>{s(this._handleError(o))})}),this.logout=()=>new Promise((t,r)=>{Oe.auth().signOut().then(()=>{t(!0)}).catch(i=>{r(this._handleError(i))})}),this.forgetPassword=t=>new Promise((r,i)=>{Oe.auth().sendPasswordResetEmail(t,{url:window.location.protocol+"//"+window.location.host+"/login"}).then(()=>{r(!0)}).catch(s=>{i(this._handleError(s))})}),this.setLoggeedInUser=t=>{sessionStorage.setItem("authUser",JSON.stringify(t))},this.getAuthenticatedUser=()=>sessionStorage.getItem("authUser")?JSON.parse(sessionStorage.getItem("authUser")):null,e&&(Oe.initializeApp(e),Oe.auth().onAuthStateChanged(t=>{t?sessionStorage.setItem("authUser",JSON.stringify(t)):sessionStorage.removeItem("authUser")}))}_handleError(e){var t=e.message;return t}},zc=null,jP=n=>(zc||(zc=new kp(n)),zc),Dp=()=>zc;var WP=zt("[Authentication] Register",jn()),KP=zt("[Authentication] Register Success",jn()),$P=zt("[Authentication] Register Failure",jn()),HP=zt("[Authentication] Login",jn()),QP=zt("[Authentication] Login Success",jn()),ZI=zt("[Authentication] Login Failure",jn()),ew=zt("[Authentication] Logout"),JP=zt("[Auth] Logout Success");var tw=Um.AUTH_API,nw={headers:new Mm({"Content-Type":"application/json"})},sC=(()=>{class n{constructor(t,r){this.http=t,this.store=r,this.currentUserSubject=new xo(JSON.parse(sessionStorage.getItem("currentUser")))}register(t,r,i){return this.http.post(tw+"signup",{email:t,first_name:r,password:i},nw).pipe(Xi(s=>s),gu(s=>{let o="Login failed";return this.store.dispatch(ZI({error:o})),mu(o)}))}login(t,r){return this.http.post(tw+"signin",{email:t,password:r},nw).pipe(Xi(i=>i),gu(i=>mu("Login failed")))}currentUser(){return Dp().getAuthenticatedUser()}logout(){return this.store.dispatch(ew()),sessionStorage.removeItem("currentUser"),sessionStorage.removeItem("token"),this.currentUserSubject.next(null),Lm(void 0).pipe()}resetPassword(t){return Dp().forgetPassword(t).then(r=>r.data)}static{this.\u0275fac=function(r){return new(r||n)(Zi(Lo),Zi(Fm))}}static{this.\u0275prov=Vo({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var uC=(()=>{class n{constructor(t){this.http=t,this.currentUserSubject=new xo(JSON.parse(sessionStorage.getItem("currentUser"))),this.currentUser=this.currentUserSubject.asObservable()}get currentUserValue(){return this.currentUserSubject.value}login(t,r){return this.http.post("/users/authenticate",{email:t,password:r}).pipe(Xi(i=>(i&&i.token&&(sessionStorage.setItem("toast","true"),sessionStorage.setItem("currentUser",JSON.stringify(i)),this.currentUserSubject.next(i)),i)))}logout(){sessionStorage.removeItem("currentUser"),this.currentUserSubject.next(null)}static{this.\u0275fac=function(r){return new(r||n)(Zi(Lo))}}static{this.\u0275prov=Vo({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();export{jP as a,WP as b,HP as c,QP as d,ZI as e,ew as f,JP as g,sC as h,uC as i};
